<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<th:block th:fragment="script">
    <script th:inline="javascript">
        let lastsel;

        $(window).load(function () {
            'use strict';

            vulHistory_grid.load();
        });

        const vulHistory_grid = {
            load: function(){
                $("#list").jqGrid({
                    url: "/system/vulnerabilityHistory/listAjax"
                    , datatype: 'json'
                    , jsonReader: {
                        repeatitems: false,
                        root:function(obj){return obj.rows;},
                        page:function(obj){return obj.page;},
                        total:function(obj){return obj.total;},
                        records:function(obj){return obj.records;}
                    }
                    , colNames: ['OSS ID','OSS Name','OSS Version', 'CVE ID (From)', 'CVSS Score (From)', 'CVE ID (To)', 'CVSS Score (To)', 'Created Date']
                    , colModel: [
                        {name: 'ossId', index: 'ossId', width: 40, align: 'center', template: searchStringOptions},
                        {name: 'ossName', index: 'ossName', width: 150, align: 'left', template: searchStringOptions},
                        {name: 'ossVersion', index: 'ossVersion', width: 80, align: 'left', template: searchStringOptions},
                        {name: 'cveId', index: 'cveId', width: 100, align: 'left', formatter: cveIdTag, unformat: unCveIdTag, template: searchStringOptions},
                        {name: 'cvssScore', index: 'cvssScore', width: 100, align: 'center', template: searchDateOptions},
                        {name: 'cveIdTo', index: 'cveIdTo', width: 100, align: 'left', formatter: cveIdTag, unformat: unCveIdTag, template: searchStringOptions},
                        {name: 'cvssScoreTo', index: 'cvssScoreTo',  width: 100, align: 'center', template: searchStringOptions},
                        {name: 'regDt', index: 'regDt', width: 100, align: 'center', formatter:'date', formatoptions: {srcformat: 'Y-m-d H:i:s.t', newformat: 'Y-m-d'}, template: searchDateOptions}
                    ]
                    , emptyrecords: "Nothing to display"
                    , autoencode: true
                    , editurl: 'clientArray'
                    , rowNum: [[${@CommonFunction.getCoConstDefVal("DISP_PAGENATION_DEFAULT")}]]
                    , rowList: stringToArray([[${@CommonFunction.getCoConstDefVal("DISP_PAGENATION_LIST_STR")}]])
                    , autowidth: true
                    , pager: '#pager'
                    , gridview: true
                    , sortable: function (permutation) {}
                    , sortname: 'regDt'
                    , sortorder: 'desc'
                    , viewrecords: true
                    , height: 'auto'
                    , loadonce: false
                    // 데이터 로딩 후
                    ,loadComplete: function(data) {}
                    // row 더블클릭 시 편집모드
                    , ondblClickRow: function(rowid,iRow,iCol,e) {}
                    , onCellSelect: function(rowid,iCol,cellcontent,e) {
                        if(iCol=="0") fn_grid_com.showOssViewPage($("#list"), rowid, true);
                    }

                });

                $("#list").jqGrid('navGrid',"#pager",{edit:false,add:false,del:false,search:false,refresh:false});
                $("#list").jqGrid('filterToolbar',{stringResult: true, searchOnEnter: true, searchOperators: true, defaultSearch: "cn"});
            }
        };

        function cveIdTag(cellvalue, options, rowObject){
            var tag = "";

            if(cellvalue!=undefined){
                tag = "<a href='https://web.nvd.nist.gov/view/vuln/detail?vulnId="+cellvalue+"' class='urlLink' target='_blank'>"+cellvalue+"</a>";
            }

            return tag;
        }

        function unCveIdTag(cellvalue, options, rowObject){
            return cellvalue;
        }

    </script>
</th:block>