<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<th:block th:fragment="contentScript">
    <script th:inline="javascript">
        //<![CDATA[
        /*global $ */
        /*jslint browser: true, nomen: true */
        var userRole = [[${sessUserInfo.authority}]];
        var curIdenStatus = [[${project.verificationStatus}]];
        curIdenStatus = curIdenStatus||"";
        var projectStatus = [[${project.status}]];
        var modifyCommentId = '';
        var commentIdx = '';
        var verified = [[${project.statusVerifyYn}]];
        verified = (verified != "N" ? true : false);
        var isAdmin = [[${@CommonFunction.isAdmin()}]];
        var $editor;
        var gStatus = "";
        var tempHandler = "";
        var distributionStatus = [[${project.destributionStatus}]];
        var deleteFileList = new Array();
        var isAndroid = [[${project.androidFlag}]];
        var appendReadOnlyFlag = false;
        var commentsParam = {referenceId : [[${project.prjId}]], referenceDiv : 'prj'};

        $(document).ready(function () {
            'use strict';
            $('.select2').select2();
            datas.init();
            evt.init();
            packaging.init();
            fn.displayProjectInfo();
            
            // 버튼 컨트롤
            fn.btnCtl(userRole, curIdenStatus);
            $("#editor2").summernote({height: 200, minHeight: null, maxHeight: null, lang: "ko-KR"});
            
            $("#list").jqGrid({
                datatype: 'local',
                data: datas.ossList,
                colNames: ['ID_KEY', 'ID', 'refComponentId', 'Reference', 'OSS ID', 'OSS Name', 'OSS<br/>Version', 'Download Location', 'Homepage', 'License', 'Path of source code in the OSS Package', 'File Count'],
                colModel: [
                    {name: 'componentId', index: 'componentId', width: 40, align: 'center', key: true, hidden: true},
                    {name: 'componentIdx', index: 'componentIdx', width: 40, align: 'center'},
                    {name: 'refComponentId', index: 'referenceDiv', width: 40, align: 'center', hidden: true},
                    {name: 'referenceDiv', index: 'referenceDiv', width: 40, align: 'center', editable: false},
                    {name: 'ossId', index: 'ossId', width: 150, align: 'left', hidden: true},
                    {name: 'ossName', index: 'ossName', width: 150, align: 'left', editable: false},
                    {name: 'ossVersion', index: 'ossVersion', width: 50, align: 'left', editable: false},
                    {name: 'downloadLocation', index: 'downloadLocation', width: 70, formatter:fn_grid_com.displayDownloadLocation, unformatter:fn_grid_com.unformatter, align: 'left', editable: false},
                    {name: 'homepage', index: 'homepage', width: 70, align: 'left', formatter: 'link2', editable: false},
                    {name: 'licenseName', index: 'licenseName', width: 150, align: 'left', editable: false},
                    {name: 'filePath', index: 'filePath', width: 250, align: 'left', editable: true, formatter: fn.textBox, unformat: fn.unformatterTextBox},
                    {name: 'verifyFileCount', index: 'verifyFileCount', width: 50, align: 'left', editable: false}
                ],
                rowNum: [[${@CommonFunction.getCoConstDefVal('DISP_PAGENATION_MAX')}]],
                editurl: 'clientArray',
                autowidth: true,
                pager: '#pager',
                gridview: true,
                sortable: function (permutation) {
                },
                viewrecords: true,
                sortorder: 'desc',
                height: 'auto',
                toppager: true,
                loadComplete: function () {
                	var permission = [[${project.statusPermission}]] == 1;
                	
                	if (permission && "CONF" != curIdenStatus) {
                		// load후 filepath editmode로 변경
                        var $this = $(this), ids = $this.jqGrid('getDataIDs'), i, l = ids.length;

                        for (i = 0; i < l; i++) {
                            $this.jqGrid('editRow', ids[i], false); // 	true로 변경하면 엔터키 입력시 saverow되어버림
                        }
                	}
                	
                	if ($("#list_toppager_left").find('button').length == 0) {
                		var appendHtml = "<dlv class=\"d-flex\">";
                    	appendHtml += "<button type=\"button\" class=\"btn btn-sm btn-grid-light-gray float-left ml-1\" title=\"Export Path\" onclick=\"fn.exportPath()\"><i class=\"fas fa-download\"></i></button>";
                    	appendHtml += "<button type=\"button\" class=\"btn btn-sm btn-grid-light-gray float-left ml-1\" title=\"Upload Path\" onclick=\"fn.uploadPath("+permission+")\">";
                    	if (!permission || "CONF" == curIdenStatus) {
                    		appendHtml += "<i class=\"fas fa-upload gridIconDisabled\"></i></button>";
                    	} else {
                    		appendHtml += "<i class=\"fas fa-upload\"></i></button>";
                    	}
                        appendHtml += "<span class=\"d-flex-align mr-3\" style=\"margin-left: auto;\">* Enter the path info of source code for each OSS and click the Verify button</span></div>";
                        
                        $("#list_toppager_left").append(appendHtml);
                    }
                }
            });
            
            $('#list').closest(".ui-jqgrid-bdiv").children(":first").css({"max-height": "500px"});
            $("#list").jqGrid('navGrid', "#pager", {add: false, edit: false, del: false, search: false, refresh: false});

            if (typeof datas.ossList !== "undefined" && datas.ossList != null && datas.ossList.length < 1) {
                $("[name='btnSavePath']").hide();
                $(".packageSelect").prop("disabled", true);
                
                if (isAdmin && $("#div_approve")) {
                    $("#div_approve").hide();
                } else if (datas.ossList.length > 1) {
            		if ($(".warningPop").length > 0 && "CONF" != curIdenStatus
                            && (!$('input[name=fileSeq_1]') || $('input[name=fileSeq_1]').val() == "")) {
                        	
                        	if (!alertify.warningPopDialog) {
            					alertify.dialog('warningPopDialog', function() {
            						return {
            							setup: function() {
            								var settings = alertify.confirm().settings;
            								
            								for (var prop in settings) {
            									this.settings[prop] = settings[prop];
            								}
            								
            								var setup = alertify.confirm().setup();
            								return setup;
            							},
            						    hooks: {
            						    	onshow: function() {
            						        	this.elements.dialog.style.maxWidth = 'none';
            						          	this.elements.dialog.style.width = '650px';
            						        }
            							}
            						};
            					}, false, 'confirm');
                        	}	
                        	
                    	alertify.warningPopDialog($(".warningPop").html(), function (){});
                  	}
            	}
            }

            if (userRole == "ROLE_USER") {
                if (curIdenStatus && curIdenStatus != "PROG" && curIdenStatus != "NA") {
                    $(".editYn").attr("readonly", true);
                    $(".editYn").css("background-color", "#f3f6f8");
                    $('#editor2').summernote('disable');
                }
            } else {
                if (curIdenStatus == "CONF") {
                    $(".editYn").attr("readonly", true);
                    $(".editYn").css("background-color", "#f3f6f8");
                    $('#editor2').summernote('disable');
                    appendReadOnlyFlag = true;
                }
            }

            if ("N" == [[${ossNotice.editNoticeYn}]]) {
            	$('#editor2').summernote('disable');
            }

            $("#docType > [value^='noticeDownload']").trigger("change");

            com_fn.tabInit();

            // 20210617_autoVerify Change Alert ADD
            $("input:checkbox[name='autoVerify']").change(function () {
                if ($("input:checkbox[name='autoVerify']").is(":checked") == true) {
                    alertify.alert([[#{msg.project.upload.verify}]], function () {});
                }
            });
            
            $("[id^=tabMenu]").on("click", function() {
        		var tabId = $(this).attr("id");
        		tabId = tabId.replace("tabMenu", "");
        		
        		if ("Packaging" == tabId && datas.ossList.length < 1) {
    				alertify.alert([[#{msg.project.verification.confirm.package}]], function(){
    					$("#tabMenuNotice").click();
    					if ('CONF' == curIdenStatus) $("#save").hide();
    				});
    			} else if("Notice" == tabId && isAndroid == "Y") {
    				$("#tabMenuPackaging").click();
    				fn.saveOrGetNotice('previewOnly');
    			}
        		
        		if ("Packaging" == tabId) {
        			$("#save").hide();
        			$("#btnSavePath").show();
        			$("#verify").show();
        			$("#girdAreaPackaging").show();
        		} else {
        			$("#verify").hide();
        			$("#btnSavePath").hide();
        			$("#save").show();
        			$("#girdAreaPackaging").hide();
        		}
        	});
        });

        var datas = {
            verify: [[${verify}]],
            ossList: [[${ossList}]],
            init: function () {
            	if (datas.ossList == null) datas.ossList = new Array();
            	
                modifyCommentId = datas.verify.data.commentIdx;
                commentIdx = datas.verify.data.commentIdx;
                if (isAdmin) {
                    if ("Y" == [[${project.withoutVerifyYn}]]) {
                        $("#approve").prop("checked", true);
                    } else {
                        $("#approve").prop("checked", false);
                    }

                    $("#approve").click(function () {
                        if ($("#approve").is(":checked")) {
                            $("input[name=withoutVerifyYn]").val($("#approve").val());
                        } else {
                            $("input[name=withoutVerifyYn]").val("N");
                        }
                    });

                    $("#ignoreBinaryDb").click(function () {
                        if ($("#ignoreBinaryDb").is(":checked")) {
                            $("input[name=ignoreBinaryDbFlag]").val($("#ignoreBinaryDb").val());
                        } else {
                            $("input[name=ignoreBinaryDbFlag]").val("N");
                        }
                    });
                } else {
                    $("input[name=withoutVerifyYn]").val("N");
                }
/*
                if ($("[name='fileSeq_1']").val()) {
                    $("#fileUplWarnMessage_1").hide();
                } else {
                    $("#fileUplWarnMessage_1").show();
                }

                if ($("[name='fileSeq_2']").val()) {
                    $("#fileUplWarnMessage_2").hide();
                } else {
                    $("#fileUplWarnMessage_2").show();
                }

                if ($("[name='fileSeq_3']").val()) {
                    $("#fileUplWarnMessage_3").hide();
                } else {
                    $("#fileUplWarnMessage_3").show();
                }
*/
                fn.appendEditVisible($("#append"));
                fn.initNotice();

                $("#deleteFlag").val("N");
                
                commentsParam.height = $(window).height() - 120;
                fn_comment.getCommentList(commentsParam);
            }
        }


        var evt = {
            uploadStatus: false,
            init: function () {
            	$('#wgetUrl').hide();
                $('.OKcolse').click(function () {
                    $('#blind_wrap').hide();
                    $('.warningPop').hide();
                });
				
                $('#registFile_1').uploadFile({
                    url: '/project/verification/registFile?prjId=' + datas.verify.data.prjId + '&fileSeq=1&permission=' + [[${project.statusPermission}]],
                    multiple: false,
                    dragDrop: true,
                    fileName: 'myfile',
                    onSuccess: function (e, data) {
                        var result = jQuery.parseJSON(data);

                        if (result[0] != "UNSUPPORTED_FILE" && result[0] != "NOT_PERMISSION") {
                            result.forEach(function (item) {
                                var appendHtml = '<br>' + item[0].createdDate;
                                var _url = '/download/' + item[0].registSeq + '/' + item[0].fileName;
                                var uploadFileTag = '<li><a class="ajax-file-upload-filename" href="' + _url + '">' + item[0].originalFilename + '</a><input type="hidden" value="' + item[0].registSeq + '"/>';
                                uploadFileTag += '<span class="badge bg-danger uploadFile1" style="cursor:pointer;" onclick="fn.deleteFile(this,\'' + item[0].registSeq + '\', \'1\')">X</span>' + appendHtml + '</li>';

                                $('.ajax-file-upload-statusbar').fadeOut('slow');
                                $('.ajax-file-upload-statusbar').remove();
                                $('.uploadList_1 ul').append(uploadFileTag);
                                $('input[name=fileSeq_1]').val(item[0].registSeq);
                            });

                            $('.verifyFile_1').hide();
                            $("#uploadAdd_1").show();
                            $("#uploadRemove_1").hide();
                            if (!$('.uploadList_1').is("visible")) $('.uploadList_1').show();

                            // verified 초기화
                            verified = false;

                            evt.uploadStatus = true;

                            fn.autoVerify();
                        } else {
                            $('.ajax-file-upload-statusbar').fadeOut('slow');
                            $('.ajax-file-upload-statusbar').remove();
                            alertify.alert(result[1], function () {});
                        }
                    },
                });

                $('#registFile_2').uploadFile({
                    url: '/project/verification/registFile?prjId=' + datas.verify.data.prjId + '&fileSeq=2&permission=' + [[${project.statusPermission}]],
                    multiple: false,
                    dragDrop: true,
                    fileName: 'myfile',
                    onSuccess: function (e, data) {
                        var result = jQuery.parseJSON(data);

                        if (result[0] != "UNSUPPORTED_FILE" && result[0] != "NOT_PERMISSION") {
                            result.forEach(function (item) {
                                var appendHtml = '<br>' + item[0].createdDate;
                                var _url = '/download/' + item[0].registSeq + '/' + item[0].fileName;
                                var uploadFileTag = '<li><a class="ajax-file-upload-filename" href="' + _url + '">' + item[0].originalFilename + '</a><input type="hidden" value="' + item[0].registSeq + '"/>';
                                uploadFileTag += '<span class="badge bg-danger uploadFile2" style="cursor:pointer;" onclick="fn.deleteFile(this,\'' + item[0].registSeq + '\', \'2\')">X</span>' + appendHtml + '</li>';

                                $('.uploadList_2 ul').append(uploadFileTag);
                                $('input[name=fileSeq_2]').val(item[0].registSeq);
                                $('.ajax-file-upload-statusbar').fadeOut('slow');
                                $('.ajax-file-upload-statusbar').remove();
                                // $("#fileUplWarnMessage_2").hide();
                            });

                            $('.verifyFile_2').hide();
                            $("#uploadAdd_2").show();
                            $("#uploadRemove_2").hide();
                            if (!$('.uploadList_2').is("visible")) $('.uploadList_2').show();

                            // verified 초기화
                            verified = false;

                            evt.uploadStatus = true;

                            fn.autoVerify();
                        } else {
                            $('.ajax-file-upload-statusbar').fadeOut('slow');
                            $('.ajax-file-upload-statusbar').remove();
                            alertify.alert(result[1], function () {});
                        }
                    },
                });

                $('#registFile_3').uploadFile({
                    url: '/project/verification/registFile?prjId=' + datas.verify.data.prjId + '&fileSeq=3&permission=' + [[${project.statusPermission}]],
                    multiple: false,
                    dragDrop: true,
                    fileName: 'myfile',
                    onSuccess: function (e, data) {
                        var result = jQuery.parseJSON(data);
                        
                        if (result[0] != "UNSUPPORTED_FILE" && result[0] != "NOT_PERMISSION") {
                            result.forEach(function (item) {
                                var appendHtml = '<br>' + item[0].createdDate;
                                var _url = '/download/' + item[0].registSeq + '/' + item[0].fileName;
                                var uploadFileTag = '<li><a class="ajax-file-upload-filename" href="' + _url + '">' + item[0].originalFilename + '</a><input type="hidden" value="' + item[0].registSeq + '"/>';
                                uploadFileTag += '<span class="badge bg-danger uploadFile3" style="cursor:pointer;" onclick="fn.deleteFile(this,\'' + item[0].registSeq + '\', \'3\')">X</span>' + appendHtml + '</li>';

                                $('.uploadList_3 ul').append(uploadFileTag);
                                $('input[name=fileSeq_3]').val(item[0].registSeq);
                                $('.ajax-file-upload-statusbar').fadeOut('slow');
                                $('.ajax-file-upload-statusbar').remove();
                                // $("#fileUplWarnMessage_3").hide();
                            });

                            $('.verifyFile_3').hide();
                            $("#uploadRemove_3").hide();
                            if (!$('.uploadList_3').is("visible")) $('.uploadList_3').show();

                            // verified 초기화
                            verified = false;

                            evt.uploadStatus = true;

                            fn.autoVerify();
                        } else {
                            $('.ajax-file-upload-statusbar').fadeOut('slow');
                            $('.ajax-file-upload-statusbar').remove();
                            alertify.alert(result[1], function () {});
                        }
                    },
                });
                
                $("#btnChangePathCancel").click(function () {
                    $("#changePathPop").hide();
                    $("#blind_wrap").hide();
                });

              	//upload Verification File
                var accept = '';
                var fileAccept = [[${@CoCodeManager.getCodeDtls(@CommonFunction.getCoConstDefVal("CD_FILE_ACCEPT"))}]];
                for (var i in fileAccept) {
                    if ('18' == fileAccept[i].cdDtlNo) {
                        accept = fileAccept[i].cdDtlExp;
                    }
                }

                $('#verificationFile').uploadFile({
                    url: '/project/verification/uploadVerification',
                    multiple: false,
                    dragDrop: true,
                    fileName: 'myfile',
                    allowedTypes: accept,
                    onSubmit: function (files) {
                        onAjaxLoadingHide = true;
                    },
                    onError: function (files, status, errMsg, pd) {
                        onAjaxLoadingHide = false;
                    },
                    onCancel: function (files, pd) {
                        onAjaxLoadingHide = false;
                    },
                    onSuccess: function (e, data) {
                        $('.ajax-file-upload-statusbar').fadeOut('slow');
                        $('.ajax-file-upload-statusbar').remove();

                        if (data.isValid == 'false') {
                            alertify.error([[#{msg.common.valid2}]], 0);
                        } else {
                            var result = data.resultData;
                            var target = $('#list');

                            for (var i = 0; i < result.length; i++) {
                                target.jqGrid("setCell", result[i].componentId, "filePath", result[i].filePath);
                            }

                            target.jqGrid().trigger('reloadGrid');

                            $("#changePathPop").hide();
                            $("#blind_wrap").hide();
                        }
                    }
                });
                
              	//oss bom list 가 없으면 export, verify, fileupload 숨김
                if (typeof datas.ossList !== "undefined" && datas.ossList != null && datas.ossList.length < 1) {
                	$("#tabMenuNotice").trigger("click");
                    $("#packageBtn").hide();
                    if ([[${project.verificationStatus}]] != 'CONF' && [[${project.dropYn}]] != 'Y' && ([[${@CommonFunction.isAdmin()}]] || [[${project.viewOnlyFlag}]] == 'N')) {
                    	$("#noticeBtn").show();
                    }
                }
                
                //Verify 프로세스
                $("[name='verify']").on('click', function () {
                	if (com_fn.checkStatus()) {
                		fn.verify();
                	} else {
                		alertify.alert('Status of the project is being changed by another user. Please contact the reviewer for detailed information.', function(){});
                	}
                });

                /**
                 Oss Notice Event Handler (FullCustom)
                 **/
                $('input[id*="companyNameFull"]').on('blur', function () {
                    var value = $(this).val();

                    $('input[id*="companyNameFull"]').val(value);
                });
                $('input[id*="companyNameShort"]').on('blur', function () {
                    var value = $(this).val();

                    $('input[id*="companyNameShort"]').val(value);
                });
                $('input[id*="distributionSiteUrl"]').on('blur', function () {
                    var value = $(this).val();

                    $('input[id*="distributionSiteUrl"]').val(value);
                });
                $('input[id*="email"]').on('blur', function () {
                    var value = $(this).val();

                    $('input[id*="email"]').val(value);
                });
                $('#useCompanyNameTitle').on('click', function () {
                    var checked = $(this).attr('checked');

                    if (!checked) {
                        $("div.useCompanyNameTitle").hide();
                    } else {
                        $("div.useCompanyNameTitle").show();
                    }
                });
                $('#distributedOtherCompany').on('click', function () {
                    var checked = $(this).attr('checked');

                    if (!checked) {
                        $("div.distributedOtherCompany").hide();
                    } else {
                        $("div.distributedOtherCompany").show();
                    }
                });
                $('#mergedOtherOssNotice').on('click', function () {
                    var checked = $(this).attr('checked');

                    if (!checked) {
                        $("div.mergedOtherOssNotice").hide();
                    } else {
                        $("div.mergedOtherOssNotice").show();
                    }
                });
                $('#accompaniedSourceCode').on('click', function () {
                    var checked = $(this).attr('checked');

                    if (!checked) {
                        $("div.accompaniedSourceCode").hide();
                    } else {
                        $("div.accompaniedSourceCode").show();
                    }
                });

                //다운로드 허용 플래그
                // Allow users to download check event
                $('[name^="chkAllowDownload"]').on('change', function () {
                    var targetid = $(this).data('targetid');

                    $('#' + targetid).val($(this).is(':checked') ? 'Y' : 'N');
                });

                // verConfirm 버튼
                $('#verConfirm').click(function (e) {
                	if (com_fn.checkStatus()){
                		e.preventDefault();

                        if (fn.checkVerify()) {
                            alertify.error([[#{msg.project.required.verify}]]);

                            return false;
                        }

                        if ($("#append").prop("checked")) {
     						$('#noticeForm input[name=appendedTEXT]').val($($("#editor2").summernote("code")).text());
     						$('#noticeForm input[name=appended]').val($("#editor2").summernote("code"));
                        }

                        $("#editCompanyName").attr("disabled", false);
                        $("#editOssDistributionSite").attr("disabled", false);
                        $("#editEmail").attr("disabled", false);

                        $('#noticeForm').ajaxForm({
                            url: '/project/verification/noticeAjax?confirm=conf',
                            type: 'POST',
                            dataType: "text",
                            cache: false,
                            success: function (data) {
                                var result = jQuery.parseJSON(data);

                                if (result.isValid == 'false') {
                                    alertify.error([[#{msg.common.valid2}]], 0);
                                } else {
                                    reloadTabInframe('/project/list');
                                    loading.hide();

                                    var checkedFlag = $("[name='btnEditOssNotice']:checked").val() == "Y";
                                    fn.defaultNotice(checkedFlag);

                                    alertify.alert([[#{msg.common.success}]], function () {
                                        deleteTabInFrame('/project/verification/' + [[${project.prjId}]]);
                                        activeTabInFrameList("PROJECT");
                                    });
                                }
                            },
                            error: function (data) {
                                loading.hide();
                                alertify.error([[#{msg.common.valid2}]], 0);
                            }
                        }).submit();
                	} else {
                		alertify.alert('Status of the project is being changed by another user. Please contact the reviewer for detailed information.', function(){});
                	}
                });

                // verReject 버튼
                $('#verReject').click(function (e) {
                	if (com_fn.checkStatus()){
                		e.preventDefault();

                        if (distributionStatus == "PROC") {
                            var comment = [[#{msg.project.distribution.loading}]];

                            alertify.error(comment, 0);

                            return false;
                        }

                        var innerHtml 	= 'Are you sure you want to reject?<br>';
                        innerHtml 		+= '<textarea id="editor3"></textarea>';
                        
                        if(!alertify.verRejectDialog){
    						alertify.dialog('verRejectDialog', function() {
    							return {
    								setup: function() {
    									var settings = alertify.confirm().settings;
    									
    									for (var prop in settings) {
    										this.settings[prop] = settings[prop];
    									}
    									
    									var setup = alertify.confirm().setup();
    									setup.focus.element = 0;
    									
    									return setup;
    								},
    							    hooks: {
    							    	onshow: function() {
    							        	this.elements.dialog.style.maxWidth = 'none';
    							          	this.elements.dialog.style.width = '650px';
    							        }
    								}
    							};
    						}, false, 'confirm');
                    	}
                        
                        alertify.verRejectDialog(innerHtml, function () {
     						if ("" == $("#editor3").summernote('code')){
     							alertify.alert([[#{msg.project.required.comments}]], function(){});

    							return false;
     						} else {
                            	var data = {
                                	"prjId": [[${project.prjId}]]
                                	, "verificationStatus": "PROG"
                                	, "useCustomNoticeYn": "N"
                                	, "userComment": $("#editor3").summernote('code')
                                	, "referenceDiv": "12"
                                	, "noticeFileFormat": $("#noticeFileFormat").val()
                            	};

                            	fn.exeProjectStatus(data, "PROG");
    						}
                        });
                        
                        $("#editor3").summernote({height: 200, minHeight: null, maxHeight: null, lang: "ko-KR"});
                	} else {
                		alertify.alert('Status of the project is being changed by another user. Please contact the reviewer for detailed information.', function(){});
                	}
                });

                // verRequest 버튼
                $('#verRequest').click(function (e) {
                	if (com_fn.checkStatus()){
                		e.preventDefault();

                        if (fn.checkVerify()) {
                            alertify.error([[#{msg.project.required.verify}]]);

                            return false;
                        }

                        gStatus = "REQ";
                        tempHandler = e;

                        $("#save").trigger("click");
                	} else {
                		alertify.alert('Status of the project is being changed by another user. Please contact the reviewer for detailed information.', function(){});
                	}
                });

                // verReviewStart 버튼
                $('#verReviewStart').click(function (e) {
                	if (com_fn.checkStatus()) {
                		e.preventDefault();

                        var data = {
                            "prjId": [[${project.prjId}]]
                            , "verificationStatus": "REV"
                            , "useCustomNoticeYn": $('#useCustomNoticeYn').val()
                            , "userComment": [[${project.userComment}]]
                            , "referenceDiv": "12"
                            , "noticeFileFormat": $("#noticeFileFormat").val()
                        };

                        fn.exeProjectStatus(data, "REV");
                	} else {
                		alertify.alert('Status of the project is being changed by another user. Please contact the reviewer for detailed information.', function(){});
                	}
                });

                $('#btnReadme').click(function (e) {
                    e.preventDefault();

                    var fileNm = $("#readmeFile").val();
                    var downloadFlag = $(this).hasClass("btn-outline-primary");

                    if (downloadFlag) {
                        location.href = '/project/verification/downloadFile?prjId=' + [[${project.prjId}]] + '&fileNm=' + fileNm;
                    }
                });

                $('#btnProprietary').click(function (e) {
                    e.preventDefault();

                    var fileNm = $("#exceptFile").val();
                    var downloadFlag = $(this).hasClass("btn-outline-primary");

                    if (downloadFlag) {
                        location.href = '/project/verification/downloadFile?prjId=' + [[${project.prjId}]] + '&fileNm=' + fileNm;
                    }
                });

                $('#btnVerifyFileContent').click(function (e) {
                    e.preventDefault();

                    var fileNm = $("#verifyFile").val();
                    var downloadFlag = $(this).hasClass("btn-outline-primary");

                    if (downloadFlag) {
                        location.href = '/project/verification/downloadFile?prjId=' + [[${project.prjId}]] + '&fileNm=' + fileNm;
                    }
                });

                //wgetUrl send
                $('#send_1').on('click', function () {
                    var wgetUrl = $("#sendWgetUrl_1").val();
                    var obj = {
                        prjId: [[${project.prjId}]],
                        wgetUrl: wgetUrl
                    };

                    $.ajax({
                        url: '/project/verification/wgetUrl',
                        type: 'POST',
                        dataType: 'json',
                        contentType: 'application/json',
                        cache: false,
                        data: JSON.stringify(obj),
                        success: function (json) {
                            var result = JSON.parse(json);
                            var resultCode = result[0][0].wgetResult;

                            if (resultCode == 0) {
                                result.forEach(function (item) {
                                	var appendHtml = '<br>' + item[0].createdDate;
                                    var _url = '/download/' + item[0].registSeq + '/' + item[0].fileName;
                                    var uploadFileTag = '<li><a class="ajax-file-upload-filename" href="' + _url + '">' + item[0].originalFilename + '</a>';
                                    uploadFileTag += '<span class="badge bg-danger" style="cursor:pointer;" onclick="fn.deleteFile(this,\'' + item[0].registSeq + '\', \'1\')">X</span>' + appendHtml + '</li>';

                                    $('.uploadList_1 ul').append(uploadFileTag);
                                    $('input[name=fileSeq_1]').val(item[0].registSeq);
                                    $('.ajax-file-upload-statusbar').fadeOut('slow');
                                    $('.ajax-file-upload-statusbar').remove();
                                    $("#wgetUrl_1").hide();
                                    // $("#fileUplWarnMessage_1").hide();
                                });

                                $('.verifyFile_1').hide();
                                $("#uploadAdd_1").show();
								$("#sendWgetUrl_1").val("");
                                
                                if (!$('.uploadList_1').is("visible")) $('.uploadList_1').show();
                            } else {
                                alertify.error([[#{msg.common.valid2}]], 0);
                            }
                        },
                        error: function (data) {
                            alertify.error([[#{msg.common.valid2}]], 0);
                        }
                    });
                });

                $('#send_2').on('click', function () {
                    var wgetUrl = $("#sendWgetUrl_2").val();
                    var obj = {
                        prjId: [[${project.prjId}]],
                        wgetUrl: wgetUrl
                    };

                    $.ajax({
                        url: '/project/verification/wgetUrl',
                        type: 'POST',
                        dataType: 'json',
                        contentType: 'application/json',
                        cache: false,
                        data: JSON.stringify(obj),
                        success: function (json) {
                            var result = JSON.parse(json);
                            var resultCode = result[0][0].wgetResult;

                            if (resultCode == 0) {
                                result.forEach(function (item) {
                                	var appendHtml = '<br>' + item[0].createdDate;
                                    var _url = '/download/' + item[0].registSeq + '/' + item[0].fileName;
                                    var uploadFileTag = '<li><a class="ajax-file-upload-filename" href="' + _url + '">' + item[0].originalFilename + '</a>';
                                    uploadFileTag += '<span class="badge bg-danger" style="cursor:pointer;" onclick="fn.deleteFile(this,\'' + item[0].registSeq + '\', \'2\')">X</span>' + appendHtml + '</li>';
                                	
                                    $('.uploadList_2 ul').append(uploadFileTag);
                                    $('input[name=fileSeq_2]').val(item[0].registSeq);
                                    $('.ajax-file-upload-statusbar').fadeOut('slow');
                                    $('.ajax-file-upload-statusbar').remove();
                                    $("#wgetUrl_2").hide();
                                    // $("#fileUplWarnMessage_2").hide();
                                });

                                $('.verifyFile_2').hide();
                                $("#uploadAdd_2").show();
                                $("#uploadRemove_2").hide();
								$("#sendWgetUrl_2").val("");
                                
                                if (!$('.uploadList_2').is("visible")) $('.uploadList_2').show();
                            } else {
                                alertify.error([[#{msg.common.valid2}]], 0);
                            }
                        },
                        error: function (data) {
                            alertify.error([[#{msg.common.valid2}]], 0);
                        }
                    });
                });

                $('#send_3').on('click', function () {
                    var wgetUrl = $("#sendWgetUrl_3").val();
                    var obj = {
                        prjId: [[${project.prjId}]],
                        wgetUrl: wgetUrl
                    };

                    $.ajax({
                        url: '/project/verification/wgetUrl',
                        type: 'POST',
                        dataType: 'json',
                        contentType: 'application/json',
                        cache: false,
                        data: JSON.stringify(obj),
                        success: function (json) {
                            var result = JSON.parse(json);
                            var resultCode = result[0][0].wgetResult;

                            if (resultCode == 0) {
                                result.forEach(function (item) {
                                	var appendHtml = '<br>' + item[0].createdDate;
                                    var _url = '/download/' + item[0].registSeq + '/' + item[0].fileName;
                                    var uploadFileTag = '<li><a class="ajax-file-upload-filename" href="' + _url + '">' + item[0].originalFilename + '</a>';
                                    uploadFileTag += '<span class="badge bg-danger" style="cursor:pointer;" onclick="fn.deleteFile(this,\'' + item[0].registSeq + '\', \'3\')">X</span>' + appendHtml + '</li>';

                                    $('.uploadList_3 ul').append(uploadFileTag);
                                    $('input[name=fileSeq_3]').val(item[0].registSeq);
                                    $('.ajax-file-upload-statusbar').fadeOut('slow');
                                    $('.ajax-file-upload-statusbar').remove();
                                    $("#wgetUrl_3").hide();
                                    // $("#fileUplWarnMessage_3").hide();
                                });

                                $('.verifyFile_3').hide();
                                $("#uploadRemove_3").hide();
                                $("#sendWgetUrl_3").val("");
                                
                                if (!$('.uploadList_3').is("visible")) $('.uploadList_3').show();
                            } else {
                                alertify.error([[#{msg.common.valid2}]], 0);
                            }
                        },
                        error: function (data) {
                            alertify.error([[#{msg.common.valid2}]], 0);
                        }
                    });
                });
                // [Pakage Document Download START]
                $('#packageDocDownload').click(function (e) {
                    var type = $('#docType option:selected').val();

                    if (type == 'noticeDownload') {
                        fn.downloadNotice();
                    } else if (type == 'noticeTextDownload') {
                        fn.downloadNoticeText();
                    } else if (type == 'noticeSimpleDownload') {
                        fn.downloadNoticeSimple();
                    } else if (type == 'noticeTextSimpleDownload') {
                        fn.downloadNoticeTextSimple();
                    } else if (type == 'spdxSpreadSheet') {
                        fn.downloadSpdxSpreadSheetExcel();
                    } else if (type == 'spdxRdf') {
                        fn.downloadSpdxRdf();
                    } else if (type == 'spdxTag') {
                        fn.downloadSpdxTag();
                    } else if (type == 'spdxJson') {
                        fn.downloadSpdxJson();
                    } else if (type == 'spdxYaml') {
                        fn.downloadSpdxYaml();
                    }
                });

                $('#chkUseCustomNotice').change(function (e) {
                    if ($(this).is(':checked')) {
                        // Use Custom Notice 값 설정
                        $('#useCustomNoticeYn').val('Y');

                        // Notice Editor 버튼 활성화
                        $('#noticeEditor').prop('disabled', false);
                        $('#noticeEditor').css('opacity', 1);
                        $("[name='btnEditOssNotice']").attr("disabled", true);

                        fn.defaultNotice(false);
                    } else {
                        // Use Custom Notice 값 설정
                        $('#useCustomNoticeYn').val('N');

                        // Notice Editor 버튼 활성화
                        $('#noticeEditor').prop('disabled', true);
                        $('#noticeEditor').css('opacity', 0.5);
                        $("[name='btnEditOssNotice']").attr("disabled", false);

                        var checked = ($("[name='btnEditOssNotice']:checked").val() == "Y");
                        fn.defaultNotice(checked);
                    }
                });

                $('#noticeEditor').click(function (e) {
                    fn.saveOrGetNotice('editor');
                });

                // noticePreview 버튼
                $('#noticePreview').click(function (e) {
                    e.preventDefault();

                    fn.saveOrGetNotice('preview');
                });

                $('#noticeDownload').click(function (e) {
                    e.preventDefault();

                    fn.downloadNotice();

                    return false;
                });

                //notice text download
                $('#noticeTextDownload').click(function (e) {
                    e.preventDefault();

                    fn.downloadNoticeText();

                    return false;
                });

                $('#noticeSimpleDownload').click(function (e) {
                    e.preventDefault();

                    fn.downloadNoticeSimple();

                    return false;
                });
                $('#noticeTextSimpleDownload').click(function (e) {
                    e.preventDefault();

                    fn.downloadNoticeTextSimple();

                    return false;
                });

                $('#spdxSpreadSheet').click(function (e) {
                    fn.downloadSpdxSpreadSheetExcel();
                });

                $('#spdxRdf').click(function (e) {
                    fn.downloadSpdxRdf();
                });

                $('#spdxTag').click(function (e) {
                    fn.downloadSpdxTag();
                });

                $('#spdxJson').click(function (e) {
                    fn.downloadSpdxJson();
                });

                $('#spdxYaml').click(function (e) {
                    fn.downloadSpdxYaml();
                });
                //// [Pakage Document Download END]

                $("#append").click(function (e) {
                    var checked = $(this).prop("checked");
                    $("#editAppendedYn").val(checked ? "Y" : "N");
                    fn.appendEditVisible(this);
                });

                $("[name='btnEditOssNotice']").change(function (e) {
                    var checked = ($("[name='btnEditOssNotice']:checked").val() == "Y");
                    $("#editNoticeYn").val(checked ? "Y" : "N");
                    fn.defaultNotice(checked);
                });

                $("#companyName").click(function (e) {
                    var checked = $(this).prop("checked");
                    $("#editCompanyYn").val(checked ? "Y" : "N");
                    $("#editCompanyName").attr("disabled", !checked);
                });

                $("#ossDistributionSite").click(function (e) {
                    var checked = $(this).prop("checked");
                    $("#editDistributionSiteUrlYn").val(checked ? "Y" : "N");
                    $("#editOssDistributionSite").attr("disabled", !checked);
                });

                $("#email").click(function (e) {
                    var checked = $(this).prop("checked");
                    $("#editEmailYn").val(checked ? "Y" : "N");
                    $("#editEmail").attr("disabled", !checked);
                });

                $("#hideOssVersion").click(function (e) {
                    var checked = $(this).prop("checked");
                    $("#hideOssVersionYn").val(checked ? "Y" : "N");
                });

                $("#uploadAdd_1").click(function (e) {
                	if (!$("[name='btnSavePath']").is(":visible")) {
                		alertify.alert([[${@CommonFunction.getMessageForDisabled('msg.project.warn.edit.disabled', project.identificationStatus, 'identification')}]], function(){});
            			return false;
                	}
                	
                    $(".multiSet > div:eq(1)").prev().show();
                    $(".multiSet > div:eq(1)").show();
                    $("#registFileDiv_2").attr("style", "display: block;");
                    $("#uploadAdd_1").hide();
                    $("#uploadRemove_2").show();
                    $("input[name='packageFileType2']").val("1");
					fn.disabledSelect();
                });

                $("#uploadAdd_2").click(function (e) {
                	if (!$("[name='btnSavePath']").is(":visible")) {
                		alertify.alert([[${@CommonFunction.getMessageForDisabled('msg.project.warn.edit.disabled', project.identificationStatus, 'identification')}]], function(){});
            			return false;
                	}
                	
                    $(".multiSet > div:eq(2)").show();
                    $("#registFileDiv_3").attr("style", "display: block;");
                    $("#uploadAdd_2").hide();
                    $("#uploadRemove_3").show();
                    $("input[name='packageFileType3']").val("1");
					fn.disabledSelect();
                });

                $("#uploadRemove_1").click(function (e) {
                	var fileSeq2 = $('input[name=fileSeq_2]').val();
                    var fileSeq3 = $('input[name=fileSeq_3]').val();
                   
                    if ("" != fileSeq2 && "" != fileSeq3) {
                    	var fileType2 = $('input[name=packageFileType2]').val();
                    	var fileType3 = $('input[name=packageFileType3]').val();
                    	
                    	$("#uploadRemove_1").hide();
                        $("#uploadAdd_1").hide();

                        var html = $('.uploadList_2 ul li').html();
                        $('.uploadList_1 ul').append('<li>' + html.split("'2'").join("'1'") + '</li>');
                        $('input[name=fileSeq_1]').val($('input[name=fileSeq_2]').val());
                        $('input[name=packageFileType1]').val(fileType2);

                        $('.verifyFile_1').hide();
                        // $("#fileUplWarnMessage_1").hide();
                        $(".uploadList_2 > ul > li > span > .smallDelete").trigger("click");
                        $(".uploadList_1").find("span").removeClass("uploadFile2");
                        $(".uploadList_1").find("span").addClass("uploadFile1");
                        $(".uploadFile1").attr('onclick', "fn.deleteFile(this, \""+ $('input[name=fileSeq_2]').val() +"\", \"1\")");
                        
                        $("#uploadRemove_2").hide();
                        $("#uploadAdd_2").hide();
                        
                        var html = $('.uploadList_3 ul li').html();
                        $('.uploadList_2 ul').empty();
                        $('.uploadList_2 ul').append('<li>' + html.split("'3'").join("'2'") + '</li>');
                        $('input[name=fileSeq_2]').val($('input[name=fileSeq_3]').val());
                        $('input[name=packageFileType2]').val(fileType3);
                        
                        $('.verifyFile_2').hide();
                        // $("#fileUplWarnMessage_2").hide();
                        $(".uploadList_3 > ul > li > span > .smallDelete").trigger("click");
                        $(".uploadList_2").find("span").removeClass("uploadFile3");
                        $(".uploadList_2").find("span").addClass("uploadFile2");
                        $(".uploadFile2").attr('onclick', "fn.deleteFile(this, \""+ $('input[name=fileSeq_3]').val() +"\", \"2\")");
                        
                        $('input[name=fileSeq_3]').val("");
                        $('input[name=packageFileType3]').val("");
                        $(".multiSet > div:eq(2)").hide();
                    } else {
                    	if ("" != fileSeq2) {
                    		var fileType2 = $('input[name=packageFileType2]').val();
                    		
                    		$("#uploadRemove_1").hide();
                            $("#uploadAdd_1").hide();

                            var html = $('.uploadList_2 ul li').html();
                            $('.uploadList_1 ul').append('<li>' + html.split("'2'").join("'1'") + '</li>');
                            $('input[name=fileSeq_1]').val($('input[name=fileSeq_2]').val());
                            $('input[name=packageFileType1]').val(fileType2);
                            $('input[name=fileSeq_2]').val("");
                            $('input[name=packageFileType2]').val("");
                            
                            $('.verifyFile_1').hide();
                            // $("#fileUplWarnMessage_1").hide();
                            $(".uploadList_2 > ul > li > span > .smallDelete").trigger("click");
                            $(".uploadList_1").find("span").removeClass("uploadFile2");
                            $(".uploadList_1").find("span").addClass("uploadFile1");
                            $(".uploadFile1").attr('onclick', "fn.deleteFile(this, \""+ $('input[name=fileSeq_2]').val() +"\", \"1\")");
                            
                            $("#uploadRemove_2").hide();
                            $("#uploadAdd_2").hide();
                            
                            $(".multiSet > div:eq(1)").hide();
                    	}
                    }
                });

                $("#uploadRemove_2").click(function (e) {
                    var fileSeq = $('input[name=fileSeq_3]').val();
					
                    if ("" == fileSeq) {
                    	$('input[name=packageFileType2]').val("");
                        $(".multiSet > div:eq(1)").hide();
                        $("#uploadAdd_1").show();
                    } else {
                    	$("#uploadRemove_2").hide();
                        $("#uploadAdd_2").hide();

                        var html = $('.uploadList_3 ul li').html();
                        $('.uploadList_2 ul').empty();
                        $('.uploadList_2 ul').append('<li>' + html.split("'3'").join("'2'") + '</li>');
                        $('input[name=fileSeq_2]').val($('input[name=fileSeq_3]').val());
                        $('input[name=packageFileType2]').val($('input[name=packageFileType3]').val());
                        
                        $('.verifyFile_2').hide();
                        // $("#fileUplWarnMessage_2").hide();
                        $(".uploadList_3 > ul > li > span > .smallDelete").trigger("click");
                        $(".uploadList_2").find("span").removeClass("uploadFile3");
                        $(".uploadList_2").find("span").addClass("uploadFile2");
                        $(".uploadFile2").attr('onclick', "fn.deleteFile(this, \""+ $('input[name=fileSeq_3]').val() +"\", \"2\")");
                        
                        $('input[name=fileSeq_3]').val("");
                        $('input[name=packageFileType3]').val("");
                        $(".multiSet > div:eq(2)").hide();
                    }

                });

                $("#uploadRemove_3").click(function (e) {
                	$('input[name=packageFileType3]').val("");
                    $(".multiSet > div:eq(2)").hide();
                    $("#uploadAdd_2").show();
                });
                
                setTimeout(function() {
                	fn.disabledSelect();
                }, 300);
            }
        }

        var fn = {
        		disabledSelect : function() {
    				if ([[${project.statusPermission}]] != 1 || "CONF" == [[${project.verificationStatus}]]) {
                    	$("input[name='myfile']").prop("disabled", true);
                    	$("input[name='myfile']").parent().parent().addClass("custom-select-disabled");
                    	$("input[name='myfile']").parent().parent().css('pointer-events', 'none');
                	}
    			},
    			save : function () {
    				if (com_fn.checkStatus()){
    					hideErrMsg();
                        fn.saveOrGetNotice('save');
    				} else {
    					alertify.alert('Status of the project is being changed by another user. Please contact the reviewer for detailed information.', function(){});
    				}
    			},
    			savePath : function () {
    				if (com_fn.checkStatus()) {
    					gridCleanErrMsg("list"); // 기존 error message 삭제
                        var target = $('#list');
                        var arr = [];
                        arr = target.jqGrid('getDataIDs');

                        for (var i in arr) {
                            target.jqGrid('saveRow', arr[i]);
                        }

                        var filePaths = [];
                        var componentIds = [];

                        // empty check
                        for (var i in arr) {
                            var _path = target.jqGrid('getCell', arr[i], 'filePath');
                            var _componentId = target.jqGrid('getCell', arr[i], 'componentId');

                            filePaths.push(_path);
                            componentIds.push(_componentId);
                        }

                        // edit mode 원복
                        for (var i in arr) {
                            target.jqGrid('editRow', arr[i], true);
                        }

                        var fileSeqs = [];
                        var fileTypeSeqs = [];

                        if ($('input[name=fileSeq_1]').val() != '') {
                            fileSeqs.push($('input[name=fileSeq_1]').val());
                        }

                        if ($('input[name=fileSeq_2]').val() != '') {
                            fileSeqs.push($('input[name=fileSeq_2]').val());
                        }

                        if ($('input[name=fileSeq_3]').val() != '') {
                            fileSeqs.push($('input[name=fileSeq_3]').val());
                        }
                        
                        if ($('input[name="packageFileType1"]').val() != '') {
                        	fileTypeSeqs.push($('input[name="packageFileType1"]').val());
                        }
                        
                        if ($('input[name="packageFileType2"]').val() != '') {
                        	fileTypeSeqs.push($('input[name="packageFileType2"]').val());
                        }
                        
                        if ($('input[name="packageFileType3"]').val() != '') {
                        	fileTypeSeqs.push($('input[name="packageFileType3"]').val());
                        }
                        
                        var obj = {
                            prjId: [[${project.prjId}]],
                            gridFilePaths: filePaths,
                            gridComponentIds: componentIds,
                            fileSeqs: fileSeqs,
                            fileTypeSeqs: fileTypeSeqs,
                            deleteFlag: $("#deleteFlag").val(),
                            statusVerifyYn: (deleteFileList.length > 0 ? "Y" : $("#verifyFlag").val()),
                            deleteFiles: (deleteFileList.length > 0 ? "Y" : "N")
                        }

                        $.ajax({
                            url: '/project/verification/savePath',
                            type: 'POST',
                            dataType: 'json',
                            contentType: 'application/json',
                            cache: false,
                            data: JSON.stringify(obj),
                            timeout: 1000 * 60 * 10,
                            success: function (json) {
                                loading.hide();

                                if (json.isValid == 'false') {
                                    alertify.error([[#{msg.common.valid2}]], 0);
                                } else {
                                    alertify.alert([[#{msg.common.success}]], function () {
                                    	deleteTabInFrame("/project/verification/" + [[${project.prjId}]]);
                                        createTabInFrame([[${project.prjId}]] + '_Packaging', '/project/verification/' + [[${project.prjId}]]);
                                    });
                                }
                            },
                            error: function (data) {
                                loading.hide();
                                alertify.error([[#{msg.common.valid2}]], 0);
                            }
                        });
    				} else {
    					
    				}
    			},
    			getProjectStatus : function () {
            		$.ajax({
            			url : "/project/getProjectStatus",
            			type : 'POST',
            			data : JSON.stringify({"prjId" : [[${project.prjId}]]}),
            			dataType : 'json',
            			cache : false,
            			async : false,
            			contentType : 'application/json',
            			success : function(data){
            				displayInfo = data;
            			},
            			error : function(){
            				alertify.error([[#{msg.common.valid2}]], 0);
            			}
            		});
            	},
        		displayProjectInfo : function() {
        			fn.getProjectStatus();
        			
        			var display = "";
        			
        			var pNm = [[${project.prjName}]];
        			var pVer = [[${project.prjVersion}]];
        			if ("" != pVer && pVer != null) pNm += " (" + pVer + ")";
        			
        			// project name
        			var prjName = "<span class=\"description-percentage text-dark-gray\">";
					prjName += "<a class=\"text-dark-gray text-bold hover-line urlLink\" style=\"cursor: pointer;\" onclick=\"fn.mvEditTab(" + [[${project.prjId}]] + ")\" title=\"" + pNm + "\">" + pNm + "</a></span>";
					display += prjName;
        			
        			// status
        			var status = "<span class=\"ml-2\"> | </span>";
        			var projectStatus = displayInfo.projectStatus;
        			
        			switch(projectStatus){
        			case 'REQ':
        				status += "<span class=\"text-pink text-bold ml-2\">Request</span>";

        				break;
        			case 'REV':
        				status += "<span class=\"text-yellow text-bold ml-2\">Review</span>";

        				break;
        			case 'DROP':
        				status += "<span class=\"text-gray text-bold ml-2\">Drop</span>";

        				break;
        			case 'FREV':
        				status += "<span class=\"text-purple text-bold ml-2\">Final Review</span>";

        				break;
        			case 'COMP':
        				status += "<span class=\"text-dark-blue text-bold ml-2\">Complete</span>";

        				break;
        			default:
        				status += "<span class=\"text-success text-bold ml-2\">Progress</span>";

        				break;
        			}
        			display += status;
        			
        			// osc progress
        			var identificationStatus = [[${project.identificationStatus}]];
        			identificationStatus = identificationStatus||"";
        			var verificationStatus = [[${project.verificationStatus}]];
        			verificationStatus = verificationStatus||"";
        			var statusRequestYn = [[${project.statusRequestYn}]];
        			statusRequestYn = statusRequestYn||"";
        			
        			var oscProgress = "<span class=\"ml-2\"> | </span>";
        			if ("" != identificationStatus) {
        				if ("DROP" == projectStatus) {
        					if ("CONF" == identificationStatus) {
        						oscProgress += '<span class="badge badge-gray size-sm width-6rem px-1 ml-2">Identification</span>';
        					} else {
        						oscProgress += '<span class="badge badge-outline-gray-white size-sm width-6rem px-1 ml-2">Identification</span>';
        					}
        				} else if ("FREV" == projectStatus) {
        					oscProgress += "<span class=\"badge badge-outline-dark-blue hover-light-btn size-sm width-6rem px-1 ml-2\" style=\"cursor:pointer;\" onclick=\"fn.mvIdentification()\">Identification</span>";
        				} else {
        					if ("CONF" == identificationStatus) {
        						oscProgress += "<span class=\"badge badge-outline-dark-blue hover-light-btn size-sm width-6rem px-1 ml-2\" style=\"cursor:pointer;\" onclick=\"fn.mvIdentification()\">Identification</span>";
        					} else if ("PROG" == projectStatus) {
        						oscProgress += "<span class=\"badge badge-success hover-success-btn size-sm width-6rem px-1 ml-2\" style=\"cursor:pointer;\" onclick=\"fn.mvIdentification()\">Identification</span>";
        					} else if ("REQ" == projectStatus) {
        						oscProgress += "<span class=\"badge badge-pink hover-pink-btn size-sm width-6rem px-1 ml-2\" style=\"cursor:pointer;\" onclick=\"fn.mvIdentification()\">Identification</span>";
        					} else if ("REV" == projectStatus) {
        						oscProgress += "<span class=\"badge badge-yellow hover-yellow-btn size-sm width-6rem px-1 ml-2\" style=\"cursor:pointer;\" onclick=\"fn.mvIdentification()\">Identification</span>";
        					}
        				}
        			} else {
        				if ("DROP" == projectStatus) {
        					oscProgress += '<span class="badge badge-success hover-success-btn size-sm width-6rem px-1 ml-2">Identification</span>';
        				} else {
        					oscProgress += "<span class=\"badge badge-success hover-success-btn size-sm width-6rem px-1 ml-2\" style=\"cursor:pointer;\" onclick=\"fn.mvIdentification()\">Identification</span>";
        				}
        			}
        			
        			if ("CONF" != identificationStatus) {
        				oscProgress += '<span class="text-gray-white text-bold text-md ml-2">&gt;</span>';
        				oscProgress += '<span class="badge badge-outline-gray-white size-sm width-6rem px-1 ml-2">Packaging</span>';
        			} else {
        				oscProgress += '<span class="text-blue-gray text-bold text-md ml-2">&gt;</span>';
        				if ("DROP" == projectStatus) {
        					if ("CONF" == verificationStatus) {
        						oscProgress += '<span class="badge badge-gray size-sm width-6rem px-1 ml-2">Packaging</span>';
        					} else {
        						oscProgress += '<span class="badge badge-outline-gray-white size-sm width-6rem px-1 ml-2">Packaging</span>';
        					}
        				} else {
        					if ("" == verificationStatus) {
        						if ("COMP" == projectStatus || "Y" == statusRequestYn) {
        							oscProgress += '<span class="badge badge-outline-gray-white size-sm width-6rem px-1 ml-2">Packaging</span>';
        						} else if ("" != identificationStatus) {
        							oscProgress += "<span class='badge badge-success hover-success-btn size-sm width-6rem px-1 ml-2 customShadow' style='cursor:pointer;' onclick=\"fn.mvVerification()\">Packaging</span>";
        						}
        					} else if ("PROG" == verificationStatus) {
        						if ("COMP" == projectStatus || "Y" == statusRequestYn) {
        							oscProgress += '<span class="badge badge-outline-gray-white size-sm width-6rem px-1 ml-2">Packaging</span>';
        						} else {
        							oscProgress += "<span class='badge badge-success hover-success-btn size-sm width-6rem px-1 ml-2 customShadow' style='cursor:pointer;' onclick=\"fn.mvVerification()\">Packaging</span>";
        						}
        					} else if ("REV" == verificationStatus) {
        						oscProgress += "<span class='badge badge-yellow hover-yellow-btn size-sm width-6rem px-1 ml-2 customShadow' style='cursor:pointer;' onclick=\"fn.mvVerification()\">Packaging</span>";
        					} else if ("REQ" == verificationStatus) {
        						oscProgress += "<span class='badge badge-pink hover-pink-btn size-sm width-6rem px-1 ml-2 customShadow' style='cursor:pointer;' onclick=\"fn.mvVerification()\">Packaging</span>";
        					} else if ("NA" == verificationStatus || "DROP" == verificationStatus) {
        						oscProgress += '<span class="badge badge-outline-gray-white size-sm width-6rem px-1 ml-2">Packaging</span>';
        					} else {
        						if ("CONF" == verificationStatus) {
        							oscProgress += "<span class='badge badge-outline-dark-blue hover-light-btn size-sm width-6rem px-1 ml-2 customShadow' style='cursor:pointer;' onclick=\"fn.mvVerification()\">Packaging</span>";
        						} else {
        							if ("NA" == [[${project.distributeTarget}]]) {
        								oscProgress += '<span class="badge badge-outline-gray-white size-sm width-6rem px-1 ml-2">Packaging</span>';
        							} else {
        								if ("PROG" == projectStatus) {
        									oscProgress += "<span class='badge badge-success hover-success-btn size-sm width-6rem px-1 ml-2 customShadow' style='cursor:pointer;' onclick=\"fn.mvVerification()\">Packaging</span>";
        								} else if ("REQ" == projectStatus) {
        									oscProgress += "<span class='badge badge-pink hover-pink-btn size-sm width-6rem px-1 ml-2 customShadow' style='cursor:pointer;' onclick=\"fn.mvVerification()\">Packaging</span>";
        								} else if ("REV" == projectStatus) {
        									oscProgress += "<span class='badge badge-yellow hover-yellow-btn size-sm width-6rem px-1 ml-2 customShadow' style='cursor:pointer;' onclick=\"fn.mvVerification()\">Packaging</span>";
        								} else if ("FREV" == projectStatus) {
        									oscProgress += "<span class='badge badge-outline-dark-blue hover-light-btn size-sm width-6rem px-1 ml-2 customShadow' style='cursor:pointer;' onclick=\"fn.mvVerification()\">Packaging</span>";
        								}
        							}
        						}
        					}
        				}
        			}
        			
        			display += oscProgress;
        			
        			// vulnerability score
        			var standardScore = [[${@CoCodeManager.getCodeExpString(@CommonFunction.getCoConstDefVal('CD_SECURITY_VULNERABILITY_SCORE'), @CommonFunction.getCoConstDefVal('CD_SECURITY_VULNERABILITY_DETAIL_SCORE'))}]];
        			var vulnerability = "<span class=\"ml-2\"> | </span>";
        			
        			var cvssScoreMax = displayInfo.cvssScoreMax;
        			if (typeof displayInfo.vulnerabilityResolution !== "undefined") {
        				var vulnerabilityResolution = displayInfo.vulnerabilityResolution;
        				if ("Need to resolve" == vulnerabilityResolution) {
        					vulnerability += '<span type="button" class="badge badge-dark-gray size-sm width-9rem px-1 ml-2" onclick=\"fn.mvSecurity()\">' + vulnerabilityResolution + '('+cvssScoreMax+')</span>';
        				} else {
        					if (cvssScoreMax - standardScore >= 0) {
            					vulnerability += '<span type="button" class="badge badge-cerebral-gray size-sm width-9rem px-1 ml-2" onclick=\"fn.mvSecurity()\">' + vulnerabilityResolution + '('+cvssScoreMax+')</span>';
        					} else {
            					vulnerability += '<span type="button" class="badge badge-cerebral-gray size-sm width-9rem px-1 ml-2">Discovered('+cvssScoreMax+')</span>';
        					}
        				}
        			} else {
        				if (typeof cvssScoreMax !== "undefined") {
        					vulnerability += '<span type="button" class="badge badge-cerebral-gray size-sm width-9rem px-1 ml-2">Discovered(' + cvssScoreMax + ')</span>';
        				} else {
        					vulnerability += '<span type="button" class="badge badge-cerebral-gray size-sm width-9rem px-1 ml-2">Discovered(N/A)</span>';
        				}
        			}
        			
        			display += vulnerability;
        			$("#displayProjectInfo").html(display);
        			
        			if ($(".goToEditLink").width() > 300) {
        				$(".goToEditLink").addClass("ellipsis");
        			}
        	},
        	mvEditTab : function(prjId){
        		createTabInFrame(prjId+'_Project', '/project/edit/'+prjId);
        	},
        	mvIdentification : function() {
        		if ("Y" == [[${project.androidFlag}]]) {
    				createTabInFrame([[${project.prjId}]]+"_Identify", "/project/identification/" + [[${project.prjId}]] + "/4");
    			} else {
    				createTabInFrame([[${project.prjId}]]+"_Identify", "/project/identification/" + [[${project.prjId}]] + "/5");
    			}
        	},
        	mvVerification : function() {
        		createTabInFrame([[${project.prjId}]] + "_Packaging", "/project/verification/" + [[${project.prjId}]]);
        	},
        	mvSecurity : function() {
        		createTabInFrame([[${project.prjId}]] + "_Security", "/project/security/" + [[${project.prjId}]]);
        	},
            deleteFile: function (element, fileSeq, i) {
                $('input[name=fileSeq_' + i + ']').val('');

                var fileSeq_1 = $("[name='fileSeq_1']").val();
              	var fileSeq_2 = $("[name='fileSeq_2']").val();
              	var fileSeq_3 = $("[name='fileSeq_3']").val();

                $('.verifyFile_' + i).show();
                $("#uploadAdd_" + i).hide();
				
                if (!(fileSeq_1 == "" && fileSeq_2 == "" && fileSeq_3 == "")) {
                	$("#uploadRemove_" + i).show();
                }
                
//             	if (!(fileSeq_1 == "" && fileSeq_2 == "" && fileSeq_3 == "")) {
//              	$("#uploadRemove_" + i).show();
//             	}

                // Packaging에서 OSS Package를 다시 올릴 때 UI 개선
                // file이 지워지고 실제로 save를 하지 않은 시점부터도 readme, proprietary, Path or File을 hide 시킴.
                $("#verifyBtnSet").hide();
                $("#verifyFlag").val("N");
                // $("#fileUplWarnMessage_" + i).show();

                $(".uploadList_" + i).empty();
                
                var selectedOption = $("select[name='selectOption_"+i+"']").prop("selected", true).val();
                if ("1" == selectedOption) {
                	$("#registFileDiv_" + i).parent().show();
                    $("#registFileDiv_" + i).css("display", "block");
                } else if ("2" == selectedOption) {
                	$("#sendWgetUrl_" + i).parent().parent().show();;
                	$("#sendWgetUrl_" + i).show();
                } else {
                	$("#projectSearch_" + i).show();
                }
                
                deleteFileList.push(i);
            },
            onRegistSuccess: function (json, status) {
            	$("#noticeFileFormat").prop("disabled", true);
            	
            	var checkedFlag = $("[name='btnEditOssNotice']:checked").val() == "Y";
                fn.defaultNotice(checkedFlag);
            	
                if (json.isValid == 'false') {
                    alertify.error([[#{msg.common.valid}]], 0);
                    createValidMsgComplex(json);

                    $.each(json, function (key, value) {
                        if ("isValid" != key && "validMsg" != key) {
                            if ($('input[name*=' + key + ']').length > 0) {
                                $('input[name*=' + key + ']').next("span").next("span.retxt,div.retxt").html(value).show();
                            }
                        }
                    });

                    loading.hide();
                } else {
                	loading.hide();
                	
                    if (!$("#companyName").prop("checked")) {
                        $("#editCompanyName").attr("disabled", true);
                    }

                    if (!$("#ossDistributionSite").prop("checked")) {
                        $("#editOssDistributionSite").attr("disabled", true);
                    }
                    if (!$("#email").prop("checked")) {
                        $("#editEmail").attr("disabled", true);
                    }

                    if (gStatus == "REQ") {
                        gStatus = ""; // global status clear
                        fn.procRequest(tempHandler);
                        tempHandler = ""; // temp clear
                    } else {
                        alertify.alert([[#{msg.common.success}]], function () {
                        	deleteTabInFrame("/project/verification/" + [[${project.prjId}]]);
							createTabInFrame([[${project.prjId}]] + '_Packaging', "/project/verification/1/" + [[${project.prjId}]]);
                        });
                    }
                }
            },
            btnCtl: function (role, status) {
//			206 CONF	Confirm
//			206 NA		N/A
//			206 PROG	Progress
//			206 REQ		Request
//			206 REV		Review
				var targetId = $("#menu-tab").find(".active").attr("aria-controls");
				
                // 상태에 따른 버튼 컨트롤
                var btn_div = $(".projdecBtn");
                var btn_confirm = $("#verConfirm");
                var btn_reject = $("#verReject");
                var btn_review = $("#verRequest");
                var btn_restart = $("#verReviewStart");
                var btn_save = $("#save");
                var btn_verify = $("#verify");
                var btn_savePath = $("#btnSavePath");
                var verFileUploder = $(".packageSelect");

                status = status||"";
                btn_div.show();
                if (role == "ROLE_ADMIN") { // 관리자 권한 일 경우
                	$("#approve").attr("disabled", false);
                	
                    switch (status) {
                        case "":
                            btn_confirm.hide();
                            btn_reject.hide();
                            btn_review.show();
                            btn_restart.hide();
                            if ("notice" == targetId) {
                            	btn_save.show();
                            }
                            if ("notice" != targetId) {
                            	btn_verify.show();
                            }
                            if ("notice" != targetId) {
                            	btn_savePath.show();
                            }
                            verFileUploder.prop("disabled", false);

                            break;
                        case "PROG":
                            btn_confirm.hide();
                            btn_reject.hide();
                            btn_review.show();
                            btn_restart.hide();
                            if ("notice" == targetId) {
                            	btn_save.show();
                            }
                            if ("notice" != targetId) {
                            	btn_verify.show();
                            }
                            if ("notice" != targetId) {
                            	btn_savePath.show();
                            }
                            verFileUploder.prop("disabled", false);

                            break;
                        case "REQ":
                            btn_confirm.hide();
                            btn_reject.hide();
                            btn_review.hide();
                            btn_restart.show();
                            if ("notice" == targetId) {
                            	btn_save.show();
                            }
                            if ("notice" != targetId) {
                            	btn_verify.show();
                            }
                            if ("notice" != targetId) {
                            	btn_savePath.show();
                            }
                            verFileUploder.prop("disabled", false);
                            
                            break;

                        case "REV":
                            btn_confirm.show();
                            btn_reject.removeClass("btn-lg-red");
                            btn_reject.addClass("btn-outline-lg-red");
                            btn_reject.show();
                            btn_review.hide();
                            btn_restart.hide();
                            if ("notice" == targetId) {
                            	btn_save.show();
                            }
                            if ("notice" != targetId) {
                            	btn_verify.show();
                            }
                            if ("notice" != targetId) {
                            	btn_savePath.show();
                            }
                            verFileUploder.prop("disabled", false);
                            
                            break;

                        case "CONF":
                            btn_confirm.hide();
                            btn_reject.show();
                            btn_review.hide();
                            btn_restart.hide();
                            if ("notice" == targetId) {
                            	btn_save.hide();
                            }
                            if ("notice" != targetId) {
                            	btn_verify.show();
                            }
                            if ("notice" != targetId) {
                            	btn_savePath.hide();
                            }
                            verFileUploder.prop("disabled", true);

                            // 고지문구 버튼 비활성
                            $('#chkUseCustomNotice').prop('disabled', true);
                            $('#noticeEditor').prop('disabled', true);
                            $('#noticeEditor').css('opacity', 0.5);
                            
                            break;

                    }
                } else if ('Y' == [[${project.viewOnlyFlag}]]) {
                    btn_confirm.hide();
                    btn_reject.hide();
                    btn_review.hide();
                    btn_restart.hide();
                    btn_save.hide();
                    btn_savePath.hide();
                    verFileUploder.prop("disabled", true);
                } else {	// 일반 사용자 일 경우
                    switch (status) {
                        case "":
                            btn_review.show();
                            btn_confirm.hide();
                            btn_reject.hide();
                            btn_restart.hide();
                            if ("notice" == targetId) {
//                            	btn_save.show();
                            }
                            if ([[${project.statusPermission}]] == 1) {
                            	verFileUploder.prop("disabled", false);
                            } else {
                            	verFileUploder.prop("disabled", true);
                            }
                            break;
                        case "PROG":
                            btn_review.show();
                            btn_confirm.hide();
                            btn_reject.hide();
                            btn_restart.hide();
                            if ("notice" == targetId) {
//                            	btn_save.show();
                            }
                            if ([[${project.statusPermission}]] == 1) {
                            	verFileUploder.prop("disabled", false);
                            } else {
                            	verFileUploder.prop("disabled", true);
                            }
                            break;

                        case "REQ":
                            btn_confirm.hide();
                            btn_reject.show();
                            btn_review.hide();
                            btn_restart.hide();
                            if ("notice" == targetId) {
                            	btn_save.hide();
                            }
                            verFileUploder.prop("disabled", true);
                            break;

                        case "REV":
                            btn_confirm.hide();
                            btn_reject.removeClass("btn-lg-red");
                            btn_reject.hide();
                            btn_review.hide();
                            btn_restart.hide();
                            if ("notice" == targetId) {
                            	btn_save.hide();
                            }
                            verFileUploder.prop("disabled", true);
                            break;

                        case "CONF":
                            btn_confirm.hide();
                            btn_reject.show();
                            btn_review.hide();
                            btn_restart.hide();
                            if ("notice" == targetId) {
                            	btn_save.hide();
                            }
                            if ("notice" != targetId) {
                            	btn_savePath.hide();
                            }
                            verFileUploder.prop("disabled", true);
                            break;
                    }
                }
            },
            exeProjectStatus: function (data, status) {
                curIdenStatus = status;
                
                $.ajax({
                    url: '/project/updateProjectStatus',
                    type: 'POST',
                    data: JSON.stringify(data),
                    dataType: 'json',
                    cache: false,
                    contentType: 'application/json',
                    success: function (data) {
                        fn.btnCtl(userRole, status);
                        reloadTabInframe('/project/list');

                        alertify.alert([[#{msg.common.success}]], function () {
                        	deleteTabInFrame("/project/verification/" + [[${project.prjId}]]);
							createTabInFrame([[${project.prjId}]] + '_Packaging', "/project/verification/" + [[${project.prjId}]]);
                        });
                    },
                    error: function (data) {
                        alertify.error([[#{msg.common.valid2}]], 0);
                    }
                });
            },
            openPreviewPop: function (data) {
                var result = jQuery.parseJSON(data);

                if (result.isValid == 'false') {
                    alertify.error([[#{msg.common.valid2}]], 0);
                } else {
                    var noti = document.createElement('pre');

                    //custom style.
                    noti.style.maxHeight = "400px";
                    noti.style.overflowWrap = "break-word";
                    noti.style.margin = "-16px -16px -16px 0";
                    noti.style.paddingBottom = "24px";
                    noti.appendChild(document.createTextNode(result.resultData));

                    if(!alertify.openPreviewPop){
    					alertify.dialog('openPreviewPop', function() {
    						return {
    							setup: function() {
    								var settings = alertify.alert().settings;
    								
    								for (var prop in settings) {
    									this.settings[prop] = settings[prop];
    								}
    								
    								var setup = alertify.alert().setup();
									setup.focus.element = 1;
									
    								return setup;
    							},
							    hooks: {
							    	onshow: function() {
							        	this.elements.content.style.top = "57px";
							        }
								}
    						};
    					}, false, 'alert');
                	}
    				
    				alertify.openPreviewPop().set({'resizable': true, 'startMaximized':true, 'message':result.resultData}).show();
    				alertify.openPreviewPop().set({'resizable': false, 'startMaximized':false});

                    var checkedFlag = $("[name='btnEditOssNotice']:checked").val() == "Y";

                    if ($("#chkUseCustomNotice").prop("checked")) {
                        fn.defaultNotice(false);
                    } else {
                        fn.defaultNotice(checkedFlag);
                    }
                }
            },
            openNoticeEditPop: function (data) {
                var result = jQuery.parseJSON(data);

                if (result.isValid == 'false') {
                    alertify.error([[#{msg.common.valid2}]], 0);
                } else {
                	// prevent clicking the OK button on Enter
    				let keyCode;
    				$(document).on('keydown', function (event) {
    					keyCode = event.keyCode;
    				});
                	
                	var contents = '<textarea cols="80" id="noticeEditPop" name="noticeEditPop" rows="10"></textarea>';
        			alertify.confirm()
        					.set({'resizable': true, 'startMaximized':true}).resizeTo('650', '480')
        					.set('labels', {ok:'save'})
        					.set('onok', function(event){
        						// prevent clicking the OK button on Enter
        						if (typeof keyCode !== 'undefined' && keyCode == 13) {
        							keyCode = undefined;
        							return false;
        						}
        						
        						fn.saveNoticeEditPop();
        						return false;
        					})
        					.set('onshow', function(event){
        						$("#noticeEditPop").summernote({height: 700, minHeight: null, maxHeight: null, lang: "ko-KR"});
        						$("#noticeEditPop").summernote('code', result.resultData);
        					})
        					.setContent(contents)
        					.show();
					
					fn.defaultNotice(false);
                }
            },
            saveNoticeEditPop: function () {
                $('#noticeHtml').val($("#noticeEditPop").summernote('code'));

                $('#noticeForm').ajaxForm({
                    url: '/project/verification/saveNoticeAjax',
                    type: 'POST',
                    dataType: 'json',
                    cache: false,
                    success: function (data) {
                        loading.hide();
                        alertify.closeAll();

                        if (data.isValid == 'false') {
                            alertify.error([[#{msg.common.valid2}]], 0);
                        }
                    },
                    error: function (data) {
                        loading.hide();
                        alertify.closeAll();
                        alertify.error([[#{msg.common.valid2}]], 0);
                    }
                }).submit();
            },
            saveOrGetNotice: function (flag) {
                // 저장 : save, 프리뷰 : preview, 에디터 : editor
                var customUrl;
                var customDataType;
                var customSucess;
                var customError;

                if (flag == 'save') {
                    customUrl = '/project/verification/saveAjax';
                    customDataType = "json";
                    customSucess = fn.onRegistSuccess;
                    customError = function (data) {
                        if (!$("#companyName").prop("checked")) {
                            $("#editCompanyName").attr("disabled", true);
                        }

                        if (!$("#ossDistributionSite").prop("checked")) {
                            $("#editOssDistributionSite").attr("disabled", true);
                        }

                        if (!$("#email").prop("checked")) {
                            $("#editEmail").attr("disabled", true);
                        }

                        loading.hide();
                        alertify.error([[#{msg.common.valid2}]], 0);
                    }

                    if ($("#editCompanyName").val() != "") {
                        $("#editCompanyName").attr("disabled", false);
                    }

                    if ($("#editOssDistributionSite").val() != "") {
                        $("#editOssDistributionSite").attr("disabled", false);
                    }

                    if ($("#editEmail").val() != "") {
                        $("#editEmail").attr("disabled", false);
                    }
                } else if (flag == 'preview') {
                    customUrl = '/project/verification/noticeAjax';
                    customDataType = "text";
                    customSucess = fn.openPreviewPop;
                    customError = function (data) {
                        if (!$("#companyName").prop("checked")) {
                            $("#editCompanyName").attr("disabled", true);
                        }

                        if (!$("#ossDistributionSite").prop("checked")) {
                            $("#editOssDistributionSite").attr("disabled", true);
                        }

                        if (!$("#email").prop("checked")) {
                            $("#editEmail").attr("disabled", true);
                        }

                        loading.hide();
                        alertify.error([[#{msg.common.valid2}]], 0);
                    }

                    $("#editCompanyName").attr("disabled", false);
                    $("#editOssDistributionSite").attr("disabled", false);
                    $("#editEmail").attr("disabled", false);
                } else if (flag == 'previewOnly') {
                    customUrl = '/project/verification/noticeAjax';
                    customDataType = "text";
                    customSucess = fn.openPreviewPop;
                    customError = function (data) {
                        if (!$("#companyName").prop("checked")) {
                            $("#editCompanyName").attr("disabled", true);
                        }

                        if (!$("#ossDistributionSite").prop("checked")) {
                            $("#editOssDistributionSite").attr("disabled", true);
                        }

                        if (!$("#email").prop("checked")) {
                            $("#editEmail").attr("disabled", true);
                        }

                        loading.hide();
                        alertify.error([[#{msg.common.valid2}]], 0);
                    }

                    $("#editCompanyName").attr("disabled", false);
                    $("#editOssDistributionSite").attr("disabled", false);
                    $("#editEmail").attr("disabled", false);
                    $("#previewOnly").val("Y");
                } else if (flag == 'editor') {
                    customUrl = '/project/verification/noticeAjax';
                    customDataType = "text";
                    customSucess = fn.openNoticeEditPop;
                    customError = function (data) {
                        if (!$("#companyName").prop("checked")) {
                            $("#editCompanyName").attr("disabled", true);
                        }

                        if (!$("#ossDistributionSite").prop("checked")) {
                            $("#editOssDistributionSite").attr("disabled", true);
                        }

                        if (!$("#email").prop("checked")) {
                            $("#editEmail").attr("disabled", true);
                        }

                        loading.hide();
                        alertify.error([[#{msg.common.valid2}]], 0);
                    }

                    $("#editCompanyName").attr("disabled", false);
                    $("#editOssDistributionSite").attr("disabled", false);
                    $("#editEmail").attr("disabled", false);
                }

                if ($("#append").prop("checked")) {
					$("#editAppendedYn").val("Y");
                	
                	if ("" != $("#append").prop("checked")) {
                		$('#noticeForm input[name=appendedTEXT]').val($($("#editor2").summernote("code")).text());
     					$('#noticeForm input[name=appended]').val($("#editor2").summernote("code"));
                	}
                } else {
                	$("#editAppendedYn").val("N");
                	$("#editor2").summernote("code", '');
                	$('#noticeForm input[name=appendedTEXT]').val("");
                	$('#noticeForm input[name=appended]').val("");
                }

                $("#noticeFileFormat").prop("disabled", false);
                
                $('#noticeForm').ajaxForm({
                    url: customUrl,
                    type: 'POST',
                    dataType: customDataType,
                    cache: false,
                    success: customSucess,
                    error: customError
                }).submit();
            },
            handleUserCommentPopupOpen: function () {
                const param = {
                    "referenceDiv" : [[${@CommonFunction.getCoConstDefVal('CD_DTL_COMMENT_PACKAGING_USER')}]],
                    "referenceId" : [[${project.prjId}]]
                }
                getAjaxJsonData(param, "/comment/getDivUserComment", "html", function (res) {
                	if (!alertify.editDialog){
        				alertify.dialog('editDialog', function() {
        					return {
        						setup: function() {
        							var settings = alertify.confirm().settings;
        						
        							for (var prop in settings) {
        								this.settings[prop] = settings[prop];
        							}
        						
        							var setup = alertify.confirm().setup();
        							setup.buttons = [];
        							setup.focus.element = 0;
        						
        							return setup;
        						},
        				    	hooks: {
        				    		onshow: function() {
        				        		this.elements.dialog.style.maxWidth = 'none';
        				          		this.elements.dialog.style.width = '700px';
        				        	}
        						}
        					};
        				}, false, 'confirm');
            		}
        		
        			alertify.editDialog(res);
                    },
                    null,
                    function () {
                        $("#modifiedCommentInPjtEditor").summernote({
                            height: 180,
                            callbacks: {
                                onInit: function () {
                                    $(this).summernote('code', $("#userContents").val());
                                }
                            }
                        });
                    });
            },
            sendEditor: function (type) {
                //코멘트 저장
                var editorVal = replaceWithLink($("#modifiedCommentInPjtEditor").summernote('code'));

                if (!editorVal || editorVal == "") {
                    alertify.alert([[#{msg.project.enter.comment}]], function () {
                    });
                    return false;
                }
                var referenceId = [[${project.prjId}]]
                var param = {referenceId: referenceId, referenceDiv: [[${@CommonFunction.getCoConstDefVal('CD_DTL_COMMENT_PACKAGING_HIS')}]], contents: editorVal, mailSendType: type};

                $.ajax({
                    url: '/project/sendComment',
                    type: 'POST',
                    dataType: 'json',
                    cache: false,
                    data: param,
                    success: function (json) {
                        if (json.isValid == 'false') {
                            alertify.error([[#{msg.common.valid2}]], 0);
                        } else {
                            alertify.success([[#{msg.project.sent.comments.success}]]);
                            $("#modifiedCommentInPjtEditor").summernote('code', '');
                            $("#userContents").val('');
                            $('.ajs-close').trigger("click");
                            fn_comment.getCommentList(commentsParam);
                        }
                    },
                    error: function () {
                        alertify.error([[#{msg.common.valid2}]], 0);
                    }
                });
            },
            saveEditor: function () {
                //코멘트 임시저장
                var editorVal = replaceWithLink($("#modifiedCommentInPjtEditor").summernote('code'));

                var referenceId = [[${project.prjId}]]
                var param = {
                    referenceId: referenceId
                    , referenceDiv: [[${@CommonFunction.getCoConstDefVal('CD_DTL_COMMENT_PACKAGING_USER')}]]
                    , contents: editorVal
                };
                $.ajax({
                    url: "/project/saveComment",
                    type: "POST",
                    dataType: "json",
                    cache: false,
                    data: param,
                    success: function (json) {
                        if (json.isValid == 'false') {
                            alertify.error([[#{msg.common.valid2}]], 0);
                        } else {
                            alertify.success([[#{msg.common.success}]]);
                        }
                        $("#userContents").val(editorVal);
                        editDailog.close();
                    },
                    error: function () {
                        alertify.error([[#{msg.common.valid2}]], 0);
                    }
                });
            },
            editorDialog: function () {
                var editorVal = replaceWithLink($("#modifiedCommentInPjtEditor").summernote('code'));

                if (!editorVal || editorVal == "") {
                    alertify.alert([[#{msg.project.enter.comment}]], function () {
                    });
                    return false;
                }

                //launch it.
                var btnHtm = '<br/><b>Send an email to</b><br/>';
                btnHtm += '<input type="button" value="Watcher Only" class="btnCancel btnColor red" style="height:30px;width:100px;"onclick="fn.sendEditor(\'W\')"/>&nbsp;&nbsp;&nbsp;';

                if (userRole == "ROLE_ADMIN") {
                    btnHtm += '<input type="button" value="Creator Only" class="btnCancel btnColor red" style="height:30px;width:100px;"onclick="fn.sendEditor(\'C\')"/>&nbsp;&nbsp;&nbsp;';
                } else {
                    btnHtm += '<input type="button" value="Reviewer Only" class="btnCancel btnColor red" style="height:30px;width:100px;"onclick="fn.sendEditor(\'R\')"/>&nbsp;&nbsp;&nbsp;';
                }

                btnHtm += '<input type="button" value="All" class="btnCancel btnColor red" style="height:30px;width:120px;" onclick="fn.sendEditor(\'WR\')"/>&nbsp;&nbsp;&nbsp;';

                if (!alertify.myAlert) {
                    //define a new dialog
                    alertify.dialog('myAlert', function factory() {
                        return {
                            main: function (message) {
                                this.message = message;
                            },
                            setup: function () {
                                return {
                                    focus: {element: 0}
                                };
                            },
                            prepare: function () {
                                this.setContent(this.message);
                            }
                        }
                    });
                }
                alertify.myAlert(btnHtm);
            },

            // 업로드 화면 컨트롤
            changeSelectOption: function (target, activate) {
            	var name = $(target).attr("name");
                var value = $("[name='" + name + "'] option:selected").val();
                var key = name.split("_")[1];
            	
            	if (activate) {
                    switch (value) {
                        case "1":
                            var liCnt = $(".uploadList_1").find('li').length;
                            if (liCnt == 0) {
                            	$('#registFileDiv_' + key).parent().show();
                                $('#registFileDiv_' + key).show();
                            }

                            $('#wgetUrl_' + key).hide();
                            $('#projectSearch_' + key).hide();
                            $("input[name='packageFileType"+key+"']").val(value);
                            
                            break;
                        case "2":
                        	$('#registFileDiv_' + key).parent().hide();
                            $('#registFileDiv_' + key).hide();
                            $('#wgetUrl_' + key).show();
                            $('#projectSearch_' + key).hide();
                            $("input[name='packageFileType"+key+"']").val(value);
                            
                            break;
                        case "3":
                        	$('#registFileDiv_' + key).parent().hide();
                            $('#registFileDiv_' + key).hide();
                            $('#wgetUrl_' + key).hide();
                            $('#projectSearch_' + key).show();
                            $("input[name='packageFileType"+key+"']").val(value);
                            
                            switch (key) {
                                case "1":
                                    projectList_1.load();
                                    projectList_1.packagingLoad();

                                    break;
                                case "2":
                                    projectList_2.load();
                                    projectList_2.packagingLoad();

                                    break;
                                case "3":
                                    projectList_3.load();
                                    projectList_3.packagingLoad();

                                    break;
                                default:
                                    break;
                            }

                            break;
                        default:
                            break;
                    }
            	} else {
            		$("input[name='packageFileType"+key+"']").val(value);
            	}
            },

            downloadNotice: function () {
                if ($("#append").prop("checked")) {
                	$('#noticeForm input[name=appendedTEXT]').val($($("#editor2").summernote("code")).text());
 					$('#noticeForm input[name=appended]').val($("#editor2").summernote("code"));
                }

                $("#editCompanyName").attr("disabled", false);
                $("#editOssDistributionSite").attr("disabled", false);
                $("#editEmail").attr("disabled", false);
                $("#isSimpleNotice").val("N");

                $('#noticeForm').ajaxForm({
                    url: '/project/verification/makeNoticePreview',
                    type: 'POST',
                    dataType: "json",
                    cache: false,
                    success: function (data) {
                        if ("false" == data.isValid) {
                            alertify.error([[#{msg.common.valid2}]], 0);
                        } else {
                            window.location = '/project/verification/downloadNoticePreview?id=' + data.validMsg;

                            var checkedFlag = $("[name='btnEditOssNotice']:checked").val() == "Y";

                            fn.defaultNotice(checkedFlag);
                        }
                    },
                    error: function (data) {
                        loading.hide();
                        alertify.error([[#{msg.common.valid2}]], 0);
                    }
                }).submit();
            },

            downloadNoticeText: function () {
                if ($("#append").prop("checked")) {
                	$('#noticeForm input[name=appendedTEXT]').val($($("#editor2").summernote("code")).text());
 					$('#noticeForm input[name=appended]').val($("#editor2").summernote("code"));
                }

                $("#editCompanyName").attr("disabled", false);
                $("#editOssDistributionSite").attr("disabled", false);
                $("#editEmail").attr("disabled", false);
                $("#isSimpleNotice").val("N");

                $('#noticeForm').ajaxForm({
                    url: '/project/verification/makeNoticeText',
                    type: 'POST',
                    dataType: "json",
                    cache: false,
                    success: function (data) {
                        if ("false" == data.isValid) {
                            alertify.error([[#{msg.common.valid2}]], 0);
                        } else {
                            window.location = '/project/verification/downloadNoticePreview?id=' + data.validMsg;

                            var checkedFlag = $("[name='btnEditOssNotice']:checked").val() == "Y";

                            fn.defaultNotice(checkedFlag);
                        }
                    },
                    error: function (data) {
                        loading.hide();

                        alertify.error([[#{msg.common.valid2}]], 0);
                    }
                }).submit();
            },

            downloadNoticeSimple: function () {
                if ($("#append").prop("checked")) {
                	$('#noticeForm input[name=appendedTEXT]').val($($("#editor2").summernote("code")).text());
 					$('#noticeForm input[name=appended]').val($("#editor2").summernote("code"));
                }

                $("#editCompanyName").attr("disabled", false);
                $("#editOssDistributionSite").attr("disabled", false);
                $("#editEmail").attr("disabled", false);
                $("#isSimpleNotice").val("Y");

                $('#noticeForm').ajaxForm({
                    url: '/project/verification/makeNoticeSimple',
                    type: 'POST',
                    dataType: "json",
                    cache: false,
                    success: function (data) {
                        if ("false" == data.isValid) {
                            alertify.error([[#{msg.common.valid2}]], 0);
                        } else {
                            window.location = '/project/verification/downloadNoticePreview?id=' + data.validMsg;

                            var checkedFlag = $("[name='btnEditOssNotice']:checked").val() == "Y";

                            fn.defaultNotice(checkedFlag);
                        }
                    },
                    error: function (data) {
                        loading.hide();

                        alertify.error([[#{msg.common.valid2}]], 0);
                    }
                }).submit();
            },
            downloadNoticeTextSimple: function () {
                if ($("#append").prop("checked")) {
 					$('#noticeForm input[name=appendedTEXT]').val($($("#editor2").summernote("code")).text());
 					$('#noticeForm input[name=appended]').val($("#editor2").summernote("code"));
                }

                $("#editCompanyName").attr("disabled", false);
                $("#editOssDistributionSite").attr("disabled", false);
                $("#editEmail").attr("disabled", false);
                $("#isSimpleNotice").val("Y");

                $('#noticeForm').ajaxForm({
                    url: '/project/verification/makeNoticeTextSimple',
                    type: 'POST',
                    dataType: "json",
                    cache: false,
                    success: function (data) {
                        if ("false" == data.isValid) {
                            alertify.error([[#{msg.common.valid2}]], 0);
                        } else {
                            window.location = '/project/verification/downloadNoticePreview?id=' + data.validMsg;
                            var checkedFlag = $("[name='btnEditOssNotice']:checked").val() == "Y";
                            fn.defaultNotice(checkedFlag);
                        }
                    },
                    error: function (data) {
                        loading.hide();
                        alertify.error([[#{msg.common.valid2}]], 0);
                    }
                }).submit();
            },
            downloadSpdxSpreadSheetExcel: function () {
                var dataStr = JSON.stringify($('#noticeForm').serializeObject());

                $.ajax({
                    type: "POST",
                    url: '/spdxdownload/getSPDXPost',
                    data: JSON.stringify({"type": "spdx", "prjId": [[${project.prjId}]], "dataStr": dataStr}),
                    dataType: 'json',
                    cache: false,
                    contentType: 'application/json',
                    success: function (data) {
                        if ("false" == data.isValid) {
                            alertify.error([[#{msg.common.valid2}]], 0);
                        } else {
                            window.location = '/spdxdownload/getFile?id=' + data.validMsg;
                        }
                    },
                    error: function (data) {
                        alertify.error([[#{msg.common.valid2}]], 0);
                    }
                });
            },

            downloadSpdxRdf: function () {
                var dataStr = JSON.stringify($('#noticeForm').serializeObject());

                $.ajax({
                    type: "POST",
                    url: '/spdxdownload/getSPDXPost',
                    data: JSON.stringify({"type": "spdxRdf", "prjId": [[${project.prjId}]], "dataStr": dataStr}),
                    dataType: 'json',
                    cache: false,
                    contentType: 'application/json',
                    success: function (data) {
                        if ("false" == data.isValid) {
                            alertify.error([[#{msg.common.valid2}]], 0);
                        } else {
                            window.location = '/spdxdownload/getFile?id=' + data.validMsg;
                        }
                    },
                    error: function (data) {
                        alertify.error([[#{msg.common.valid2}]], 0);
                    }
                });
            },

            downloadSpdxTag: function () {
                var dataStr = JSON.stringify($('#noticeForm').serializeObject());

                $.ajax({
                    type: "POST",
                    url: '/spdxdownload/getSPDXPost',
                    data: JSON.stringify({"type": "spdxTag", "prjId": [[${project.prjId}]], "dataStr": dataStr}),
                    dataType: 'json',
                    cache: false,
                    contentType: 'application/json',
                    success: function (data) {
                        if ("false" == data.isValid) {
                            alertify.error([[#{msg.common.valid2}]], 0);
                        } else {
                            window.location = '/spdxdownload/getFile?id=' + data.validMsg;
                        }
                    },
                    error: function (data) {
                        alertify.error([[#{msg.common.valid2}]], 0);
                    }
                });
            },

            downloadSpdxJson: function () {
                var dataStr = JSON.stringify($('#noticeForm').serializeObject());

                $.ajax({
                    type: "POST",
                    url: '/spdxdownload/getSPDXPost',
                    data: JSON.stringify({"type": "spdxJson", "prjId": [[${project.prjId}]], "dataStr": dataStr}),
                    dataType: 'json',
                    cache: false,
                    contentType: 'application/json',
                    success: function (data) {
                        if ("false" == data.isValid) {
                            alertify.error([[#{msg.common.valid2}]], 0);
                        } else {
                            window.location = '/spdxdownload/getFile?id=' + data.validMsg;
                        }
                    },
                    error: function (data) {
                        alertify.error([[#{msg.common.valid2}]], 0);
                    }
                })
            },

            downloadSpdxYaml: function () {
                var dataStr = JSON.stringify($('#noticeForm').serializeObject());

                $.ajax({
                    type: "POST",
                    url: '/spdxdownload/getSPDXPost',
                    data: JSON.stringify({"type": "spdxYaml", "prjId": [[${project.prjId}]], "dataStr": dataStr}),
                    dataType: 'json',
                    cache: false,
                    contentType: 'application/json',
                    success: function (data) {
                        if ("false" == data.isValid) {
                            alertify.error([[#{msg.common.valid2}]], 0);
                        } else {
                            window.location = '/spdxdownload/getFile?id=' + data.validMsg;
                        }
                    },
                    error: function (data) {
                        alertify.error([[#{msg.common.valid2}]], 0);
                    }
                })
            },
            appendEditVisible: function (target) {
                var checked = $(target).prop("checked");

                if (checked || "CONF" == curIdenStatus) {
                    $("#editAppend").show();
                } else {
                    $("#editAppend").hide();
                }
            },
            defaultNotice: function (checked, type) {
            	if (checked) {
                    $("#companyName").attr("disabled", !checked);
                    $("#ossDistributionSite").attr("disabled", !checked);
                    $("#email").attr("disabled", !checked);
                    $("#hideOssVersion").attr("disabled", !checked);
                    $("#append").attr("disabled", !checked);
					$("#noticeFileFormat").attr("disabled", !checked);
                    $("#fileFormatLabel").attr("style", "color: #212529;");
					
                    if ($("#companyName").prop("checked")) {
                        $("#editCompanyName").attr("disabled", !checked);
                    } else {
                        $("#editCompanyName").attr("disabled", checked);
                    }

                    if ($("#ossDistributionSite").prop("checked")) {
                        $("#editOssDistributionSite").attr("disabled", !checked);
                    } else {
                        $("#editOssDistributionSite").attr("disabled", checked);
                    }

                    if ($("#email").prop("checked")) {
                        $("#editEmail").attr("disabled", !checked);
                    } else {
                        $("#editEmail").attr("disabled", checked);
                    }
                    
                    if (type != "init" && $("#append").prop("checked")) {
                    	$('#editor2').summernote('enable');
                    }
                } else {
                    $("#companyName").attr("disabled", !checked);
                    $("#ossDistributionSite").attr("disabled", !checked);
                    $("#email").attr("disabled", !checked);
                    $("#hideOssVersion").attr("disabled", !checked);
                    $("#append").attr("disabled", !checked);
                    $("#noticeFileFormat").attr("disabled", !checked);
                    $("#fileFormatLabel").attr("style", "color: #6c757d;");
                    
                    $("#editCompanyName").attr("disabled", !checked);
                    $("#editOssDistributionSite").attr("disabled", !checked);
                    $("#editEmail").attr("disabled", !checked);

                    if (type != "init" && $("#append").prop("checked")) {
                    	$('#editor2').summernote('disable');
                    }
                }
                
                $("select[name='noticeFileFormat'] option[value='chkAllowDownloadNoticeText']").attr("disabled", !checked);
                $("select[name='noticeFileFormat'] option[value='chkAllowDownloadSimpleHTML']").attr("disabled", !checked);
                $("select[name='noticeFileFormat'] option[value='chkAllowDownloadSimpleText']").attr("disabled", !checked);
                $("select[name='noticeFileFormat'] option[value='chkAllowDownloadSPDXSheet']").attr("disabled", !checked);
                $("select[name='noticeFileFormat'] option[value='chkAllowDownloadSPDXRdf']").attr("disabled", !checked);
                $("select[name='noticeFileFormat'] option[value='chkAllowDownloadSPDXTag']").attr("disabled", !checked);
                $("select[name='noticeFileFormat'] option[value='chkAllowDownloadSPDXJson']").attr("disabled", !checked);
                $("select[name='noticeFileFormat'] option[value='chkAllowDownloadSPDXYaml']").attr("disabled", !checked);
            },
            initNotice: function () {
                window.setTimeout(function () {
                    var editNoticeYn = $("[name='btnEditOssNotice']:checked").val();
                    var editCompanyYn = $("#companyName").val();
                    var editDistributionSiteUrlYn = $("#ossDistributionSite").val();
                    var editEmailYn = $("#email").val();
                    var hideOssVersionYn = $("#hideOssVersion").val();
                    var editAppendedYn = $("#append").val();

                    var checked = ($("[name='btnEditOssNotice']:checked").val() == "Y");
                    var btn_Save = $("#save");
                    
                    var targetId = $("#menu-tab").find(".active").attr("aria-controls");

                    if (userRole == "ROLE_ADMIN") { // 관리자 권한 일 경우
                        switch (curIdenStatus) {
                            case "CONF":
                                btn_Save.hide();
                                $("[name='btnEditOssNotice']").attr("disabled", true)
                                fn.defaultNotice(false, "init");

                                break;
                            default:
                              	if ("notice" == targetId) btn_Save.show();
                                fn.defaultNotice(checked, "init");

                                break;
                        }
                    } else { // 일반 사용자 일 경우
                        switch (curIdenStatus) {
                            case "":
                            case "PROG":
                            	if ("notice" == targetId) btn_Save.show();
                                fn.defaultNotice(checked, "init");

                                break;
                            default:
                                btn_Save.hide();
                                $("[name='btnEditOssNotice']").attr("disabled", true)
                                fn.defaultNotice(false, "init");

                                break;
                        }
                    }

                    if (editNoticeYn == "Y") {
                        $("[name='btnEditOssNotice']").trigger("click").attr("checked", true);
                    }

                    if (editCompanyYn == "Y") {
                        $("#companyName").trigger("click").attr("checked", true);
                    }

                    if (editDistributionSiteUrlYn == "Y") {
                        $("#ossDistributionSite").trigger("click").attr("checked", true);
                    }

                    if (editEmailYn == "Y") {
                        $("#email").trigger("click").attr("checked", true);
                    }

                    if (hideOssVersionYn == "Y") {
                        $("#hideOssVersion").trigger("click").attr("checked", true);
                    }

                    if (editAppendedYn == "Y") {
                        $("#append").trigger("click").attr("checked", true);
                        
                        if (!appendReadOnlyFlag) {
                        	$('#editor2').summernote('enable');
                        }
                    }
                }, 1);
            },
            procRequest: function (e) {
                e.preventDefault();

                var data = {
                    "prjId": [[${project.prjId}]]
                    , "verificationStatus": "REQ"
                    , "useCustomNoticeYn": $('#useCustomNoticeYn').val()
                    , "userComment": ""
                    , "referenceDiv": "12"
                    , "noticeFileFormat": $("#noticeFileFormat").val()
                };

                //공개의무 리스트가 있고 파일업로드가 완료된 상태이며 verify가 완료 되었을때
                var fileSeq = $("input[name='fileSeq_1']").val();
                var withoutVerifyYn = $('input[name=withoutVerifyYn]').val();

                if (typeof datas.ossList !== "undefined" && datas.ossList.length > 0) {
                    if ((fileSeq && verified) || withoutVerifyYn == "Y") {
                        fn.exeProjectStatus(data, "REQ");
                    } else {
                        loading.hide();

                        alertify.error([[#{msg.project.required.verify}]], 0);
                    }
                } else {
                    fn.exeProjectStatus(data, "REQ");
                }
            },
            reuseSearch: function (target) {
            	var targetGrid = $(target).attr("id").split("_")[1];
                var reuseKeyword = $("#verifyProjectSearch_" + targetGrid).val();
                var postData = {reuseKeyword: reuseKeyword};

                if ($("#projectList_" + targetGrid).length > 0) {
                    $("#packaging_" + targetGrid).hide();
                    $("#projectList_" + targetGrid).jqGrid('setGridParam', {
                        postData: postData,
                        page: 1,
                        url: '/project/verification/reuseProjectSearch'
                    }).trigger('reloadGrid');
                }
            },
            projectPackagingSearch: function (prjId, seq) {
            	var width = $("#searchResult" + seq).width();
            	
                var postData = {prjId: prjId};
                if ($("#projectList_" + seq).length > 0) {
                    $("#packagingList_" + seq).jqGrid('setGridParam', {
                        postData: postData,
                        url: '/project/verification/reuseProjectPackagingSearch'
                    }).trigger('reloadGrid');
                    
                    $("#packagingList_" + seq).jqGrid("setGridWidth", 0, true);
                    $("#packagingList_" + seq).jqGrid("setGridWidth", width, true);
                }
            },
            displayComment: function (cellvalue, options, rowObject) {
                var display = "";

                if (cellvalue != "") {
                    var tmpStr = new RegExp();
                    tmpStr = /[<][^>]*[>]/gi;

                    display = "<div style=\"height : 29px; overflow: hidden;\">" + cellvalue.replace(tmpStr, "") + "</div>";
                }

                return display;
            },
            loadReusePackagingFile: function (refPrjId, refFileSeq, targetSeq) {
                var data = {
                    prjId: [[${project.prjId}]],
                    refPrjId: refPrjId,
                    refFileSeq: refFileSeq
                };

                $.ajax({
                    type: "POST",
                    url: '/project/verification/reusePackagingFile',
                    data: JSON.stringify(data),
                    dataType: 'json',
                    cache: false,
                    contentType: 'application/json',
                    success: function (data) {
                        var item = data.file[0];

                        var appendHtml = '<br>' + item.createdDate;
                        var _url = '/download/' + item.registSeq + '/' + item.fileName;
                        var uploadFileTag = '<li><a class="ajax-file-upload-filename" href="' + _url + '">' + item.originalFilename + '</a><input type="hidden" value="' + item.registSeq + '"/>';
                        uploadFileTag += '<span class="badge bg-danger" style="cursor:pointer;" onclick="fn.deleteFile(this,\'' + item.registSeq + '\', \'' + targetSeq + '\'))">X</span>' + appendHtml + '</li>';

                        $('.uploadList_' + targetSeq + ' ul').append(uploadFileTag);
                        $('input[name=fileSeq_' + targetSeq + ']').val(item.registSeq);
                        $('.ajax-file-upload-statusbar').fadeOut('slow');
                        $('.ajax-file-upload-statusbar').remove();
                        // $('#fileUplWarnMessage_' + targetSeq).hide();

                        $("#packaging_" + targetSeq).hide();
                        $("#projectList_" + targetSeq).clearGridData();
                        
                        $('.verifyFile_' + targetSeq).hide();
                        $("#uploadAdd_" + targetSeq).show();
                        $("#uploadRemove_" + targetSeq).hide();
                        $("#projectSearch_" + targetSeq).hide();
                        if (!$(".uploadList_" + targetSeq).is("visible")) $(".uploadList_" + targetSeq).show();
						
                        verified = false;
                        evt.uploadStatus = true;
                        fn.autoVerify();
                    },
                    error: function (data) {
                        alertify.error([[#{msg.common.valid2}]], 0);
                    }
                });
            },
            // Grid input cell button
            textBox: function (cellvalue, options, rowObject) {
                if (!!rowObject.filePath || "Y" == isAndroid) {
                    return rowObject.filePath;
                } else {
                    var textBox = rowObject.ossName;

                    if (!!rowObject.ossVersion) {
                        textBox += "-" + rowObject.ossVersion;
                    }

                    textBox += "/";

                    return textBox;
                }
            },
            unformatterTextBox: function (cellvalue, options, rowObject) {
                return cellvalue;
            },
            checkVerify: function () {
                var allData = $("#list").getRowData();
                var filterData = allData.filter(function (cur) {
                    return cur.verifyFileCount.match(/\d+/g) != null
                }).length;

                return filterData != allData.length && !$("#approve").prop("checked");
            }
            // 20210617_autoVerify FN ADD
            , autoVerify: function () {
                var verifyBoolean = $("input:checkbox[name='autoVerify']").is(":checked");

                if (verifyBoolean == true) {
                    fn.verify();
                }
            }
            , verify: function () {
                var fileSeqs = [];

                if ($('input[name=fileSeq_1]').val() != '') {
                    fileSeqs.push($('input[name=fileSeq_1]').val());
                }

                if ($('input[name=fileSeq_2]').val() != '') {
                    fileSeqs.push($('input[name=fileSeq_2]').val());
                }

                if ($('input[name=fileSeq_3]').val() != '') {
                    fileSeqs.push($('input[name=fileSeq_3]').val());
                }

                gridCleanErrMsg("list"); // 기존 error message 삭제

                if (!evt.uploadStatus && fileSeqs.join("").length <= 0) {
                    alertify.error('should be upload to file.', 0);
                    return false;
                }

                var target = $('#list');
                var arr = [];
                arr = target.jqGrid('getDataIDs');

                for (var i in arr) {
                    // remove error message
                    target.jqGrid('saveRow', arr[i]);
                }

                var filePaths = [];
                var componentIds = [];
                var emptyIds = [];

                // empty check
                for (var i in arr) {
                    var _path = target.jqGrid('getCell', arr[i], 'filePath');
                    var _componentId = target.jqGrid('getCell', arr[i], 'componentId');

                    if (!$.trim(_path)) {
                        emptyIds.push(arr[i]);
                    }

                    filePaths.push(_path);
                    componentIds.push(_componentId);
                }

                // edit mode 원복
                for (var i in arr) {
                    target.jqGrid('editRow', arr[i], true);
                }

                if (emptyIds.length > 0) {
                    // show error message
                    for (var idx in emptyIds) {
                        var errRow = $("#" + emptyIds[idx] + " > td[aria-describedby='list_filePath']");

                        if (errRow) {
                            errRow.append('<div class=\"list_filePath_' + emptyIds[idx] + ' retxt"\">Required</div>');
                        }
                    }

                    alertify.error([[#{msg.common.valid}]], 0);

                    return false;
                }

                var obj = {
                    fileSeqs: fileSeqs,		     // packaging file이 1~3건일때 전부 담는 array를 보내고
                    prjId: [[${project.prjId}]],
                    gridFilePaths: filePaths,
                    gridComponentIds: componentIds,
                    statusVerifyYn: 'Y'
                };

                $.ajax({
                    url: '/project/verification/verify',
                    type: 'POST',
                    dataType: 'json',
                    contentType: 'application/json',
                    cache: false,
                    data: JSON.stringify(obj),
                    timeout: 2 * 60 * 60 * 1000, // max
                    success: function (json) {
                        json = JSON.parse(json);
                        loading.hide();
						
                        if (json.resCd == '10') {
                            var isReq = true;
                            var validArray = json.verifyValid;
                            var validMsg = json.verifyValidMsg;
                            var fileCountsMap = json.fileCounts;
                            var readmeFileName = json.verifyReadme;
                            var proprietary = json.verifyProprietary;
                            var verifyCheckList = json.verifyCheckList;

                            validArray.forEach(function (id) {
                                var errRow = $("#" + id + " > td[aria-describedby='list_filePath']");

                                if (errRow) {
                                    errRow.append('<div class=\"list_filePath_' + id + ' retxt"\">' + validMsg + '</div>');
                                }

                                $("#list").jqGrid("setCell", id, "verifyFileCount", " ");

                                isReq = false;
                            });

                            $.each(fileCountsMap, function (key, value) {
                                $("#list").jqGrid("setCell", key, "verifyFileCount", value);
                            });

                            if (isReq) {//verify 가 정상이라면 Request Review 노출
                                alertify.alert([[#{msg.common.success}]], function () {
                                    if (!curIdenStatus || 'PROG' == curIdenStatus) {
                                        $(".review").show();
                                    }

                                    createTabInFrame([[${project.prjId}]] + '_Packaging', '/project/verification/' + [[${project.prjId}]]);
                                });

                                verified = true;
                            } else {
                                alertify.alert(json.resMsg, function () {
                                });
                                verified = false;
                            }

                            if (readmeFileName.length > 0) {
                                $("#readmeFile").val(readmeFileName);
                                $("#btnReadme").addClass("btn-outline-primary");
                            } else {
                                $("#btnReadme").removeClass("btn-outline-primary");
                            }

                            if (proprietary.length > 0) {
                                $("#btnProprietary").addClass("btn-outline-primary");
                            } else {
                                $("#btnProprietary").removeClass("btn-outline-primary");
                            }

                            if (verifyCheckList.length > 0) {
                                $("#btnVerifyFileContent").addClass("btn-outline-primary");
                            } else {
                                $("#btnVerifyFileContent").removeClass("btn-outline-primary");
                            }

                            $("#deleteFlag").val("N");
                            $("#verifyBtnSet").show();
                        } else {
                            alertify.alert(json.resMsg, function () {
                            });
                        }

                    },
                    error: function (data) {
                        loading.hide();
                        alertify.error([[#{msg.common.valid2}]], 0);
                    }
                });
            },
            closeAlertifyView : function () {
            	$(".ajs-close").trigger("click");
    		},
            exportPath : function () {
            	var target = $('#list');
                var arr = [];
                arr = target.jqGrid('getDataIDs');

                for (var i in arr) {
                    target.jqGrid('saveRow', arr[i]);
                }

                var data = target.jqGrid('getRowData');

                for (var i in arr) {
                    target.jqGrid('editRow', arr[i], true);
                }

                $.ajax({
                    type: "POST",
                    url: '/exceldownload/getExcelPost',
                    data: JSON.stringify({"type": "verification", "parameter": JSON.stringify(data)}),
                    dataType: 'json',
                    cache: false,
                    contentType: 'application/json',
                    success: function (data) {
                        if ("false" == data.isValid) {
                            alertify.error([[#{msg.common.valid2}]], 0);
                        } else {
                            window.location = '/exceldownload/getFile?id=' + data.validMsg;
                        }
                    },
                    error: function (data) {
                        alertify.error([[#{msg.common.valid2}]], 0);
                    }
                });
            },
            uploadPath : function (permission) {
            	if (!permission) {
            		alertify.alert([[#{msg.common.not.permission}]], function(){});
            		return false;
            	} else if ("CONF" == curIdenStatus) {
            		alertify.alert([[${@CommonFunction.getCustomMessage('msg.common.not.edit.status', 'CONFIRM')}]], function(){});
            		return false
            	}
            	
            	$("#changePathPop").attr("style", "display: flex");
            	$("#blind_wrap").show();
            }
        }

        var com_fn = {
            tabInit: function () {
                var verifyPrjName = [[${project.prjName}]];
                var verifyPrjVersion = [[${project.prjVersion}]];
                if ("" != verifyPrjVersion) verifyPrjName += "(" + verifyPrjVersion + ")";
                var createdDate = [[${@CommonFunction.formatDateSimple(project.createdDate)}]];
                var prjUserName = [[${project.prjUserName}]];
                var prjDivisionName = [[${project.prjDivisionName }]];
                
                var vCreated = "";
                if ("" != prjUserName && prjUserName != null) {
                	vCreated = prjUserName;
                }
                if ("" != prjDivisionName && prjDivisionName != null) {
                	if ("" != vCreated) vCreated += " ";
                	vCreated += prjDivisionName;
                }
                vCreated += ' (' + createdDate + ')';

                var bTag = document.createElement("b");
                bTag.innerText = verifyPrjName;
                
                $("#verifyPrjName").html(bTag);
                $("#verifyCreator").text(vCreated);

                var initDiv = [[${initDiv}]];
                var tabDefaultIdx = (datas.ossList.length < 1 || initDiv != null) ? "1" : "0";
                
    			if ("1" == tabDefaultIdx) {
    				$("#tabMenuNotice").click();
    				$("#girdAreaPackaging").hide();
    				$("#btnSavePath").hide();
    				$("#verify").hide();
    				$("#save").show();
    			} else {
    				$("#tabMenuPackaging").click();
    				$("#girdAreaPackaging").show();
    				$("#btnSavePath").show();
    				$("#verify").show();
    				$("#save").hide();
    			}
            },
            checkStatus : function(){
    			var returnFlag = false;
    			
    			$.ajax({
    				url : '/project/getProjectStatus',
    				type : 'POST',
    				data : JSON.stringify({"prjId" : [[${project.prjId}]]}),
    				dataType : 'json',
    				cache : false,
    				async : false,
    				contentType : 'application/json',
    				success : function(data){
    					distributeDeployYn = data.distributeDeployYn||"";
    					distributeDeployTime = data.distributeDeployTime||"";
    					var status = data.verificationStatus||"";
    					var identificationStatus = data.identificationStatus||"";
    					if (status == curIdenStatus && "CONF" == identificationStatus) {
    						returnFlag = true;
    					} else {
    						returnFlag = false;
    					}
    				},
    				error : function(){
    					alertify.error([[#{msg.common.valid2}]], 0);
    				}
    			});
    			
    			return returnFlag;
    		}
        }

        var packaging = {
            init: function () {
                $(".multiSet > *").hide();

                var fileSeq_1 = $("[name='fileSeq_1']").val();
                var fileSeq_2 = $("[name='fileSeq_2']").val();
                var fileSeq_3 = $("[name='fileSeq_3']").val();

                $(".multiSet > div:eq(0)").show();

                if (fileSeq_1) {
                    $("#uploadAdd_1").show();
                }

                if (fileSeq_2) {
                    $(".multiSet > div:eq(1)").show();
                    $("#uploadAdd_1").hide();
                    $("#uploadAdd_2").show();
                }

                if (fileSeq_3) {
                    $(".multiSet > div:eq(2)").show();
                    $("#uploadAdd_1").hide();
                    $("#uploadAdd_2").hide();
                    $("#uploadAdd_3").show();
                }

                fn.changeSelectOption($("[name=selectOption_1]"), false);
				fn.changeSelectOption($("[name=selectOption_2]"), false);
				fn.changeSelectOption($("[name=selectOption_3]"), false);
            }
        }

        var projectList_1 = {
            load: function (data) {
                $("#projectList_1").jqGrid({
                    datatype: 'json',
                    jsonReader: {
                        repeatitems: false,
                        root: function (obj) {
                            return obj.rows;
                        },
                        page: function (obj) {
                            return obj.page;
                        },
                        total: function (obj) {
                            return obj.total;
                        },
                        records: function (obj) {
                            return obj.records;
                        }
                    },
                    colNames: ['ID', 'Project Name', 'Project<br>Version', 'Distribution<br>Type', 'Creator', 'Created<br>Date'],
                    colModel: [
                        {name: 'prjId', index: 'prjId', width: 80, align: 'center', sorttype: 'int'},
                        {name: 'prjName', index: 'prjName', width: 243, align: 'left'},
                        {name: 'prjVersion', index: 'prjVersion', width: 80, align: 'left'},
                        {name: 'distributionType', index: 'distributionType', width: 130, align: 'left', sortable: true},
                        {name: 'creator', index: 'creator', width: 100, align: 'left', sortable: true},
                        {name: 'createdDate', index: 'createdDate', width: 100, align: 'center', formatter: 'date', formatoptions: {srcformat: 'Y-m-d H:i:s.t', newformat: 'Y-m-d'}, sortable: true}
                    ],
                    onSelectRow: function (id) {
                        fn.projectPackagingSearch($(this).getCell(id, "prjId"), 1);

                        $("#packaging_1").show();
                    },
                    rowNum: 10,
                    rowList: [10, 20, 30],
                    editurl: 'clientArray',
                    autowidth: true,
                    pager: '#pager_1',
                    gridview: true,
                    sortable: function (permutation) {
                    },
                    viewrecords: true,
                    sortorder: 'desc',
                    height: 'auto',
                    loadComplete: function () {
                    	adjustPageGridSize();
                    }
                });

                $("#projectList_1").jqGrid('navGrid', "#pager_1", {add: false, edit: false, del: false, search: false, refresh: false});
            },
            packagingLoad: function () {
                $("#packagingList_1").jqGrid({
                    datatype: 'json',
                    colNames: ['packaging File Name', ''],
                    colModel: [
                        {name: 'origNm', index: 'origNm', width: 300, align: 'left'},
                        {name: 'fileSeq', index: 'fileSeq', width: 80, align: 'center'}
                    ],
                    onCellSelect: function (rowid, iCol, cellcontent, e) {
                    },
                    editurl: 'clientArray',
                    autowidth: true,
                    gridview: true,
                    sortable: function (permutation) {
                    },
                    viewrecords: true,
                    sortorder: 'desc',
                    height: 'auto',
                    loadComplete: function (data) {
                        var row = data.rows;

                        for (var i in row) {
                            $("#packagingList_1").jqGrid('setCell', +i + 1, 'fileSeq', "<input type=\"button\" value=\"load\" class=\"btnCLight w55\" onclick=\"fn.loadReusePackagingFile('" + data.prjId + "', '" + row[i].fileSeq + "', '1')\">");
                        }
                        
                        adjustPageGridSize();
                    }
                });
            }
        };

        var projectList_2 = {
            load: function (data) {
                $("#projectList_2").jqGrid({
                    datatype: 'json',
                    jsonReader: {
                        repeatitems: false,
                        root: function (obj) {
                            return obj.rows;
                        },
                        page: function (obj) {
                            return obj.page;
                        },
                        total: function (obj) {
                            return obj.total;
                        },
                        records: function (obj) {
                            return obj.records;
                        }
                    },
                    colNames: ['ID', 'Project Name', 'Project<br>Version', 'Distribution<br>Type', 'Creator', 'Created<br>Date'],
                    colModel: [
                        {name: 'prjId', index: 'prjId', width: 80, align: 'center', sorttype: 'int'},
                        {name: 'prjName', index: 'prjName', width: 243, align: 'left'},
                        {name: 'prjVersion', index: 'prjVersion', width: 80, align: 'left'},
                        {name: 'distributionType', index: 'distributionType', width: 130, align: 'left', sortable: true},
                        {name: 'creator', index: 'creator', width: 100, align: 'left', sortable: true},
                        {name: 'createdDate', index: 'createdDate', width: 100, align: 'center', formatter: 'date', formatoptions: {srcformat: 'Y-m-d H:i:s.t', newformat: 'Y-m-d'}, sortable: true}
                    ],
                    onSelectRow: function (id) {
                        fn.projectPackagingSearch($(this).getCell(id, "prjId"), 2);
                        $("#packaging_2").show();
                    },
                    rowNum: 10,
                    rowList: [10, 20, 30],
                    editurl: 'clientArray',
                    autowidth: true,
                    pager: '#pager_2',
                    gridview: true,
                    sortable: function (permutation) {
                    },
                    viewrecords: true,
                    sortorder: 'desc',
                    height: 'auto',
                    loadComplete: function () {
                    	adjustPageGridSize();
                    }
                });

                $("#projectList_2").jqGrid('navGrid', "#pager_2", {add: false, edit: false, del: false, search: false, refresh: false});
            },
            packagingLoad: function () {
                $("#packagingList_2").jqGrid({
                    datatype: 'json',
                    colNames: ['packaging File Name', ''],
                    colModel: [
                        {name: 'origNm', index: 'origNm', width: 300, align: 'left'},
                        {name: 'fileSeq', index: 'fileSeq', width: 80, align: 'center'}
                    ],
                    onCellSelect: function (rowid, iCol, cellcontent, e) {
                    },
                    editurl: 'clientArray',
                    autowidth: true,
                    gridview: true,
                    sortable: function (permutation) {
                    },
                    viewrecords: true,
                    sortorder: 'desc',
                    height: 'auto',
                    loadComplete: function (data) {
                        var row = data.rows;

                        for (var i in row) {
                            $("#packagingList_2").jqGrid('setCell', +i + 1, 'fileSeq', "<input type=\"button\" value=\"load\" class=\"btnCLight w55\" onclick=\"fn.loadReusePackagingFile('" + data.prjId + "', '" + row[i].fileSeq + "', '2')\">");
                        }
                        
                        adjustPageGridSize();
                    }
                });
            }
        };

        var projectList_3 = {
            load: function (data) {
                $("#projectList_3").jqGrid({
                    datatype: 'json',
                    jsonReader: {
                        repeatitems: false,
                        root: function (obj) {
                            return obj.rows;
                        },
                        page: function (obj) {
                            return obj.page;
                        },
                        total: function (obj) {
                            return obj.total;
                        },
                        records: function (obj) {
                            return obj.records;
                        }
                    },
                    colNames: ['ID', 'Project Name', 'Project<br>Version', 'Distribution<br>Type', 'Creator', 'Created<br>Date'],
                    colModel: [
                        {name: 'prjId', index: 'prjId', width: 80, align: 'center', sorttype: 'int'},
                        {name: 'prjName', index: 'prjName', width: 243, align: 'left'},
                        {name: 'prjVersion', index: 'prjVersion', width: 80, align: 'left'},
                        {name: 'distributionType', index: 'distributionType', width: 130, align: 'left', sortable: true},
                        {name: 'creator', index: 'creator', width: 100, align: 'left', sortable: true},
                        {name: 'createdDate', index: 'createdDate', width: 100, align: 'center', formatter: 'date', formatoptions: {srcformat: 'Y-m-d H:i:s.t', newformat: 'Y-m-d'}, sortable: true}
                    ],
                    onSelectRow: function (id) {
                        fn.projectPackagingSearch($(this).getCell(id, "prjId"), 3);
                        $("#packaging_3").show();
                    },
                    rowNum: 10,
                    rowList: [10, 20, 30],
                    editurl: 'clientArray',
                    autowidth: true,
                    pager: '#pager_3',
                    gridview: true,
                    sortable: function (permutation) {
                    },
                    viewrecords: true,
                    sortorder: 'desc',
                    height: 'auto',
                    loadComplete: function () {
                    	adjustPageGridSize();
                    }
                });

                $("#projectList_3").jqGrid('navGrid', "#pager_3", {add: false, edit: false, del: false, search: false, refresh: false});
            },
            packagingLoad: function () {
                $("#packagingList_3").jqGrid({
                    datatype: 'json',
                    colNames: ['packaging File Name', ''],
                    colModel: [
                        {name: 'origNm', index: 'origNm', width: 300, align: 'left'},
                        {name: 'fileSeq', index: 'fileSeq', width: 80, align: 'center'}
                    ],
                    onCellSelect: function (rowid, iCol, cellcontent, e) {
                    },
                    editurl: 'clientArray',
                    autowidth: true,
                    gridview: true,
                    sortable: function (permutation) {
                    },
                    viewrecords: true,
                    sortorder: 'desc',
                    height: 'auto',
                    loadComplete: function (data) {
                        var row = data.rows;

                        for (var i in row) {
                            $("#packagingList_3").jqGrid('setCell', +i + 1, 'fileSeq', "<input type=\"button\" value=\"load\" class=\"btnCLight w55\" onclick=\"fn.loadReusePackagingFile('" + data.prjId + "', '" + row[i].fileSeq + "', '3')\">");
                        }
                        
                        adjustPageGridSize();
                    }
                });
            }
        };
        
        var fn_comment = {
            	callbackFunction : function () {
            	    fn_comment.getCommentList(commentsParam);
            	},
            	getCommentList : function(param) {
            		$.ajax({
            			type: "GET",
            			url: '/comment/getCusCommentList',
            			dataType : 'html',
            			cache : false,
            			data : param,
            			success: function (res) {
            				if (typeof param.height !== undefined) {
            					$(".comment-card-body").attr("style", "max-height:" + param.height + "px; overflow-y: auto;");
            				}
            				$("#commentList").empty();
            				$("#commentList").html(res);
            			},
            			error: function(data){
            				alertify.error([[#{msg.common.valid2}]], 0);
            			}
            		});
            	},
            	getMoreCommentsList : function() {
            		commentsParam["moreFlag"] = "Y";
            		fn_comment.getCommentList(commentsParam);
            	},
            	editComments : function(_commId, _referenceDiv, _referenceId) {
        			$.ajax({
            			url : '/comment/getEditPopup',
        				type : 'POST',
        				data : {'commId' : _commId},
        				dataType : 'html',
        				cache : false,
        				success : function(res){
        					if(!alertify.editComments){
        						alertify.dialog('editComments', function() {
        							return {
        								setup: function() {
        									var settings = alertify.confirm().settings;
        								
        									for (var prop in settings) {
        										this.settings[prop] = settings[prop];
        									}
        								
        									var setup = alertify.confirm().setup();
        									setup.buttons = [];
        									setup.focus.element = 1;
        								
        									return setup;
        								},
        						    	hooks: {
        						    		onshow: function() {
        						        		this.elements.dialog.style.maxWidth = 'none';
        						          		this.elements.dialog.style.width = '700px';
        						        	}
        								}
        							};
        						}, false, 'confirm');
                    		}
        				
        					alertify.editComments(res).set('title', 'Edit Comments');
        					$("#updateComments").attr("onclick", "fn_comment.updateComments("+_commId+", "+_referenceDiv+", "+_referenceId+")");
        					$("#commentEdit").summernote({minHeight: 180, maxHeight: 800, lang: "ko-KR"});
        				}
            		});
        		},
        		updateComments : function (_commId, _referenceDiv, _referenceId) {
        			if ("" == $("#commentEdit").next().find(".note-editable").text()) {
        				alertify.alert("Please enter a comment", function(){});
        				return false;
        			} else {
        				var param = {commId : _commId, contents : replaceWithLink($("#commentEdit").summernote('code')), referenceDiv: _referenceDiv, referenceId: _referenceId};
        					$.ajax({
        					url : '/comment/updateComment',
        					type : 'POST',
        					dataType : 'json',
        					cache : false,
        					data : param,
        					success : function(json){
        						alertify.success([[#{msg.common.success}]]);
        						fn.closeAlertifyView();
        						fn_comment.getCommentList(commentsParam);
        					},
        					error : function(){
        						alertify.error([[#{msg.common.valid2}]], 0);
        					}
        				});
        			}
        		},
        		deleteComments : function (_commId) {
        			alertify.confirm("Are you sure you want to delete this comment?", function (e) {
        				if (e) {
        					$.ajax({
        						url : '/comment/deleteComment',
        						type : 'POST',
        						dataType : 'json',
        						cache : false,
        						data : {'commId' : _commId},
        						success : function(data){
        							alertify.success([[#{msg.common.success}]]);
        							fn.closeAlertifyView();
        							fn_comment.getCommentList(commentsParam);
        						},
        						error : function(){
        							alertify.error([[#{msg.common.valid2}]], 0);
        						}
        					});
        				} else {
        					return false;
        				}
        			});
        		},
            	activateCommentArea : function() {
            		// change tab area
            		if (!$(".comment-area").is(":visible")) {
            			$(".contents-area").removeClass("col-lg-12");
            			$(".contents-area").addClass("col-lg-9");
            			
            			fn_comment.getCommentList(commentsParam);
            			$(".comment-area").show();
            		} else {
             			$(".contents-area").removeClass("col-lg-9");
             			$(".contents-area").addClass("col-lg-12");
             			$(".comment-area").hide();
            		}
            	},
            	showCommentHistory : function () {
            		fn_comment.activateCommentArea();
            		
            		var _rDiv = [[${@CommonFunction.getCoConstDefVal('CD_DTL_COMMENT_PACKAGING_HIS')}]];
                    openCommentHistory('/comment/popup/prj/' + _rDiv + '/' + [[${project.prjId}]]);
            	}
            }
        
        $(document).keydown(function (e) {
          	if (e.keyCode == 13) {
           		var activeInput = $('.form-control:focus');
				if (activeInput.length > 0) {
			    	var submitButton = activeInput.closest('.input-group').find('[type="button"]');
			    	if (submitButton.length > 0) {
			        	submitButton.click();
			    	}
				}
          	}
      	});
        //]]>
    </script>
</th:block>