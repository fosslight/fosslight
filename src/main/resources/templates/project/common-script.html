<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<th:block th:fragment="commonScript">
<script th:inline="javascript">
var userRole = [[${sessUserInfo.authority}]];
var curIdenStatus = [[${project.identificationStatus}]];
var projectStatus = [[${project.status}]];
var distributionStatus = [[${project.distributionStatus}]];
var isAndroidModel = [[${project.androidFlag}]] == "Y";
var _popupCheckOssName = null;
var _popupCheckOssLicense = null;
var commentsParam = {referenceId : [[${project.prjId}]], referenceDiv : 'prj'};
var ossNames = [];
var licenseNames = [];

var uploadGridData;
var searchedData = {};
var partyLoadSuccess = true;
var depLoadSuccess = true;
var srcLoadSuccess = true;
var binLoadSuccess = true;

//==========================================================================================
//COMMON
//==========================================================================================

var com_evt = {
	// init
	init: function(){
		$(window).on("resize", function(){
	    	resizeUploadAreaJqGrid();
	    });
		
		$(document).on('expanded.lte.cardwidget collapsed.lte.cardwidget', function () {
	        setTimeout(function(){
	        	resizeUploadAreaJqGrid();
	        }, 200);
	    });

		$(document).on('click', '.ajs-close', function () {
			var dialogId = $(this).closest('.alertify').attr('id');
			if (typeof dialogId !== "undefined") {
				if (dialogId.indexOf("selectSearch") > -1 || dialogId.indexOf("addUpload") > -1) {
			    	searchedData = {};
			    }
			}
		});
		
		$(document).on('change', '.sheetRowCheckBox', function() {
			if ($(this).is(':checked')) {
				$(this).closest('tr').find("input[type='radio']").prop("disabled", false);
		   	} else {
		   		$(this).closest('tr').find("input[type='radio']").prop("disabled", true);
			}
		});
		
		// ossNames auto complete
		fn_grid_com.griOssNames().success(function(data, status, headers, config){
			if(data != null && ossNames == ""){
				data.forEach(function(obj){
					ossNames.push(obj.ossName);
				})
			}
		});
		
		// licenseNames auto complete
		commonAjax.getLicenseTags().success(function(data, status, headers, config){
			if(data != null && licenseNames == ""){
				var tag = "";
				data.forEach(function(obj){
					if(obj!=null) {
						tag ={
							value : obj.shortIdentifier.length > 0 ? obj.shortIdentifier : obj.licenseName,
							label : obj.licenseName + (obj.shortIdentifier.length > 0 ? (" (" + obj.shortIdentifier + ")") : ""),
							type : obj.licenseType,
							obligation : obj.obligation,
							obligationChecks : obj.obligationChecks
						}
						
						licenseNames.push(tag);
					}
				});
			}
		});
		
		com_fn.tabInit();

		if (isAndroidModel) {
			$("#mergeYn").val("Y");
			
			Bom_Save_Flg =true;
			
			if("REV" == curIdenStatus) {
				if($("#binaryDB")){
					$("#binaryDB").show();
				}
			}
		}
		
		// bomConfirm button
		$('#bomConfirm').click(function(e){
			if (com_fn.checkStatus()){
				e.preventDefault();
				
				if (!isAndroidModel) {
					// 머지 체크
					if ("Y" != $("#mergeYn").val()) {
						alertify.alert([[#{msg.project.required.bomSave}]], function(){});
						$("#tabMenuBom").trigger("click");
						return false;
					}
				}
				
				if (typeof alertify.bomConfirmDialog === 'undefined') {
					commonAlertifyDialog('bomConfirmDialog');
	        	}
				
				var innerHtml 	= [[${@CommonFunction.getCustomMessage('msg.common.enter.comment.save', 'msg.common.enter.comment.field.confirm', true)}]];
	       		innerHtml 		+= '<br><textarea id="bomConfirmEditor"></textarea>';
				
	       		alertify.bomConfirmDialog()
	       		.set('onok', function(e) {
	       			var editorVal = $("#bomConfirmEditor").summernote('code');
	       			if ("" != $(editorVal).text().trim() || $(editorVal).find('img').length > 0) {
	   				} else {
	   					editorVal = "";
	   				}
	       			
	   				if (isAndroidModel) {
						if ("undefined" !== typeof binAndroidValidMsgData.isValid && "false" == binAndroidValidMsgData.isValid) {
							alertify.alert([[#{msg.project.validation.error}]]);
							
							return false;
						}
						
						var data = {"prjId" : [[${project.prjId}]], "identificationStatus" : "CONF", "userComment" : editorVal};
    					
    					if ($("#ignoreBinaryDbFlag")) {
    	 					data["ignoreBinaryDbFlag"] = $("#ignoreBinaryDbFlag").val();
    					}
                        loading.show();
    	 				com_fn.checkSave(data, "CONF");
					} else {
						if ("undefined" !== typeof bomValidMsgData.isValid && "false" == bomValidMsgData.isValid) {
							var customKeys = [];
							var keys = Object.keys(bomValidMsgData);
							var unconfirmedLicenseCnt = 0;
							
							keys.forEach(function(obj){
								var warningMsg = bomValidMsgData[obj];
								if ("New license" == warningMsg) {
									unconfirmedLicenseCnt++;
									return false;
								}
								
								if (obj.indexOf(".") > -1) {
									var key = obj.split(".")[1];
									if (!customKeys.includes(key)) customKeys.push(key);
								}
							});
							
							if (unconfirmedLicenseCnt > 0) {
								alertify.alert([[#{msg.project.validation.error}]]);
								
								return false;
							}
							
							var adminCheckList = $("#bomList").jqGrid('getGridParam','data').filter(function(element, index) {
								var adminCheckYn = element.adminCheckYn;
								return "Y" == adminCheckYn;
							});
			
							if (adminCheckList.length > 0) {
								var includeIds = adminCheckList.filter(function(cur) {
									return customKeys.includes(cur.componentId);
								});
				
								if (includeIds.length != customKeys.length) {
									alertify.alert([[#{msg.project.validation.error}]]);
					
									return false;
								}
							} else {
								alertify.alert([[#{msg.project.validation.error}]]);
				
								return false;
							}
						}
						
						if (Bom_Save_Flg){
							if($('#bomList').jqGrid('getDataIDs').length == 0 && "Y"!= $("#mergeYn").val()) {
								alertify.alert([[#{msg.project.required.bomSave}]], function(){});

								return false;
							}

							// no opensource license를 선택한 경우 bom merge 쿼리에 포함하지 않기 때문에, 3rd, src, bin, binandroid 에 error message가 있는지 확인해야함
							if (!com_fn.validBomChangeStatus(false)) {
								return false;
							}

							var data = {"prjId" : [[${project.prjId}]], "identificationStatus" : "CONF", "userComment" : editorVal};
	                    	if ($("#ignoreBinaryDbFlag")) {
	                    		data["ignoreBinaryDbFlag"] = $("#ignoreBinaryDbFlag").val();
	                    	}
	                    
	                    	loading.show();
	 						com_fn.checkSave(data, "CONF");
						} else {
							alertify.alert([[#{msg.project.check.save}]], function(){});
						}
					}
	       		})
	       		.set('onshow', function(e){
	       			$("#bomConfirmEditor").summernote({height: 180, minHeight: null, maxHeight: null, lang: "ko-KR"});
	       			const parameter = {
	                  	"referenceDiv" : [[${@CommonFunction.getCoConstDefVal('CD_DTL_COMMENT_IDENTIFICATION_USER')}]],
	                   	"referenceId" : [[${project.prjId}]]
	                }
	                var draftUserComment = draftUserComments(parameter);
	                if (typeof draftUserComment !== "undefined" && "" != draftUserComment) {
	                  	$("#bomConfirmEditor").summernote('code', "<p>" + draftUserComment + "</p>");
	                }
	       		})
	       		.set('title', 'Confirm').setContent(innerHtml)
				.show();
			} else {
				alertify.alert([[#{msg.project.warn.project.status}]], function(){});
			}
		});
		
		// bomReject 버튼 
		$('#bomReject').click(function(e){
			if (com_fn.checkStatus()){
				e.preventDefault();

				var innerHtml 	= 'Are you sure you want to reject?<br>';
               	innerHtml 		+= '<textarea id="bomRejectEditor"></textarea>';
				
             	if (typeof alertify.bomRejectDialog === 'undefined') {
             		commonAlertifyDialog('bomRejectDialog');
            	}
               	
               	alertify.bomRejectDialog()
           		.set('onok', function(e) {
           			if (e) {
						var editorVal = $("#bomRejectEditor").summernote('code');

						if ("" != $(editorVal).text().trim() || $(editorVal).find('img').length > 0) {
							var data = {"prjId": [[${project.prjId}]], "identificationStatus": "PROG", "userComment": editorVal};
							com_fn.checkSave(data, "PROG");
						} else {
							alertify.alert([[#{msg.project.required.comments}]], function () { });

							return false;
						}
					} else {
						return false;
					}
           		})
           		.set('onshow', function(e){
           			$("#bomRejectEditor").summernote({height: 180, minHeight: null, maxHeight: null, lang: "ko-KR"});
           			const parameter = {
                   		"referenceDiv" : [[${@CommonFunction.getCoConstDefVal('CD_DTL_COMMENT_IDENTIFICATION_USER')}]],
                   		"referenceId" : [[${project.prjId}]]
                   	}
                   	var draftUserComment = draftUserComments(parameter);
                   	if (typeof draftUserComment !== "undefined" && "" != draftUserComment) {
                   		$("#bomRejectEditor").summernote('code', "<p>" + draftUserComment + "</p>");
                   	}
           		})
           		.setContent(innerHtml)
				.show();
			} else {
				alertify.alert([[#{msg.project.warn.project.status}]], function(){});
			}
		});
        // bomRequest 버튼
        $('#bomRequest').click(function(e){
            if (com_fn.checkStatus()){
                e.preventDefault();

                // distributionType이 101(SelfCheck)인 경우 에러 팝업
                var distributionType = [[${project.distributionType}]];
                if (distributionType == [[${@CommonFunction.getCoConstDefVal('CD_DTL_NOTICE_TYPE_SELFCHECK')}]]) {
                    var shareUrl = [[${@environment.getProperty('server.domain')}]] + '/project/shareUrl/' + [[${project.prjId}]];
                    alertify.alert([[#{msg.project.cannot.request}]] + "<a href='" + shareUrl+ "' target='_blank\'> (PRJ-"+ [[${project.prjId}]] +")</a>", function(){});
                    return false;
                } else {
                    // CD_DTL_NOTICE_TYPE_INHOUSEONLY인 경우 먼저 확인 팝업
                    if (distributionType == [[${@CommonFunction.getCoConstDefVal('CD_DTL_NOTICE_TYPE_INHOUSEONLY')}]]) {
                        alertify.confirm([[#{msg.project.ask.request}]], function(e){
                            if (e) {
                                // 확인을 눌렀을 때만 다음 단계 진행
                                proceedWithBomChecks();
                            }
                        });
                        return false;
                    } else {
                        // CD_DTL_NOTICE_TYPE_INHOUSEONLY가 아닌 경우 바로 진행
                        proceedWithBomChecks();
                    }
                }
            } else {
                alertify.alert([[#{msg.project.warn.project.status}]], function(){});
            }
        });

        function proceedWithBomChecks() {
				// in case of bin-android and Yocto
				if (isAndroidModel) {
					if ("" == $('#srcAndroidNoticeFileId').val()) {
						alertify.alert([[#{msg.project.android.noticefile.required}]], function(){});
						return false;
					} else {
						if ("Y" != $('#srcAndroidNoticeSaveYn').val()) {
							alertify.alert([[#{msg.project.notice.save}]], function(){});
							return false;
						}
					}
				} else {
					// 머지 체크
					if("Y" != $("#mergeYn").val()) {
						alertify.alert([[#{msg.project.required.bomSave}]], function(){
							$("#tabMenuBom").trigger("click");
						});
						
						return false;
					}
				}
				
				// if there is no oss version, add a vulnerability confirmation request popup
				var msg = "";
				if (!isAndroidModel) {
					var vulnNoOssVersionGridDatas = $("#bomList").jqGrid('getRowData').filter(function(cur) {
						var cvssScore = $(cur.cvssScore).text();
						var ossVersion = cur.ossVersion;
						return "" != cvssScore && "" == ossVersion;
					});
	
					if (vulnNoOssVersionGridDatas.length > 0) {
						msg = [[#{msg.project.request.check.vulnerability}]];
						for (var i in vulnNoOssVersionGridDatas) {
							msg += '<br/>';
							msg += '&emsp;- ' + vulnNoOssVersionGridDatas[i].ossName;
						}
					}
				}
				
				if ("" != msg) {
					if(!alertify.checkVulnAlert){
						alertify.dialog('checkVulnAlert', function() {
							var settings;
							
							return {
								setup: function() {
									var settings = alertify.confirm().settings;
									
									for (var prop in settings) {
										this.settings[prop] = settings[prop];
									}
									
									var setup = alertify.confirm().setup();
									
									setup.focus.element = 1;
									
									return setup;
								},
								settings: {
									oncontinue: null
								},
								callback: function(closeEvent) {
									alertify.confirm().callback.call(this, closeEvent);
								}
							};
						}, false, 'confirm');
					}
					
					alertify.checkVulnAlert(msg)
					.set('labels', {cancel: 'IGNORE'})
					.set('onok', function(closeEvent){return;})
					.set('oncancel', function(closeEvent){com_fn.bomReqeustStart();});
				} else {
					com_fn.bomReqeustStart();
				}
			}
		
		// bomReviewStart 버튼 
		$('#bomReviewStart').click(function(e) {
			if (com_fn.checkStatus()){
				e.preventDefault();
				
				// 머지 체크
				if ("N" == $("#mergeYn").val()) {
					alertify.alert([[#{msg.project.required.bomSave2}]], function(){});

					return false;
				}
				
				if (Bom_Save_Flg) {
					var data = {"prjId" : [[${project.prjId}]], "identificationStatus" : "REV", "userComment" : ""};

					com_fn.checkSave(data, "REV");
				} else {
					alertify.alert([[#{msg.project.check.save}]], function(){});
				}
			} else {
				alertify.alert([[#{msg.project.warn.project.status}]], function(){});
			}
		});

		$("#ignoreBinaryDbFlag").on("click",function(){
			if($("#ignoreBinaryDbFlag").prop("checked")) {
				$("#ignoreBinaryDbFlag").val("Y");
			} else {
				$("#ignoreBinaryDbFlag").val("N");
			}
		});

		com_fn.saveFlagObject["DEP"] = false;
		com_fn.saveFlagObject["SRC"] = false;
		com_fn.saveFlagObject["BIN"] = false;
		com_fn.saveFlagObject["ANDROID"] = false;
		
		commentsParam.height = $(window).height() - 120;
		fn_comment.getCommentList(commentsParam);
	}
}

function resizeUploadAreaJqGrid() {
    var newWidth = $(".identificationAddArea").width();
    $("#identificationAddList").jqGrid("setGridWidth", newWidth, true);
}

//공통 함수
var com_fn = {
	checkGridComplete : function (isAndroid) {
		if (isAndroid) {
			if (androidGridCompleteFlag) {
				loadingIden.hide();
			}
		} else {
			if (partyGridCompleteFlag && depGridCompleteFlag && srcGridCompleteFlag && binGridCompleteFlag && bomGridCompleteFlag) {
				loadingIden.hide();
			}
		}
	},
	saveFlagObject : {},
	// 탭 초기화
	tabInit: function(){
		var initDiv = [[${initDiv}]];
		
		// 이용가능 여부 체크 박스
		com_fn.chkApplicable();
		com_fn.btnCtl(userRole, curIdenStatus);
		
		var activateTab = "";
		var activateGridArea = "";
		
		$("[name=gridArea]").hide();
		
		if ("4" != initDiv) {
            $("#tabMenuBom").addClass("active");
            $("#menu-bom").addClass("active show");
			$("#gridAreaBom").show();
			$("#save").attr("title", "merge and save");
			$("#reset").hide();
		} else {
            $("#tabMenuBinAndroid").addClass("active");
            $("#menu-android").addClass("active show");
			$("#gridAreaBinAndroid").show();
		}
	},
	fnTabChange: function(target){
		var tabContent = $(".tabContent");
		var tabMenuA = $("[id^='tabMenu'] a");
		
		tabMenuA.eq("0").text("3rd party");
		tabMenuA.eq("1").text("DEP");
		tabMenuA.eq("2").text("SRC");
		tabMenuA.eq("3").text("BIN");
		tabMenuA.eq("4").text("BIN(" + [[${project.noticeTypeEtc}]] + ")");
		tabMenuA.eq("5").text("BOM");
		tabMenuA.eq("6").text("BAT(Optional)");
		
		if ([[${!partnerFlag}]]) {
			tabMenuA.eq("0").hide();
		}
		
		tabContent.hide();
		activeTabText = $(target).text();
		activeTab = $(target).attr("rel");
		
		if(activeTab == "bomDiv"){
			$(".projdecBtn").show();
			$('.commentBtn').show();
			com_fn.btnCtl(userRole, curIdenStatus);
		} else if(isAndroidModel && activeTab == "binAndroidDiv") {
			$(".projdecBtn").show();
			$(".commentBtn").show();
			com_fn.btnCtl(userRole, curIdenStatus);
		} else {
			// Identification 내 모든 탭 우측 상단에 request review 버튼 표시
			$(".projdecBtn").show();
			$(".commentBtn").show();
		}
		
		$("#" + activeTab).show();
		com_fn.btnControl(activeTab);
					
		// _mainLastsel 꼬이는것 방지
		if (activeTab == "depDiv") {
			_mainLastsel = $('#depList').jqGrid('getGridParam', "selrow");
		} else if(activeTab == "srcDiv") {
			_mainLastsel = $('#srcList').jqGrid('getGridParam', "selrow");
		} else if(activeTab == "batDiv") {
			_mainLastsel = $('#batList').jqGrid('getGridParam', "selrow");
		} else if(activeTab == "binAndroidDiv") {
			_mainLastsel = $('#binAndroidList').jqGrid('getGridParam', "selrow");
		} else if(activeTab == "binDiv") {
			_mainLastsel = $('#binList').jqGrid('getGridParam', "selrow");
		}
		
		// 선택된 로우가 없을경우 _mainLastsel 초기화
		if(typeof(_mainLastsel)!="string") {
			_mainLastsel = -1;
		}
	},
	btnCtl: function(role, status){
//			206 CONF	Confirm
//			206 NA		N/A
//			206 PROG	Progress
//			206 REQ		Request
//			206 REV		Review
		// 상태에 따른 버튼 컨트롤 
		var btn_div = $(".projdecBtn");
		var btn_confirm = $("#bomConfirm");
		var btn_reject = $("#bomReject");
		var btn_review = $("#bomRequest");
		var btn_restart = $("#bomReviewStart");
		var btn_Reset = $(".idenReset");
		var btn_Merge = $(".idenMerge");
		var btn_Save = $(".idenSave");
		var btn_Analysis = $(".idenAnalysis");
		var btn_Analysis_Result = $(".idenAnalysisResult");
		var btn_check = $(".idenCheckBtn");
		var btn_bulkRegist = $(".idenBulkRegist");
		var cbx_iden = $(".idenCbx");
		var fileUploader = $(".fileUploader");
		var chkStatus = status||"";
		var permission = [[${project.permission}]] == 1;
		
		if (role == "ROLE_ADMIN"){ // 관리자 권한 일 경우
			switch(chkStatus){
				case "":
					btn_div.hide();
					btn_confirm.hide();btn_reject.hide();btn_review.show();btn_restart.hide();
					btn_Reset.show();btn_Merge.show();btn_Save.show();btn_check.show();btn_bulkRegist.show();fileUploader.show();
					
					break;
				case "PROG":
					btn_confirm.hide();btn_reject.hide();btn_review.show();btn_restart.hide();
					btn_Reset.show();btn_Merge.show();btn_Save.show();btn_check.show();btn_bulkRegist.show();fileUploader.show();
					
					break;
				case "REQ":
					btn_confirm.hide();btn_reject.hide();btn_review.hide();btn_restart.show();
					btn_Reset.hide();btn_Merge.hide();btn_Save.hide();btn_check.hide();btn_bulkRegist.hide();fileUploader.hide();btn_Analysis.hide();
					
					break;
				case "REV":
					btn_reject.removeClass("btn-lg-red");
                    btn_reject.addClass("btn-outline-lg-red");
					btn_confirm.show();btn_reject.show();btn_review.hide();btn_restart.hide();
					btn_Reset.show();btn_Merge.show();btn_Save.show();btn_check.show();btn_bulkRegist.show();fileUploader.show();
					
					break;
				case "CONF":
					btn_confirm.hide();btn_reject.show();btn_review.hide();btn_restart.hide();
					btn_Reset.hide();btn_Merge.hide();btn_Save.hide();btn_Analysis.hide();
					btn_Analysis_Result.hide();
					btn_check.hide();
					
					break;
			}
		} else if([[${project.viewOnlyFlag}]] == 'Y'){
			btn_confirm.hide();btn_reject.hide();btn_review.hide();btn_restart.hide();
			btn_Reset.hide();btn_Merge.hide();btn_Save.hide();btn_check.hide();btn_bulkRegist.hide();fileUploader.hide();cbx_iden.prop("disabled", false);
		} else { // 일반 사용자 일 경우
			switch(status){
				case "":
					btn_div.hide();
					btn_confirm.hide();btn_reject.hide();btn_review.show();btn_restart.hide();
					btn_check.show();btn_bulkRegist.show();fileUploader.show();
					if (permission) {
						btn_Reset.show();btn_Merge.show();btn_Save.show();
					} else {
						btn_Reset.hide();btn_Merge.hide();btn_Save.hide();
					}
					
					break;
				case "PROG":
					btn_confirm.hide();btn_reject.hide();btn_review.show();btn_restart.hide();
					if (permission) {
						btn_Reset.show();btn_Merge.show();btn_Save.show();
					} else {
						btn_Reset.hide();btn_Merge.hide();btn_Save.hide();
					}
					btn_check.show();btn_bulkRegist.show();fileUploader.show();
					
					break;
				case "REQ":
					btn_reject.addClass("btn-lg-red");
					btn_confirm.hide();btn_reject.show();btn_review.hide();btn_restart.hide();
					btn_Reset.hide();btn_Merge.hide();btn_Save.hide();btn_check.hide();btn_bulkRegist.hide();fileUploader.hide();

					break;
				case "REV":
					btn_confirm.hide();btn_reject.hide();btn_review.hide();btn_restart.hide();
					btn_Reset.hide();btn_Merge.hide();btn_Save.hide();btn_check.hide();btn_bulkRegist.hide();fileUploader.hide();

					break;
				case "CONF":
					btn_confirm.hide();btn_reject.show();btn_review.hide();btn_restart.hide();
					btn_Reset.hide();btn_Merge.hide();btn_Save.hide(); btn_Analysis.hide();btn_bulkRegist.hide();fileUploader.hide();
					btn_Analysis.hide();btn_Analysis_Result.hide();
					btn_check.hide();

					break;
			}
		}
	},
	// 사용 여부 체크 박스
	chkApplicable : function(){
		if ('N' == [[${project.identificationSubStatusPartner}]]) {
			$("#applicableParty").trigger('click');
		}
		
		if ('N' == [[${project.identificationSubStatusDep}]]) {
            $("#applicableDep").trigger('click');
        }
		
		if ('N' == [[${project.identificationSubStatusSrc}]]) {
			$("#applicableSrc").trigger('click');
		}
		
		if ('N' == [[${project.identificationSubStatusBat}]]) {
			$("#applicableBat").trigger('click');
		}
		
		if ('N' == [[${project.identificationSubStatusBin}]]) {
			$("#applicableBin").trigger('click');
		}
		
		if ('N' == [[${project.identificationSubStatusAndroid}]]) {
			$("#applicableBinAndroid").trigger('click');
		}
		
		if ('CONF' == [[${project.verificationStatus}]]) {
			$("#applicableParty").attr("disabled", true);
			$("#applicableDep").attr("disabled", true);
			$("#applicableSrc").attr("disabled", true);
			$("#applicableBat").attr("disabled", true);
			$("#applicableBin").attr("disabled", true);
			$("#applicableBinAndroid").attr("disabled", true);
		}
	},
	// 메인 그리드 라이센스 데이터 설정(멀티:구분자 , 로 연결|싱글: 단건) 
	setMainLicenseData : function(target,rowid){
		var mainGrid = $("#"+target);
		var subGrid = $("#"+target+"_"+rowid+"_t");
		var licenseDiv =  mainGrid.jqGrid('getCell',rowid,'licenseDiv');
		var licenseId = "";
		var licenseName = "";
		var licenseText = "";
		var copyrightText = "";
		
		// 데이터 추출
		var arr = [];
		arr = subGrid.jqGrid('getDataIDs');
		
		for(var i in arr){
			if(licenseDiv == "M"){
				licenseId += ((licenseId != "") ? "," : "") + subGrid.jqGrid('getCell',arr[i],'licenseId');
				licenseText += ((licenseText != "") ? "," : "") + subGrid.jqGrid('getCell',arr[i],'licenseText');
				copyrightText += ((copyrightText != "") ? "," : "") + subGrid.jqGrid('getCell',arr[i],'copyrightText');
			} else {
				if(i==0){
					licenseId = subGrid.jqGrid('getCell',arr[i],'licenseId');
					licenseText = subGrid.jqGrid('getCell',arr[i],'licenseText');
					copyrightText = subGrid.jqGrid('getCell',arr[i],'copyrightText');
					break;
				}
			}
		}
		
		// 데이터 넣기
		mainGrid.jqGrid('setCell', rowid, 'licenseId', licenseId);
		mainGrid.jqGrid('setCell', rowid, 'licenseText', licenseText);
		mainGrid.jqGrid('setCell', rowid, 'copyrightText', copyrightText);
	},
	//  상단 데이터 로드시 처리
	exeLoadToList : function(target , rDiv){
		if(loadBln){ // 상단 로드 데이터 일시
			// 기본 데이터 설정
			var _tempRandId = ""; // 랜덤ID
			var _sub_tempRandId = "";  //서브ID
			var referenceId = '${project.prjId}'; // 프로젝트ID
			var referenceDiv = rDiv;
			var mArr = [];
			var sArr = [];
			mArr = $("#"+target).jqGrid('getDataIDs');
			
	 		for(var m in mArr){
	 			_tempRandId = $.jgrid.randId();
	 			
	 			$("#"+target).jqGrid("setCell", mArr[m], "gridId", _tempRandId);
	 			$("#"+target).jqGrid("setCell", mArr[m], "componentId", null);
	 			$("#"+target).jqGrid("setCell", mArr[m], "referenceId", referenceId);
	 			$("#"+target).jqGrid("setCell", mArr[m], "referenceDiv", referenceDiv);
	 			
	 			if(rDiv == "10") {
	 				var selrow = $('#_list-1').jqGrid('getGridParam', "selrow" );
	 				var refPrjId = $('#_list-1').jqGrid('getCell',selrow,'prjId');

	 				$("#"+target).jqGrid("setCell", mArr[m], "refPrjId", refPrjId);
	 			} else {
					sArr = $("#"+target+"_"+mArr[m]+"_t").jqGrid('getDataIDs');

					for(var s in sArr){
						_sub_tempRandId = $.jgrid.randId();
						$("#"+target+"_"+mArr[m]+"_t").jqGrid("setCell", sArr[s], "gridId", _tempRandId+"-"+_sub_tempRandId);
						$("#"+target+"_"+mArr[m]+"_t").jqGrid("setCell", sArr[s], "componentLicenseId", "", "","", true);
						$("#"+target+"_"+mArr[m]+"_t").jqGrid("setCell", sArr[s], "componentId", _tempRandId);
					}
	 			}
	 		}
		}
		
		loadBln = false;
	},
	saveEditor : function(){
		//코멘트 임시저장
		var editorVal = /* replaceWithLink(CKEDITOR.instances.editor.getData())*/ "";
		var register = "";
		var param = {referenceId : [[${project.prjId}]], referenceDiv :'11', contents : editorVal};

		$.ajax({
			url : "/project/saveComment",
			type : 'POST',
			dataType : 'json',
			cache : false,
			data : param,
			success : function(json){
				if(json.isValid == 'false'){
					alertify.error([[#{msg.common.valid2}]], 0);
				} else {
					alertify.success([[#{msg.common.success}]]);
					
					$(".commentBtn.open").trigger( "click" );
				}
			},
			error : function(){
				alertify.error([[#{msg.common.valid2}]], 0);
			}
		});
	},
	sendEditor : function(type){
		var editorVal = ""; /* replaceWithLink(CKEDITOR.instances.editor.getData());*/ //코멘트 저장

		if(!editorVal || editorVal == "") {
			alertify.alert([[#{msg.project.enter.comment}]], function(){});

			return false;
		}
		
		var param = {referenceId : [[${project.prjId}]], referenceDiv :'10', contents : editorVal, mailSendType : type, expansion1 : activeTabText};
		
		$.ajax({
			url : "/project/sendComment",
			type : 'POST',
			dataType : 'json',
			cache : false,
			data : param,
			success : function(json){
				if(json.isValid == 'false') {
					alertify.error([[#{msg.common.valid2}]], 0);
				} else {
					$('.ajs-close').trigger("click");

					alertify.success([[#{msg.project.sent.comments.success}]]);
//					resetEditor(CKEDITOR.instances.editor);

					$(".commentBtn open").trigger( "click" );
				}
			},
			error : function(){
				alertify.error([[#{msg.common.valid2}]], 0);
			}
		});
	},
	editorDialog : function(){
		if(!alertify.commentDialog){
			//define a new dialog
			alertify.dialog('commentDialog',function factory(){
				return {
					main:function(message){
						this.message = message;
					},
					setup:function(){
						return { 
							focus: { element:0 }
						};
					},
					prepare:function(){
							this.setContent(this.message);
					}
				}
			});
		}
		
		var editorVal = ""; /* replaceWithLink(CKEDITOR.instances.editor.getData()); */
		
		if(!editorVal || editorVal == "") {
			alertify.alert([[#{msg.project.enter.comment}]], function(){});

			return false;
		}
		//launch it.
		var btnHtm = '<br/><b>Send an email to</b><br/>';
		btnHtm += '<input type="button" value="Watcher Only" class="btnCancel btnColor red" style="height:30px;width:100px;"onclick="com_fn.sendEditor(\'W\')"/>&nbsp;&nbsp;&nbsp;';

		if(userRole == "ROLE_ADMIN") {
			btnHtm += '<input type="button" value="Creator Only" class="btnCancel btnColor red" style="height:30px;width:100px;"onclick="com_fn.sendEditor(\'C\')"/>&nbsp;&nbsp;&nbsp;';
		} else {
			btnHtm += '<input type="button" value="Reviewer Only" class="btnCancel btnColor red" style="height:30px;width:100px;"onclick="com_fn.sendEditor(\'R\')"/>&nbsp;&nbsp;&nbsp;';
		}
		
		btnHtm +='<input type="button" value="All" class="btnCancel btnColor red" style="height:30px;width:120px;" onclick="com_fn.sendEditor(\'WR\')"/>&nbsp;&nbsp;&nbsp;';

		alertify.commentDialog(btnHtm);
	},
	checkAplicable : function(obj, target){
		var aplicable = $(obj).val();

		if ($(obj).is(':checked')) {
			if ("partyBtn" == target){
				$("input[name='identificationSubStatusPartner']").val("N");
				$("#gridAreaParty").show();
				$(".3rdProjectSearch").hide();
				$(".3rdProjectSearch2").hide();
				$("#_3rdAddListContainer").hide();
			} else if ("depBtn" == target){
				$("input[name='identificationSubStatusDep']").val("N");
				$("#gridAreaDep").show();
				$("#_depAddListContainer").hide();
			} else if ("srcBtn" == target){
				$("input[name='identificationSubStatusSrc']").val("N");
				$("#gridAreaSrc").show();
				$("#_srcAddListContainer").hide();
			} else if ("binBtn" == target){
				$("input[name='identificationSubStatusBin']").val("N");
				$("#gridAreaBin").show();
				$("#_binAddListContainer").hide();
			} else if ("binAndroidBtn" == target){
				$("input[name='identificationSubStatusAndroid']").val("N");
				$("#gridAreaBinAndroid").show();
				$("#_binandroidAddListContainer").hide();
			}
			
			$('.'+target).hide();
		} else {
			$('.'+target).show();
			
			if ("partyBtn" == target){
				$("input[name='identificationSubStatusPartner']").val("");
				$('#_3rdAddList').jqGrid(party_evt.setParamParty3());
				
				if (_3rdLoadListLength > 0) {
					$("#_3rdAddListContainer").show();
				} else {
					$("#_3rdAddListContainer").hide();
				}
			} else if ("depBtn" == target){
				$("input[name='identificationSubStatusDep']").val("");
				
				if (_depLoadListLength > 0) {
					$("#_depAddListContainer").show();
				} else {
					$("#_depAddListContainer").hide();
				}
			} else if ("srcBtn" == target){
				$("input[name='identificationSubStatusSrc']").val("");
				
				if (_srcLoadListLength > 0) {
					$("#_srcAddListContainer").show();
				} else {
					$("#_srcAddListContainer").hide();
				}
			} else if ("binBtn" == target){
				$("input[name='identificationSubStatusBin']").val("");
				
				if (_binLoadListLength > 0) {
					$("#_binAddListContainer").show();
				} else {
					$("#_binAddListContainer").hide();
				}
			} else if ("binAndroidBtn" == target){
				$("input[name='identificationSubStatusAndroid']").val("");
				
				if (_binandroidLoadListLength > 0) {
					$("#_binandroidAddListContainer").show();
				} else {
					$("#_binandroidAddListContainer").hide();
				}
			}
		}
	},
	customCheckApplicable : function (target, mode) {
		if ("partyBtn" == target) {
			if ("view" == mode) {
				$("#chkApplicableParty").empty();
				$("#chkApplicableParty").html("<label class=\"text-sm\">Not Applicable</label><input type=\"hidden\" name=\"identificationSubStatusPartner\" value=\"N\">");
			} else {
				$("#applicableParty").prop("checked", true);
			}
			
			$("#gridAreaParty").show();
			$("#_3rdAddListContainer").hide();
		} else if ("depBtn" == target) {
			if ("view" == mode) {
				$("#chkApplicableDep").empty();
				$("#chkApplicableDep").html("<label class=\"text-sm\">Not Applicable</label><input type=\"hidden\" name=\"identificationSubStatusDep\" value=\"N\">");
			} else {
				$("#applicableDep").prop("checked", true);
			}
			
			$("#gridAreaDep").show();
			$("#_depAddListContainer").hide();
		} else if ("srcBtn" == target) {
			if ("view" == mode) {
				$("#chkApplicableSrc").empty();
				$("#chkApplicableSrc").html("<label class=\"text-sm\">Not Applicable</label><input type=\"hidden\" name=\"identificationSubStatusSrc\" value=\"N\">");
			} else {
				$("#applicableSrc").prop("checked", true);
			}
			
			$("#gridAreaSrc").show();
			$("#_srcAddListContainer").hide();
		} else if ("binBtn" == target) {
			if ("view" == mode) {
				$("#chkApplicableBin").empty();
				$("#chkApplicableBin").html("<label class=\"text-sm\">Not Applicable</label><input type=\"hidden\" name=\"identificationSubStatusBin\" value=\"N\">");
			} else {
				$("#applicableBin").prop("checked", true);
			}
			
			$("#gridAreaBin").show();
			$("#_binAddListContainer").hide();
		} else if ("binAndroidBtn" == target) {
			if ("view" == mode) {
				$("#chkApplicableBinAndroid").empty();
				$("#chkApplicableBinAndroid").html("<label class=\"text-sm\">Not Applicable</label><input type=\"hidden\" name=\"identificationSubStatusAndroid\" value=\"N\">");
			} else {
				$("#applicableBinAndroid").prop("checked", true);
			}
			
			$("#gridAreaBinAndroid").show();
			$("#_binandroidAddListContainer").hide();
		}
		
		$("." + target).hide();
	},
	// 버튼 제어
	btnControl : function(tabNm){
		$("#partyDivBtn").hide();
		$("#srcDivBtn").hide();
		$("#binDivBtn").hide();
		$("#binAndroidDivBtn").hide();
		$("#bomDivBtn").hide();
		$("#batDivBtn").hide();
		$("#" + tabNm+"Btn").show();
	},
	displayDelete : function(cellvalue, options, rowObject){
		var mode = $("#thirdEditMode").val();
		if ("Y" == mode) {
			return '<input type="button" value="Delete" class="btnCLight" onclick="party_evt.removeList('+options.rowId+', '+rowObject.partnerId+')"/>';
		} else {
			return '';
		}
	},
	deleteLicense : function(target){
		$(target).parent().remove();
	},
	deleteLicenseRenewal : function(target){
		$(target).parent().next().remove();
		$(target).parent().remove();
	},
	getLicenseName : function(obj){
		if (typeof obj.licenseName !== "undefined") {
			return obj.licenseName.replace(/(<([^>]+)>)/ig, ",").split(",").reduce(function(arr, cur){
			    if(cur.toUpperCase() != "X" && cur != ""){
			        arr.push(cur);
			    }

			    return arr;
			}, []).join(",");
		}
	},
	isAndroidOnly : function() {
		var rtnFlag = false;
		
		if([[${project.androidFlag}]] == "Y") {
			rtnFlag = true;
			var target;
	 		var arr = [];
	 		
			if(!($("#applicableParty").is(":checked")) ) {
				target = $('#list3');
		 		arr = target.jqGrid('getRowData');
		 		
		 		for(var i in arr){
			 		if(arr[i].excludeYn != "Y") {
			 			rtnFlag = false;
			 			
			 			return false;
			 		}
		 		}
			}
			
			if(rtnFlag && !($("#applicableDep").is(":checked")) ) {
				target = $('#depList');
				arr = target.jqGrid('getRowData');
				
		 		for(var i in arr){
			 		if(arr[i].excludeYn != "Y") {
			 			rtnFlag = false;
			 			
			 			return false;
			 		}
		 		}
			}
			
			if(rtnFlag && !($("#applicableSrc").is(":checked")) ) {
				target = $('#srcList');
				arr = target.jqGrid('getRowData');
				
		 		for(var i in arr){
			 		if(arr[i].excludeYn != "Y") {
			 			rtnFlag = false;
			 			
			 			return false;
			 		}
		 		}
			}
			
			if(rtnFlag && !($("#applicableBin").is(":checked")) ) {
				target = $('#binList');
				arr = target.jqGrid('getRowData');
				
		 		for(var i in arr){
			 		if(arr[i].excludeYn != "Y") {
			 			rtnFlag = false;
			 			
			 			return false;
			 		}
		 		}
			}
		}
		
		return rtnFlag;
	},
	checkSave : function(data, status){
		if ("N" == [[${project.androidFlag}]]) {
			cleanErrMsg("bomList");
			cleanErrMsg("depList");
			cleanErrMsg("srcList");
			cleanErrMsg("binList");
		}
		if ("Y" == [[${project.androidFlag}]]) {
			cleanErrMsg("binAndroidList");
		}
		
		// request review 또는 confirm 시에만 변경 여부를 확인한다.
		// '/project/getCheckChangeData' 에서 androidModel의 경우는 check 하는 부분이 없어서 우회 시킴. 추후 해당 기능이 필요하게되면 다시 변경예정
		if ("REQ" != status && "CONF" != status || isAndroidModel) { 
			com_fn.exeProjectStatus(data, status);
		} else {
			var checkObligationFlag = false;
			
			if("CONF" == status || "REQ" == status) {
				var arr = [];
				var bomList = $("#bomList");
				arr = bomList.jqGrid('getRowData');
		 		
		 		for(var i in arr){
		 			if(arr[i].obligationType == "90") {
		 				checkObligationFlag = true;
		 				
		 				break;
		 			}
		 		}
			}
			
			if (checkObligationFlag) {
				loading.hide();
				alertify.alert([[#{msg.warn.include.needcheck.license}]]);
				
				return false;
			}
			
			loading.show();
			
			// PARTY Data
			cleanErrMsg("list3");
			
			var checkFlag = false;
			var tabs = ["party", "dep", "src", "bin"];
        	for (var i in tabs) {
        		var finalData = { 
                	referenceId : [[${project.prjId}]],
                	status : status
                }
        		
        		if ("party" == tabs[i] && [[${partnerFlag}]]) {
        			var partyGrid = [];
					var partnerCheck = [[${project.identificationSubStatusPartner}]];
        			partyGrid = $('#list3').jqGrid('getGridParam', 'data');
    				var applicablePartyValue = $("input[name='identificationSubStatusPartner']").val();
    				partnerCheck = applicablePartyValue;
    				if ("N" != applicablePartyValue) {
    					partnerCheck = 'Y';
    				}
    				
    				finalData["applicableParty"] = partnerCheck;
    				finalData["partyGrid"] = JSON.stringify(partyGrid);
        		} else if ("dep" == tabs[i]) {
        			var depCheck = [[${project.identificationSubStatusDep}]];
        			var applicableDepValue = $("input[name='identificationSubStatusDep']").val();
        			depCheck = applicableDepValue;
        			if ("N" != applicableDepValue) {
        				depCheck = 'Y';
        			}
        			var depMainGrid = $('#depList').jqGrid('getGridParam','data');
        			
        			finalData["applicableDep"] = depCheck;
    				finalData["depMainGrid"] = JSON.stringify(depMainGrid);
    				finalData["depSubGrid"] = "";
        		} else if ("src" == tabs[i]) {
        			var srcCheck = [[${project.identificationSubStatusSrc}]];
        			var applicableSrcValue = $("input[name='identificationSubStatusSrc']").val();
        			srcCheck = applicableSrcValue;
        			if ("N" != applicableSrcValue) {
        				srcCheck = 'Y';
        			}
        			var srcMainGrid = $('#srcList').jqGrid('getGridParam','data');
        			
        			finalData["applicableSrc"] = srcCheck;
    				finalData["srcMainGrid"] = JSON.stringify(srcMainGrid);
    				finalData["srcSubGrid"] = "";
        		} else {
        			var binCheck = [[${project.identificationSubStatusBin}]];
        			var applicableBinValue = $("input[name='identificationSubStatusBin']").val();
        			binCheck = applicableBinValue;
        			if ("N" != applicableBinValue) {
        				binCheck = 'Y';
        			}
        			var binMainGrid = $('#binList').jqGrid('getGridParam','data');
        			
        			finalData["applicableBin"] = binCheck;
    				finalData["binMainGrid"] = JSON.stringify(binMainGrid);
    				finalData["binSubGrid"] = "";
        		}
        		
        		checkFlag = com_fn.getCheckChangeData(finalData);
        		if (checkFlag) {
        			break;
        		}
        	}
			
        	if (!checkFlag) {
        		com_fn.exeProjectStatus(data, status);
        	}
		}
	},
	getCheckChangeData : function(finalData) {
		var checkFlag = false;
		
		$.ajax({
			url : "/project/getCheckChangeData",
			type : 'POST',
			data : JSON.stringify(finalData),
			dataType : 'json',
			cache : false,
			async : false,
			contentType : 'application/json',
			success: function(json){
				loading.hide();
				if ("false" == json.isValid) {
					checkFlag = true;
					alertify.alert(json.validMsg == "" ? [[#{msg.project.required.bomSave2}]] : json.validMsg, function(){});

					if (typeof depValidMsgData !== "undefined") {
						gridValidMsgNew(depValidMsgData, "depList");
					}
					
					if (typeof srcValidMsgData !== "undefined") {
						gridValidMsgNew(srcValidMsgData, "srcList");
					}
					
					if (typeof binValidMsgData !== "undefined") {
						gridValidMsgNew(binValidMsgData, "binList");
					}
				} else {
					checkFlag = false;
				}
			},
			error: function(json){
				loading.hide();
				alertify.error([[#{msg.common.valid2}]], 0);
			}
		});
		
		return checkFlag;
	},
	// no opensource license를 선택한 경우 bom merge 쿼리에 포함하지 않기 때문에, 3rd, src, bin, binandroid 에 error message가 있는지 확인해야함
	validBomChangeStatus : function(_androidBinFlag) {
		var rtnFlag = true;
		
		// android model인 경우
		if(_androidBinFlag) {
			if(binAndroidValidMsgData) {
				$.each(binAndroidValidMsgData,function(key,value) {
					if("isValid" != key && "validMsg" != key && "resultData" != key && "externalData" != key && "externalData2" != key) {
						var seqSuffix = key.split(".");

						if(seqSuffix.length  > 1) {
							rtnFlag = false;
							alertify.alert(com_fn.setMessage("There is an error in BIN("+[[${project.noticeTypeEtc}]]+".)", function(){}));
							return false;
						}
					}
				});
			}
		} else { // src, bin에 error level message 존재여부 확인
			var arr = $("#bomList").jqGrid('getDataIDs');
			var gridData = new Array();
			
			var applicableDepValue = $("input[name='identificationSubStatusDep']").val();
			var applicableSrcValue = $("input[name='identificationSubStatusSrc']").val();
			var applicableBinValue = $("input[name='identificationSubStatusBin']").val();
			
			var applicableDepChecked = false;
			if ("N" == applicableDepValue) applicableDepChecked = true;
			var applicableSrcChecked = false;
			if ("N" == applicableSrcValue) applicableSrcChecked = true;
			var applicableBinChecked = false;
			if ("N" == applicableBinValue) applicableBinChecked = true;
			
			for(var i in arr){
				var adminCheckYn = $("#bomList").jqGrid('getCell',arr[i],'adminCheck');
				
				if(adminCheckYn == "Y"){
					$("#bomList").jqGrid('setCell',arr[i],'adminCheckYn', adminCheckYn);

		 			gridData.push($("#bomList").getRowData(arr[i]));
				}
	 		}
	 		
			if(!applicableDepChecked) {
				if(depValidMsgData) {
					$.each(depValidMsgData,function(key,value) {
						if("isValid" != key && "validMsg" != key && "resultData" != key && "externalData" != key && "externalData2" != key) {
							var seqSuffix = key.split(".");

							if(seqSuffix.length  > 1) {
								var result = bom_fn.adminCheck(gridData, seqSuffix, $("#depList"));
	
								if(!result){
									rtnFlag = false;
									$(".ajs-cancel").trigger("click");
									
									window.setTimeout(function(){
										alertify.alert(com_fn.setMessage([[#{msg.project.validation.error}]]), function(){});
										$("#tabMenuDep").trigger("click");
									}, 100);
									
									return false;
								}
							}
						}
					});
					
					if(!rtnFlag) {
						return false;
					}
				}
			}
			
			if(!applicableSrcChecked) {
				if(srcValidMsgData) {
					$.each(srcValidMsgData,function(key,value) {
						if("isValid" != key && "validMsg" != key && "resultData" != key && "externalData" != key && "externalData2" != key) {
							var seqSuffix = key.split(".");

							if(seqSuffix.length  > 1) {
								var result = bom_fn.adminCheck(gridData, seqSuffix, $("#srcList"));
	
								if(!result){
									rtnFlag = false;
									$(".ajs-cancel").trigger("click");
									
									window.setTimeout(function(){
										alertify.alert(com_fn.setMessage([[#{msg.project.validation.error}]]), function(){});
										$("#tabMenuSrc").trigger("click");
									}, 100);
									
									return false;
								}
							}
						}
					});
					
					if(!rtnFlag) {
						return false;
					}
				}
			}
			
			if(!applicableBinChecked){
				if(binValidMsgData) {
					$.each(binValidMsgData,function(key,value) {
						if("isValid" != key && "validMsg" != key && "resultData" != key && "externalData" != key && "externalData2" != key) {
							var seqSuffix = key.split(".");
							
							if(seqSuffix.length  > 1) {
								var result = bom_fn.adminCheck(gridData, seqSuffix, $("#binList"));
	
								if(!result){
									rtnFlag = false;
									$(".ajs-cancel").trigger("click");
									
									window.setTimeout(function(){
										alertify.alert(com_fn.setMessage([[#{msg.project.validation.error}]]), function(){});
										$("#tabMenuBin").trigger("click");
									}, 100);
									
									return false;
								}
							}
						}
					});
					
					if (!rtnFlag) {
						return false;
					}
				}
			}
		}
		
		return rtnFlag;
	},
	exeProjectStatus : function(data, status){
		loading.show();
		
		$.ajax({
			url : "/project/updateProjectStatus",
			type : 'POST',
			data : JSON.stringify(data),
			dataType : 'json',
			cache : false,
			contentType : 'application/json',
			success: function(data){
				loading.hide();
				$(".commentBtn.open").trigger( "click" );
				
				if((status == "CONF" || status == "REQ") && data.isValid == "false") {
					if ("Y" == [[${project.androidFlag}]]) {
						if(binAndroidValidMsgData) {
							gridValidMsgNew(binAndroidValidMsgData, "binAndroidList");
						}
						
						if(binAndroidDiffMsgData) {
							gridDiffMsg(binAndroidDiffMsgData, "binAndroidList");
						}
						
						if(binAndroidInfoMsgData) {
							gridInfoMsg(binAndroidInfoMsgData, "binAndroidList");
						}
					}
					
					if ("N" == [[${project.androidFlag}]]) {
						if(bomValidMsgData) {
							gridValidMsgNew(bomValidMsgData, "bomList");
						}
						
						if(bomDiffMsgData) {
							gridDiffMsg(bomDiffMsgData, "bomList");
						}
						
						// error message를 재표시
						if(depValidMsgData) {
							gridValidMsgNew(depValidMsgData, "depList");
						}
						
						if(srcValidMsgData) {
							gridValidMsgNew(srcValidMsgData, "srcList");
						}
						
// 						if(batValidMsgData) {
// 							gridValidMsgNew(batValidMsgData, "batList");
// 						}
						
						if(binValidMsgData) {
							gridValidMsgNew(binValidMsgData, "binList");
						}
						
						// diff msg
						if(depDiffMsgData) {
							gridDiffMsg(depDiffMsgData, "depList");
						}
						
						if(srcDiffMsgData) {
							gridDiffMsg(srcDiffMsgData, "srcList");
						}
						
						if(binDiffMsgData) {
							gridDiffMsg(binDiffMsgData, "binList");
						}
					}
					
					if(data.validMsg && data.validMsg != "") {
						alertify.error(data.validMsg);
					} else {
						alertify.error([[#{msg.common.valid}]], 0);
					}
				} else {
					var prjId = [[${project.prjId}]];
					reloadTabInframe("/project/list");
					
					if (data.validMsg == "goPackaging") {
						alertify.alert([[#{msg.project.autoredirect.packaging}]], function() {
							deleteTabInFrame('/project/identification/'+prjId);
							createTabInFrame(prjId+'_Packaging', "/project/verification/"+prjId);
						});
					} else if (status == "PROG" //reject한 경우는 새로고침 (save 버튼등이 문제)
						|| (userRole != "ROLE_ADMIN" && status == "REQ") // 일반인이 request review한 경우
						|| (userRole == "ROLE_ADMIN" && status == "REQ") // admin이 request review한 경우
						|| status == "REV" // request 시 버튼 hide 처리되어 다시 활성화 하기 위함
						|| status == "CONF") { // Admin이 confirm한 경우
						alertify.alert([[#{msg.common.success}]], function() {
							if (isAndroidModel) {
								deleteTabInFrame('/project/identification/'+prjId+'/4');
								createTabInFrame(prjId+'_Identify', '/project/identification/'+prjId+'/4');
							} else {
								deleteTabInFrame('/project/identification/'+prjId+'/5');
								createTabInFrame(prjId+'_Identify', '/project/identification/'+prjId+'/5');
							}
						});
					} else {
						// admin이 review start 한 경우 $("#mergeYn").val() 초기화
						if(status == "REV") {
							$("#mergeYn").val("N");
							
							if($("#binaryDB")){
								$("#binaryDB").show();
							}
							
							com_fn.btnCtl(userRole, status);
							curIdenStatus = status;
						}
						
						if ("Y" == [[${project.androidFlag}]]) {
							if(binAndroidValidMsgData) {
								gridValidMsgNew(binAndroidValidMsgData, "binAndroidList");
							}
						
							if(binAndroidDiffMsgData) {
								gridDiffMsg(binAndroidDiffMsgData, "binAndroidList");
							}
						
							if(binAndroidInfoMsgData) {
								gridInfoMsg(binAndroidInfoMsgData, "binAndroidList");
							}
						
							com_fn.saveFlagObject["ANDROID"] = false;
						}
					
						if ("N" == [[${project.androidFlag}]]) {
							// error message를 재표시
							if(bomValidMsgData) {
								gridValidMsgNew(bomValidMsgData, "bomList");
							}
						
							if(bomDiffMsgData) {
								gridDiffMsg(bomDiffMsgData, "bomList");
							}
						
							if(depValidMsgData) {
								gridValidMsgNew(depValidMsgData, "depList");
							}
						
							if(depDiffMsgData) {
								gridDiffMsg(depDiffMsgData, "depList");
							}
						
							if(srcValidMsgData) {
								gridValidMsgNew(srcValidMsgData, "srcList");
							}
						
							if(srcDiffMsgData) {
								gridDiffMsg(srcDiffMsgData, "srcList");
							}
						
// 							if(batValidMsgData) {
// 								gridValidMsgNew(batValidMsgData, "batList");
// 							}
						
							if(binValidMsgData) {
								gridValidMsgNew(binValidMsgData, "binList");
							}
						
							if(binDiffMsgData) {
								gridDiffMsg(binDiffMsgData, "binList");
							}
						
							if(binInfoMsgData) {
								gridInfoMsg(binInfoMsgData, "binList");
							}
						
							com_fn.saveFlagObject["DEP"] = false;
							com_fn.saveFlagObject["SRC"] = false;
							com_fn.saveFlagObject["BIN"] = false;
						}
						alertify.alert([[#{msg.common.success}]], function(){});
					}
				}
				
				fn.displayProjectInfo();
			},
			error: function(data){
				loading.hide();
				
				alertify.error([[#{msg.common.valid2}]], 0);
			}
		});
	},
	exitCell : function(_mainLastsel, target){
		if(_mainLastsel != -1){
			var grid = $("#" + target);
			var licenseName = com_fn.getLicenseName(grid.getRowData(_mainLastsel));
			
			grid.jqGrid("setCell", _mainLastsel, "licenseName", licenseName);
			fn_grid_com.saveCellData(grid.attr("id"), _mainLastsel, "licenseName", licenseName, null, null);
			
			grid.jqGrid('saveRow',_mainLastsel);
		}
	},
	exitRow : function(target){
		var gridRowData = $("#" + target).jqGrid("getRowData");
		gridRowData.forEach(function(obj){
			var gridId = obj["gridId"];
			var key = Object.keys(obj);
			key.forEach(function(value){
				if("gridId" != value){
					var data = obj[value];
					if(value == "downloadLocation" || value == "homepage"){
						if(data.indexOf("Different from DB") > -1){
							data = data.split("Different from DB")[0];
						} else if(data.indexOf("The address should be") > -1){
							data = data.split("The address should be")[0];
						}
					} else {
						if(data.indexOf("<div class") > -1){
							data = data.split("<div")[0];
						}
					}
					
					if (value != "copyrightText") data = data.replace(/<[^>]*>?/g, '');
					fn_grid_com.saveCellData(target, gridId, value, data ,null,null);
				}
			});
		});
	},
	setMessage : function(msg){
		var alertMsg  = msg;
		var collabInfoList = [[${@CoCodeManager.getCodeDtls(@CommonFunction.getCoConstDefVal('CD_COLLAB_INFO'))}]]
		if (collabInfoList != null && collabInfoList != "null") {
			var	collabUrl = "";
			for (var i in collabInfoList) {
				if (collabInfoList[i].cdDtlNo == [[${@CommonFunction.getCoConstDefVal('CD_COLLAB_INFO')}]]) {
					collabUrl = collabInfoList[i].cdDtlExp;
				}
			}
			
			alertMsg += "<br>";
			alertMsg += "HELP : <a href='" + collabUrl + "' style='color:#0070c0; text-decoration: underline;'>" + collabUrl + "</a>";
		}
		
		return alertMsg; 
	},
	CheckOssViewPage : function(target){
		var saveFlag = com_fn.saveFlagObject[target.toUpperCase()];
		var referenceDiv;
		
		if (!$(".idenSave").is(":visible")) {
			alertify.alert([[${@CommonFunction.getMessageForDisabled('msg.project.warn.edit.disabled', project.identificationStatus, 'identification')}]], function(){});
			
			return false;
		}
		
		if (!saveFlag) {
			alertify.alert([[#{msg.project.required.checkOssName}]], function(){});
			
			return false;
		}
		
		switch(target.toUpperCase()){
			case "SRC":		referenceDiv = "11";	break;
			case "DEP":		referenceDiv = "16";	break;
			case "ANDROID":	referenceDiv = "14";	break;
			case "BIN":		referenceDiv = "15";	break;
		}
		
		if(_popupCheckOssName != null){
			_popupCheckOssName.close();
		}
		
		_popupCheckOssName = window.open('/oss/checkOssName?prjId='+[[${project.prjId}]]+'&referenceDiv='+referenceDiv+'-'+[[${initDiv}]]+'&targetName=identification', 'Check OSS Name', 'width=1600, height=550, toolbar=no, location=no, left=100, top=100, resizable=yes, scrollbars=yes');

		if(!_popupCheckOssName || _popupCheckOssName.closed || typeof _popupCheckOssName.closed=='undefined') {
			alertify.alert([[#{msg.common.window.allowpopup}]], function(){});
		}
	},
	CheckOssLicenseViewPage : function(target){
		var saveFlag = com_fn.saveFlagObject[target.toUpperCase()];
		var referenceDiv;
		
		if (!$(".idenSave").is(":visible")) {
			alertify.alert([[${@CommonFunction.getMessageForDisabled('msg.project.warn.edit.disabled', project.identificationStatus, 'identification')}]], function(){});
			
			return false;
		}
		
		if (!saveFlag){
			alertify.alert([[#{msg.project.required.checkOssLicense}]], function(){});
			
			return false;
		}

		switch(target.toUpperCase()){
			case "SRC":		referenceDiv = "11";	break;
			case "DEP":		referenceDiv = "16";	break;
			case "ANDROID":	referenceDiv = "14";	break;
			case "BIN":		referenceDiv = "15";	break;
		}
		
		if(_popupCheckOssLicense != null){
			_popupCheckOssLicense.close();
		}
		
		_popupCheckOssLicense = window.open("/oss/checkOssLicense?prjId="+[[${project.prjId}]]+"&referenceDiv="+referenceDiv+"-"+[[${initDiv}]]+"&targetName=identification", "Check License", "width=1150, height=550, toolbar=no, location=no, left=100, top=100, resizable=yes, scrollbars=yes");

		if(!_popupCheckOssLicense || _popupCheckOssLicense.closed || typeof _popupCheckOssLicense.closed=='undefined') {
			alertify.alert([[#{msg.common.window.allowpopup}]], function(){});
		}	
	},
    checkStatus : function(){
		var returnFlag = false;
		
		$.ajax({
			url : "/project/getProjectStatus",
			type : 'POST',
			data : JSON.stringify({"prjId" : [[${project.prjId}]]}),
			dataType : 'json',
			cache : false,
			async : false,
			contentType : 'application/json',
			success : function(data){
				var status = data.identificationStatus||"";
				var curStatus = curIdenStatus||"";
				returnFlag = (status == curStatus);
			},
			error : function(){
				alertify.error([[#{msg.common.valid2}]], 0);
				returnFlag = false;
			}
		});
		
		return returnFlag;
	},
	showLicenseInfo : function(obj){
		var licenseName = $(obj).text().slice(0, -1);

		$.ajax({
			url : "/license/getLicenseId",
			type : 'POST',
			data : {"licenseName" : licenseName},
			dataType : 'json',
			cache : false,
			success : function(data){
				var _frameId = data.licenseId + "_License";
				if (existsTabName(_frameId)) {
					$("#tab--"+_frameId).trigger("click");
				} else {
					var _frameTarget = "/license/edit/" + data.licenseId;
					createTabInFrame(_frameId, _frameTarget);
				}
			},
			error : function(){
				alertify.error([[#{msg.common.valid2}]], 0);
			}
		});
	},
	bulkEdit : function(tab, permission, status){
		if ("3RD" == tab) {
    		alertify.alert([[${@CommonFunction.getCustomMessage('msg.common.jqgrid.func.no.use2', "3rd Party")}]], function(){});
    		return false;
    	} else if ("bom" == tab) {
    		alertify.alert([[${@CommonFunction.getCustomMessage('msg.common.jqgrid.func.no.use2', "BOM")}]], function(){});
    		return false;
    	} else if (!permission) {
    		alertify.alert([[#{msg.common.not.permission}]], function(){});
    		return false;
    	} else if ("CONF" == status) {
    		alertify.alert([[${@CommonFunction.getCustomMessage('msg.common.not.edit.status', 'CONFIRM')}]], function(){});
    		return false
    	} else if ("REQ" == status) {
    		alertify.alert([[${@CommonFunction.getCustomMessage('msg.common.not.edit.status', 'REQUEST')}]], function(){});
    		return false
    	}
		
    	if (!$(".idenSave").is(":visible")) {
			alertify.alert([[${@CommonFunction.getMessageForDisabled('msg.project.warn.edit.disabled', project.identificationStatus, 'identification')}]], function(){});
			
			return false;
		}
    	
        var gridList;
        var targetGird = "";
        
        switch(tab){
            case 'SRC' : 
                gridList = $("#srcList"); targetGird = "srcList";
                break;
            case 'DEP' : 
                gridList = $("#depList"); targetGird = "depList";
                break;
            case 'BIN' : 
                gridList = $("#binList"); targetGird = "binList";
                break;
            case 'BINANDROID' : 
                gridList = $("#binAndroidList"); targetGird = "binAndroidList";
                break;
        }

        var selarrrow = gridList.jqGrid("getGridParam", "selarrrow");
        var rowCheckedArr = [];
        for(var i=0; i<selarrrow.length; i++){
			if($("input:checkbox[id='jqg_" + targetGird + "_" + selarrrow[i] + "']").is(":checked")){
				rowCheckedArr.push(selarrrow[i]);
			}
        }

        if (rowCheckedArr.length > 0) {
        	com_fn.exitCell(_mainLastsel, targetGrid);
        	var _popup = null;
			
            if (_popup == null || _popup.closed) {
            	_popup = window.open("", "bulkEditViewProjectPopup", "width=850, height=600, toolbar=no, location=no, left=100, top=100, resizable=yes");

            	$("#bulkEditForm > input[name=rowId]").val(rowCheckedArr);
				$("#bulkEditForm > input[name=target]").val(targetGird);
				$("#bulkEditForm").submit();

                if(!_popup || _popup.closed || typeof _popup.closed=='undefined') {
                    alertify.alert([[#{msg.common.window.allowpopup}]], function(){});
                }
            } else {
                _popup.close();
                _popup = window.open("", "bulkEditViewProjectPopup", "width=850, height=600, toolbar=no, location=no, left=100, top=100, resizable=yes");

                $("#bulkEditForm > input[name=rowId]").val(rowCheckedArr);
				$("#bulkEditForm > input[name=target]").val(targetGird);
				$("#bulkEditForm").submit();
            }
        } else {
            alertify.alert([[#{msg.oss.select.ossTable}]], function(){});
            return false;
        }
    },
    bulkEditOssInfo : function(obj){
		var editFlag = false;
	   	try{
    		var ossArr = [];
            var rowId = obj["rowId"];
            var target = obj["target"];
            var param = $('#'+target).jqGrid('getGridParam','data');
            
            if(rowId.indexOf(",") > -1){
                ossArr = rowId.split(",");
                for(var idx in ossArr){
                    com_fn.bulkEditSetCell(target, ossArr[idx], obj);

                    for (var i=0; i<param.length; i++){
                        if(param[i]["gridId"] == ossArr[idx]){
                            for(var key in obj){
                                if(key != "rowId" && key != "target"){
                                	param[i][key] = obj[key];
                                }
                            }
                        }
                    }
                }
            } else {
                com_fn.bulkEditSetCell(target, rowId, obj);

                for (var i=0; i<param.length; i++){
                    if(param[i]["gridId"] == rowId){
                        for(var key in obj){
                            if(key != "rowId" && key != "target"){
                            	param[i][key] = obj[key];
                            }
                        }
                    }
                }
            }

            $("#"+target).jqGrid('setGridParam', {data:param}).trigger('reloadGrid');
    	} catch(e) {
    		alertify.error([[#{msg.common.valid2}]], 0);
    		editFlag = true;
    	} finally {
        	if(!editFlag){
        		alertify.success([[#{msg.common.success}]]);
            }
       	}
    },
    bulkEditSetCell : function (target, rowId, obj){
        for(var key in obj){
            if(key != "rowId" && key != "target"){
            	$('#'+target).jqGrid('setCell', rowId, key, obj[key]);
            }
        }
    },
    bulkEditDelRow : function (target, rowId, flag){
		var delFlag = false;
		try{
        	var selrow = "";
    		var param = $("#"+target).jqGrid('getGridParam', 'data');
    		
        	if(rowId.indexOf(",") > -1){
        		selrow = rowId.split(",");
        		for (var i=0; i<selrow.length; i++){
        			$("#"+target).jqGrid('delRowData', selrow[i]);
        			param = com_fn.bulkEditDeleteLocalDataAfterDelRow(param, selrow[i]);
            	}
            }else{
            	$("#"+target).jqGrid('delRowData', rowId);
            	param = com_fn.bulkEditDeleteLocalDataAfterDelRow(param, rowId);
            }

            if(flag == "main"){
            	$("#"+target).jqGrid('GridUnload');

            	if(target == "depList"){
            		depMainData = param;
            		dep_grid.load();
            		// total record 표시
            		$("#depList_toppager_right, #depPager_right").html('<div dir="ltr" style="text-align:right" class="ui-paging-info">Total : '+depMainData.length+'</div>');
            	} else if(target == "srcList"){
                	srcMainData = param;
                	src_grid.load();
                	// total record 표시
            		$("#srcList_toppager_right, #srcPager_right").html('<div dir="ltr" style="text-align:right" class="ui-paging-info">Total : '+srcMainData.length+'</div>');
                } else if(target == "binList"){
                	binMainData = param;
    				bin_grid.load();
    				// total record 표시
    				$("#binList_toppager_right, #binPager_right").html('<div dir="ltr" style="text-align:right" class="ui-paging-info">Total : '+binMainData.length+'</div>');
                } else if(target == "binAndroidList"){
                	binAndroidMainData = param;
    				binAndroid_grid.load();
    				// total record 표시
    				$("#binAndroidList_toppager_right, #binAndroidPager_right").html('<div dir="ltr" style="text-align:right" class="ui-paging-info">Total : '+binAndroidMainData.length+'</div>');
                }
            }
        }catch(e){
        	alertify.error([[#{msg.common.valid2}]], 0);
        	delFlag = true;
        }finally{
            if(!delFlag){
    			alertify.success([[#{msg.common.success}]]);
            }
        }
    },
    bulkEditDeleteLocalDataAfterDelRow : function (dataArray, rowId){
    	var reMakeArrObj=[];
    	var newIdx = 0;

    	for(var idx=0; idx < dataArray.length; idx++) {
			if(dataArray[idx].gridId != rowId) {
				reMakeArrObj[newIdx++] = dataArray[idx];
			}
		}

		return reMakeArrObj;
    },
    downloadYaml : function(target) {
    	loadingIden.show();
    	
        var params = {'prjId':[[${project.prjId}]], 'prjName' : [[${project.prjName}]]};

        switch(target.toUpperCase()){
            case "SRC":     referenceDiv = "11";    break;
            case "BOM":     referenceDiv = "13";    break;
            case "ANDROID": referenceDiv = "14";    break;
            case "BIN":     referenceDiv = "15";    break;
            case "DEP":		referenceDiv = "16";	break;
        }

        $.ajax({
            type: "POST",
            url: "/project/makeYaml/"+referenceDiv,
            data: JSON.stringify(params),
            dataType : 'json',
            cache : false,
            contentType : 'application/json',
            success: function (data) {
            	loadingIden.hide();
            	
                if("false" == data.isValid) {
                    alertify.error([[#{msg.common.valid2}]], 0);
                } else {
                    window.location = "/exceldownload/getFile?id=" + data.validMsg;
                }
            },
            error: function(data){
                alertify.error([[#{msg.common.valid2}]], 0);
            }
        });
    },
    downloadCycloneDXJson : function (target) {
    	loadingIden.show();
    	
		$.ajax({
			type: "POST",
			url: "/cyclonedxdownload/getCycloneDXPost",
			data: JSON.stringify({"type":"cycloneDXJson", "prjId":[[${project.prjId}]]}),
			dataType : 'json',
			cache : false,
			contentType : 'application/json',
			success: function (data) {
				loadingIden.hide();
				
				if("false" == data.isValid) {
					if (typeof data.validMsg !== "undefined") {
						if (data.validMsg.indexOf("generation failed") != -1) {
							alertify.error(data.validMsg, 0);
						} else {
							alertify.error([[#{msg.common.valid2}]], 0);
						}
					} else {
						alertify.error([[#{msg.common.valid2}]], 0);
					}
				} else {
					window.location = '/cyclonedxdownload/getFile?id='+data.validMsg;
				}
			},
			error: function(data){
				alertify.error([[#{msg.common.valid2}]], 0);
			}
		});
	},
	downloadCycloneDXXml : function (target) {
		loadingIden.show();
		
		$.ajax({
			type: "POST",
			url: "/cyclonedxdownload/getCycloneDXPost",
			data: JSON.stringify({"type":"cycloneDXXml", "prjId":[[${project.prjId}]]}),
			dataType : 'json',
			cache : false,
			contentType : 'application/json',
			success: function (data) {
				loadingIden.hide();
				
				if("false" == data.isValid) {
					if (typeof data.validMsg !== "undefined") {
						if (data.validMsg.indexOf("generation failed") != -1) {
							alertify.error(data.validMsg, 0);
						} else {
							alertify.error([[#{msg.common.valid2}]], 0);
						}
					} else {
						alertify.error([[#{msg.common.valid2}]], 0);
					}
				} else {
					window.location = '/cyclonedxdownload/getFile?id='+data.validMsg;
				}
			},
			error: function(data){
				alertify.error([[#{msg.common.valid2}]], 0);
			}
		});
	},
	deleteFiles : function(obj, type){
		var FileSeq = [];
		var tabGubn = $("[id^='tabMenu'].active").text();
		var seq = $(obj).prev().val();
		var referenceDiv = "";
		
		if(seq == ""){
			return;
		}
		
		switch(tabGubn.toUpperCase()){
			case "SRC":		referenceDiv = "11";	break;
			case "DEP":		referenceDiv = "16";	break;
			case "ANDROID":	referenceDiv = "14";	break;
			case "BIN":		referenceDiv = "15";	break;
		}
		
		var object = {fileSeq : seq};
		FileSeq.push(object);
		var Data = {"csvDelFileIds" : JSON.stringify(FileSeq), "prjId" : [[${project.prjId}]], "referenceDiv" : referenceDiv};
		
		$.ajax({
			url : "/project/deleteFiles",
			type : 'POST',
			data : JSON.stringify(Data),
			dataType : 'json',
			cache : false,
			contentType : 'application/json',
			success: function(data){
				if ("10" == data.resCd){
					alertify.success([[#{msg.common.success}]]);
					$(obj).closest('li').remove();
					if ("15" == referenceDiv) {
						if ("2" == type) {
//							bin_fn.binaryUploadFile();
							$(".binBinaryFileDiv").hide();
						}
					}
				} else {
					alertify.error([[#{msg.common.valid2}]], 0);
				}
			},
			error: function(data){
				alertify.error([[#{msg.common.valid2}]], 0);
			}
		});
	},
	resetDeleteFiles : function (fileSeqs, menu, target) {
		var referenceDiv = "";
		
		switch(menu.toUpperCase()){
			case "DEP":		referenceDiv = [[${@CommonFunction.getCoConstDefVal('CD_DTL_COMPONENT_ID_DEP')}]];	break;
			case "SRC":		referenceDiv = [[${@CommonFunction.getCoConstDefVal('CD_DTL_COMPONENT_ID_SRC')}]];	break;
			case "BIN":		referenceDiv = [[${@CommonFunction.getCoConstDefVal('CD_DTL_COMPONENT_ID_BIN')}]];	break;
			case "ANDROID":	referenceDiv = [[${@CommonFunction.getCoConstDefVal('CD_DTL_COMPONENT_ID_ANDROID')}]];	break;
		}

		var Data = {"csvDelFileIds" : JSON.stringify(fileSeqs), "prjId" : [[${project.prjId}]], "referenceDiv" : referenceDiv};
		
		$.ajax({
			url : "/project/deleteFiles",
			type : 'POST',
			data : JSON.stringify(Data),
			dataType : 'json',
			cache : false,
			contentType : 'application/json',
			success: function(data){
				if ("10" == data.resCd){
					alertify.success([[#{msg.common.success}]]);
					$("." + target).empty();
					if ("bin" == menu) {
						$(".binBinaryFileArea" + target).empty();
					}
					com_fn.changeMode('view', true);
				} else {
					alertify.error([[#{msg.common.valid2}]], 0);
				}
			},
			error: function(data){
				alertify.error([[#{msg.common.valid2}]], 0);
			}
		});
	},
	checkSelectDownloadFile : function (target) {
		var rtnObj;
		var referenceDiv = "";
		var params = {'prjId':[[${project.prjId}]]};
		
		switch(target.toUpperCase()){
			case "SRC":		referenceDiv = "11";	break;
			case "BOM":		referenceDiv = "13";	break;
			case "BIN":		referenceDiv = "15";	break;
			case "DEP":		referenceDiv = "16";	break;
		}
		
		$.ajax({
    		type: "POST",
			url: "/project/checkSelectDownloadFile/"+referenceDiv,
			data: JSON.stringify(params),
			dataType : 'json',
			cache : false,
			async : false,
			contentType : 'application/json',
			success: function (data) {
				rtnObj = data;
			},
			error: function(data){
				alertify.error([[#{msg.common.valid2}]], 0);
			}
    	});
    	
		return rtnObj;
	},
	bomReqeustStart : function () {
		if (Bom_Save_Flg) {
			if (!isAndroidModel) {
				if ($('#bomList').jqGrid('getDataIDs').length == 0 && "Y" != $("#mergeYn").val()) {
					alertify.alert([[#{msg.project.required.bomSave}]], function(){
						$("#tabMenuBom").trigger("click");
					});
					
					return false;
				}
			}
			
			if (typeof alertify.bomRequestDialog === 'undefined') {
				commonAlertifyDialog('bomRequestDialog');
        	}
			
			var innerHtml 	= [[${@CommonFunction.getCustomMessage('msg.common.enter.comment.save', 'msg.common.enter.comment.field.request', true)}]];
       		innerHtml 		+= '<br><textarea id="bomRequestEditor"></textarea>';
			
       		alertify.bomRequestDialog()
       		.set('onok', function(e) {
       			if(e) {
       				if (userRole != "ROLE_ADMIN"){
						if (!isAndroidModel && !com_fn.validBomChangeStatus(isAndroidModel)) {
							return false;
						}
					}
					
					var editorVal = $("#bomRequestEditor").summernote('code');
       				if ("" != $(editorVal).text().trim() || $(editorVal).find('img').length > 0) {
       				} else {
       					editorVal = "";
       				}
					
					var data = {"prjId" : [[${project.prjId}]], "identificationStatus" : "REQ", "userComment" : editorVal};

					com_fn.checkSave(data, "REQ");
				} else {
					alertify.alert([[#{msg.project.warn.project.status}]], function(){});
				}
       		})
       		.set('onshow', function(e){
           		$("#bomRequestEditor").summernote({height: 180, minHeight: null, maxHeight: null, lang: "ko-KR"});
           	})
           	.set('title', 'Request').setContent(innerHtml)
			.show();
		} else {
			alertify.alert([[#{msg.project.check.save}]], function(){});
		}
	},
	closeAlertifyView : function () {
		$(".ajs-close").trigger("click");
	},
	gridAddFunc : function (tab, targetId, permission, status) {
		if ("3RD" == tab) {
			alertify.alert([[${@CommonFunction.getCustomMessage('msg.common.jqgrid.func.no.use2', '3rd Party')}]], function(){});
		} else if ("bom" == tab) {
			alertify.alert([[${@CommonFunction.getCustomMessage('msg.common.jqgrid.func.no.use2', 'BOM')}]], function(){});
		} else if (!permission) {
			alertify.alert([[#{msg.common.not.permission}]], function(){});
		} else if ("CONF" == status) {
			alertify.alert([[${@CommonFunction.getCustomMessage('msg.common.not.edit.status', 'CONFIRM')}]], function(){});
		} else if ("REQ" == status) {
			alertify.alert([[${@CommonFunction.getCustomMessage('msg.common.not.edit.status', 'REQUEST')}]], function(){});
		} else {
			var grid = $("#" + targetId);
			com_fn.saveFlagObject[tab] = false;
			fn_grid_com.rowAddNew(targetId, grid, "main", null, com_fn.getLicenseName);
		}
	},
	gridDelFunc : function (gubn, targetId, target, permission, status) {
		if ("3RD" == gubn) {
			alertify.alert([[${@CommonFunction.getCustomMessage('msg.common.jqgrid.func.no.use2', '3rd Party')}]], function(){});
		} else if ("bom" == gubn) {
			alertify.alert([[${@CommonFunction.getCustomMessage('msg.common.jqgrid.func.no.use2', 'BOM')}]], function(){});
		} else if (!permission) {
			alertify.alert([[#{msg.common.not.permission}]], function(){});
		} else if ("CONF" == status) {
			alertify.alert([[${@CommonFunction.getCustomMessage('msg.common.not.edit.status', 'CONFIRM')}]], function(){});
		} else if ("REQ" == status) {
			alertify.alert([[${@CommonFunction.getCustomMessage('msg.common.not.edit.status', 'REQUEST')}]], function(){});
		} else {
			var grid = $("#" + targetId);
			var selarrrow = grid.jqGrid("getGridParam", "selarrrow");
			
			if (selarrrow.length > 0) {
				fn_grid_com.rowDelNew(grid, target);
			} else {
				alertify.confirm([[#{msg.common.confirm.delete.all}]], function (e) {
					if (e) {
						fn_grid_com.rowDelAll(grid, target);
					} else {
						return false;
					}
				});
			}
		}
	},
	changeMode : function(mode, resetFlag) {
		var targetId = $("#menu-tab").find(".active").attr("aria-controls");
		var tabDiv = targetId.split("-")[1];
		var modeFlag = "";
		if ("view" == mode) {
			modeFlag = "N";
		} else {
			modeFlag = "Y";
		}
		
		var target = "";
        switch (tabDiv) {
            case "third" : 
            	target = "_3rdAddList";
                break;
            case "dep" : 
            	target = "_depAddList";
                break;
            case "src" : 
            	target = "_srcAddList";
                break;
            case "bin" : 
            	target = "_binAddList";
                break;
            case "android" : 
            	target = "_binAndroidProjectList2";
                break;
        }
		
		if ("menu-bom" != targetId) {
			$.ajax({
	            url: "/project/identification/" + [[${project.prjId}]] + "/" + tabDiv + "/" + mode,
	            type: 'POST',
	            dataType: 'html',
	            cache: false,
	            success: function (data) {
	            	$("#" + targetId).empty();
					$("#" + targetId).html(data);
					
					switch (tabDiv) {
						case "third" :
							if (!resetFlag) {
								$('#_list').jqGrid(party_evt.setParamParty1());
								$('#_list2').jqGrid(party_evt.setParamParty2());
							}
							
							if ("edit" == mode) {
								$(".partyBtn").show();
								callAutoCompleteFnc("autoComConfParty");
								callAutoCompleteFnc("autoComProjectNmConf");
								
								party_evt.partySearchSelect();
								party_evt.partyProjectSelect();
								
								if ("N" == $("input[name='identificationSubStatusPartner']").val()) {
									com_fn.customCheckApplicable("partyBtn", "edit");
								} else {
									$('#_3rdAddList').jqGrid(party_evt.setParamParty3());
								}
							} else {
								if ("N" == $("input[name='identificationSubStatusPartner']").val()) {
									com_fn.customCheckApplicable("partyBtn", "view");
								} else {
									$('#_3rdAddList').jqGrid(party_evt.setParamParty3());
								}
							}
							
							setTimeout(function () {
								$("#tabMenuParty").trigger("click");
							}, 200);
							
							break;
						case "dep" : 
							if (!resetFlag) {
								dep_fn.csvUploadFile();
								$('#_depAddList').jqGrid(dep_fn.setParamProject3());
							}
							
							if ("edit" == mode) {
								$(".depBtn").show();
								callAutoCompleteFnc("autoComProjectNmConf");
								dep_fn.depProjectSelect();
								
								if ("N" == $("input[name='identificationSubStatusDep']").val()) {
									com_fn.customCheckApplicable("depBtn", "edit");
								}
							} else {
								if ("N" == $("input[name='identificationSubStatusDep']").val()) {
									com_fn.customCheckApplicable("depBtn", "view");
								}
							}
							
							setTimeout(function () {
								$("#tabMenuDep").trigger("click");
							}, 200);
							
							break;
						case "src" : 
							if (!resetFlag) {
								src_fn.csvUploadFile();
								$('#_srcAddList').jqGrid(src_fn.setParamProject3());
							}
							
							if ("edit" == mode) {
								$(".srcBtn").show();
								callAutoCompleteFnc("autoComProjectNmConf");
								src_evt.srcProjectSelect();
								
								if ("N" == $("input[name='identificationSubStatusSrc']").val()) {
									com_fn.customCheckApplicable("srcBtn", "edit");
								}
							} else {
								if ("N" == $("input[name='identificationSubStatusSrc']").val()) {
									com_fn.customCheckApplicable("srcBtn", "view");
								}
							}
							
							break;
						case "bin" : 
							if (!resetFlag) {
								bin_fn.csvUploadFile();
//								bin_fn.binaryUploadFile();
								$('#_binAddList').jqGrid(bin_fn.setParamProject3());
							}
							
							if ("edit" == mode) {
								$(".binBtn").show();
								callAutoCompleteFnc("autoComProjectNmConf");
								bin_evt.binProjectSelect();
								
								if ("N" == $("input[name='identificationSubStatusBin']").val()) {
									com_fn.customCheckApplicable("binBtn", "edit");
								}
							} else {
								if ("N" == $("input[name='identificationSubStatusBin']").val()) {
									com_fn.customCheckApplicable("binBtn", "view");
								}
							}
							
							setTimeout(function () {
								$("#tabMenuBin").trigger("click");
							}, 200);
							
							break;
						case "android" : 
							if (!resetFlag) {
								binAndroid_fn.csvUploadFile();
								binAndroid_fn.noticeUploadFile();
								binAndroid_fn.resultUploadFile();
								
								$('#_binAndroidProjectList2').jqGrid(binAndroid_fn.setParamProject2());
								$('#_binAndroidProjectList2').jqGrid('filterToolbar',{stringResult: true, searchOnEnter: true, searchOperators: true, defaultSearch: "cn"});
							}
							
							if ("edit" == mode) {
								$(".binAndroidBtn").show();
								callAutoCompleteFnc("autoComProjectNmConf");
								binAndroid_fn.binAndroidProjectSelect();
								
								if ("N" == $("input[name='identificationSubStatusAndroid']").val()) {
									com_fn.customCheckApplicable("binAndroidBtn", "edit");
								}
							} else {
								if ("N" == $("input[name='identificationSubStatusAndroid']").val()) {
									com_fn.customCheckApplicable("binAndroidBtn", "view");
								}
							}
							
							break;
						case "bat" : 
							bat_fn.binaryUploadFile();
							break;
					}
	            },
	            error: function () {
	                alertify.error([[#{msg.common.valid2}]], 0);
	            },
	            complete : function(xhr, status) {
	            	if ("third" == tabDiv) {
            			$("#tabMenuParty").trigger("click");
	            	} else if ("dep" == tabDiv) {
	            		$("#tabMenuDep").trigger("click");
	            	} else if ("src" == tabDiv) {
	            		$("#tabMenuSrc").trigger("click");
	            	} else if ("bin" == tabDiv) {
	            		$("#tabMenuBin").trigger("click");
	            	} else if ("android" == tabDiv) {
	            		$("#tabMenuBinAndroid").trigger("click");
	            	}
	            }
			});
		}
	},
	save : function (tab) {
		if ("Party" == tab) {
			party_evt.save();
		} else if ("Dep" == tab) {
			dep_fn.save();
		} else if ("Src" == tab) {
			src_fn.save();
		} else if ("Bin" == tab) {
			bin_fn.save();
		} else if ("Bat" == tab) {
			bat_fn.save();
		} else if ("BinAndroid" == tab) {
			binAndroid_fn.save();
		} else if ("Bom" == tab) {
			bom_fn.beforeSave(false);
		}
	},
	reset : function (tab) {
		if ("Bom" == tab) {
			bom_fn.reset();
		} else {
			var componentId = "";
			var msg = [[#{msg.common.delete.records}]];
			
			if ("Party" == tab) {
				componentId = [[${@CommonFunction.getCoConstDefVal('CD_DTL_COMPONENT_ID_PARTNER')}]];
			} else {
				if ("Dep" == tab) {
					componentId = [[${@CommonFunction.getCoConstDefVal('CD_DTL_COMPONENT_ID_DEP')}]];
				} else if ("Src" == tab) {
					componentId = [[${@CommonFunction.getCoConstDefVal('CD_DTL_COMPONENT_ID_SRC')}]];
				} else if ("Bin" == tab) {
					componentId = [[${@CommonFunction.getCoConstDefVal('CD_DTL_COMPONENT_ID_BIN')}]];
				} else if ("BinAndroid" == tab) {
					componentId = [[${@CommonFunction.getCoConstDefVal('CD_DTL_COMPONENT_ID_ANDROID')}]];
				}
			}
			
			alertify.confirm(msg, function(e){
				if (e) {
					com_fn.resetAll(tab, componentId)
				} else {
					return false;
				}
			});
		}
	},
	resetAll : function (tab, initDiv) {
		var referenceDiv = [[${@CommonFunction.getCoConstDefVal('CD_DTL_COMPONENT_ID_BOM')}]];
		if ("Party" == tab) {
			party_evt.reset();
		} else if ("Dep" == tab) {
			dep_fn.reset();
		} else if ("Src" == tab) {
			src_fn.reset();
		} else if ("Bin" == tab) {
			bin_fn.reset();
		} else if ("Bat" == tab) {
			bat_fn.reset();
		} else if ("Bom" == tab) {
			bom_fn.reset();
		}
		
		com_fn.getIdentificationAddList(referenceDiv);
	},
	nicknameAlertifyTemplate : function (target) {
		alertify.dialog(target, function() {
			return {
				setup: function() {
					var settings = alertify.confirm().settings;
					
					for (var prop in settings) {
						this.settings[prop] = settings[prop];
					}
					
					var setup = alertify.confirm().setup();
					setup.focus.element = 0;

					return setup;
				},
				hooks: {
					onshow: function() {
						this.elements.dialog.style.maxWidth = '750px';
						this.elements.dialog.style.width = 'none';
					}
				}
			};
		}, false, 'alert');
	},
	downloadSampleReport : function () {
		var logiPath = "/sample/FOSSLight-Identification-Sample.xlsx";
		var fileName = "FOSSLight-Identification-Sample.xlsx";

		location.href = '/partner/sampleDownload?fileName='+fileName+'&logiPath='+logiPath;
	},
	changeSearchOption : function (obj) {
		var value = $(obj).val();
		if ("prj" == value) {
			$("#partnerInputArea").hide();
			$("#projectInputArea").show();
			$("#prjName").prop('disabled', false);
			$("#3rdSearchText").prop('disabled', true);
		} else {
			$("#projectInputArea").hide();
			$("#partnerInputArea").show();
			$("#prjName").prop('disabled', true);
			$("#3rdSearchText").prop('disabled', false);
			callAutoCompleteFnc("autoComConfParty");
		}
	},
	projectSearch : function () {
		var postData = $('#commonSearchForm').serializeObject();
		
		$('#_searchProjectList1').jqGrid('setGridParam', {postData:postData}).trigger("reloadGrid");
		$('.searchProject1').show();
		$('.searchProject2').hide();
	},
	setParamProject1 : function(referenceDiv) {
		return {
			url: '/project/identificationProject/' + referenceDiv,
			datatype: 'json',
			jsonReader:{
				repeatitems: false,
				id: 'prjId',
			},
			colNames: ['Project Id','Project Name','Project Version','Distribution Type', 'Creator','Created Date', 'Comment'],
			colModel: [
				{name: 'prjId', index: 'prjId', width: 42, align: 'center'},
				{name: 'prjName', index: 'prjName', width: 240, align: 'left'},
				{name: 'prjVersion', index: 'prjVersion', width: 200, align: 'left'},
				{name: 'distributionType', index: 'distributionType', width: 110, align: 'left'},
				{name: 'creator', index: 'creator', width: 110, align: 'center'},
				{name: 'createdDate', index: 'createdDate', width: 110, align: 'center',  formatter:'date', formatoptions: {srcformat: 'Y-m-d H:i:s.t', newformat: 'Y-m-d'}},
				{name: 'comment', index: 'comment', width: 139, align: 'left', formatter: fn_grid_com.displayComment, unformat: fn_grid_com.unFormatter}
			],
			onSelectRow: function(id) {
				com_fn.identificationProjectSearch(id, referenceDiv);
//				$('.searchProject2').show();
			},
			autoencode: true,
			autowidth: true,
			gridview: true,
			sortable: function(permutation){
			},
			rowNum: 20,
			rowList: [20, 40, 60],
			pager: '#searchProjectPager1',
			sortname: 'prjId',
			sortorder: 'asc',
			loadonce: false,
			height: 'auto',
			mtype: 'GET',
			loadComplete: function(data){
				$('.commentDiv').find('p').css('margin','0px 0px');
			},
			gridComplete: function() {
				$('#_searchProjectList1').closest(".ui-jqgrid-bdiv").children(":first").css({"max-height": "360px"});
				$("#_searchProjectList1").jqGrid("setGridWidth", 0, true);
		        $("#_searchProjectList1").jqGrid("setGridWidth", 760, true);
			}
		}
	},
	setParamProject2 : function() {
		return {
			datatype: 'local',
			colNames: ['ID_KEY','ID','ReferenceId','Source Name or Path','OSS Name','OSS Version','License', 'Vulnerability','Exclude'],
			colModel: [
			
				{name: 'componentId', index: 'componentId', width: 40, align: 'center', key:true, hidden:true},
				{name: 'componentIdx', index: 'componentIdx', width: 40, align: 'center', sorttype: 'int', search: false},
				{name: 'referenceId', index: 'referenceId', width: 40, align: 'center', hidden:true},
				{name: 'filePath', index: 'filePath', width: 150, align: 'left', template: searchStringOptions},
				{name: 'ossName', index: 'ossName', width: 300, align: 'left', template: searchStringOptions},
				{name: 'ossVersion', index: 'ossVersion', width: 150, align: 'center', template: searchStringOptions},
				{name: 'licenseName', index: 'licenseName', width: 218, align: 'left', formatter: fn_grid_com.displayLicense, template: searchStringOptions},
				{name: 'cvssScore', index: 'cvssScore', width: 98, align: 'center', formatter:fn_grid_com.displayVulnerability, unformatter:fn_grid_com.unformatter, template: searchNumberOptions, sortable : true, sorttype:'float'},
				{name: 'excludeYn', index: 'excludeYn', width: 40, align: 'center', hidden:true}
			],
			onSelectRow: function(id){},
			autoencode: true,
			autowidth: true,
			gridview: true,
			sortable: function(permutation){},
			rowNum: 10000,
			rowTotal: -1,
			//scroll: 1,
 			sortname: 'componentIdx',
			loadonce: true,
			height: '500',
			mtype: 'GET',
			loadComplete: function(data){},
			gridComplete:function (){
				var target = $("#_searchProjectList2");
				var data = target.jqGrid("getRowData");

				for (var i=0; i<data.length; i++){
					if(data[i ].excludeYn=="Y"){
						target.jqGrid('setRowData', data[i].componentId, false, { background:'gray'});
					}
				}
				
				$('#_searchProjectList2').closest(".ui-jqgrid-bdiv").children(":first").css({"max-height":"360px"});
				$("#_searchProjectList2").jqGrid("setGridWidth", 0, true);
		        $("#_searchProjectList2").jqGrid("setGridWidth", 760, true);
			}
		}
	},
	identificationProjectSearch : function (id, referenceDiv) {
		const data = {
	        category: "project/fragments",
	      	templateName: "edit",
	       	fragmentName: "searchSheetFragments"
	  	};

	    postAjaxJsonData(JSON.stringify(data), "/render/component", 'html', function (res) {
	      	loading.hide();
	      	
	      	var tempBody = $('<div>').html(res);
	      	if (typeof alertify.projectSearchAlert === "undefined") {
	      		alertifyUploadDialog("projectSearchAlert", "500", "dialog_selectSearch_" + [[${project.prjId}]]);
	      	}
	      	
	      	$("#_searchProjectList2").jqGrid('clearGridData');
			var postData = $("#_searchProjectList2").jqGrid('getGridParam', 'postData');
			postData.referenceId = id;
			
	        $.ajax({
	        	url : '/project/identificationProjectSearch/' + referenceDiv,
	            type : 'GET',
	            dataType : 'json',
	            data : postData,
	            cache : false,
	            async : false,
	            success : function(data) {
	            	var searchData = [];
	            	var thirdInfo = [];
	            	var thirdData = [];
	            	
	            	if (typeof data.rows !== "undefined") {
	            		// check the selectable sheets
	            		searchData = data.rows;
	            	}
	            	if (typeof data.thirdInfo !== "undefined") {
	            		thirdInfo = data.thirdInfo;
	            	}
	            	if (typeof data.thirdData !== "undefined") {
	            		thirdData = data.thirdData;
	            	}
	            	
	            	var thirdCheck = false;
        			var depCheck = false;
        			var srcCheck = false;
        			var binCheck = false
	            	
	            	if ([[${@CommonFunction.getCoConstDefVal('CD_DTL_COMPONENT_ID_BOM')}]] == referenceDiv) {
	            		var	depData = [];
	            		var srcData = [];
	            		var binData = [];
	            		
	            		let depIdx = 100000;
	            		let srcIdx = 100000;
	            		let binIdx = 100000;
	            		
            			for (var i in searchData) {
            				searchData[i]["comments"] = "(From Prj " + id + ")";
            				if ([[${@CommonFunction.getCoConstDefVal('CD_DTL_COMPONENT_ID_DEP')}]] == searchData[i].referenceDiv) {
            					depCheck = true;
            					searchData[i]["componentId"] = "";
            					searchData[i]["gridId"] = "jqg" + depIdx;
            					searchData[i]["prjId"] = [[${project.prjId}]];
            					searchData[i]["refLoadedVal"] = id;
            					depData.push(searchData[i]);
            					depIdx++;
            				} else if ([[${@CommonFunction.getCoConstDefVal('CD_DTL_COMPONENT_ID_SRC')}]] == searchData[i].referenceDiv) {
            					srcCheck = true;
            					searchData[i]["componentId"] = "";
            					searchData[i]["gridId"] = "jqg" + srcIdx;
            					searchData[i]["prjId"] = [[${project.prjId}]];
            					searchData[i]["refLoadedVal"] = id;
            					srcData.push(searchData[i]);
            					srcIdx++;
            				} else if ([[${@CommonFunction.getCoConstDefVal('CD_DTL_COMPONENT_ID_BIN')}]] == searchData[i].referenceDiv) {
            					binCheck = true;
            					searchData[i]["componentId"] = "";
            					searchData[i]["gridId"] = "jqg" + binIdx;
            					searchData[i]["prjId"] = [[${project.prjId}]];
            					searchData[i]["refLoadedVal"] = id;
            					binData.push(searchData[i]);
            					binIdx++;
            				}
            			}
            			
            			if (thirdInfo.length > 0) {
            				searchedData["thirdInfo"] = thirdInfo;
            			}
            			if (thirdData.length > 0) {
            				thirdCheck = true;
            				searchedData["thirdData"] = thirdData;
            			}
						if (depData.length > 0) {
							searchedData["dep"] = depData;
            			}
						if (srcData.length > 0) {
							searchedData["src"] = srcData;
						}
						if (binData.length > 0) {
							searchedData["bin"] = binData;
						}
            			tempBody.find('#selectSearchApply').attr('onclick', 'com_fn.getSearchData(' + id + ',' + referenceDiv + ')');
            		} else {
            			
            		}
	            	
	            	alertify.projectSearchAlert().setContent(tempBody.html()).show();
	    			$(alertify.projectSearchAlert()).find(".ajs-content").css("padding", "0");
	    			
	    			var prjInfo = data.project;
	    			var prjName = "#" + prjInfo.prjId + " " + prjInfo.prjName;
	    			if ("" != prjInfo.prjVersion) {
	    				prjName += " (" + prjInfo.prjVersion + ")";
	    			}
	    			$("#prjNameVersion").html(prjName);
	    			
	    			if (thirdCheck) {
        				$("#3rdCheck").prop('checked', true);
        			} else {
        				$("#3rdCheck").prop('disabled', true);
        			}
					if (depCheck) {
						$("#depCheck").prop('checked', true);
        			} else {
        				$("#depCheck").prop('disabled', true);
        			}
					if (srcCheck) {
						$("#srcCheck").prop('checked', true);
					} else {
						$("#srcCheck").prop('disabled', true);
					}
					if (binCheck) {
						$("#binCheck").prop('checked', true);
					} else {
						$("#binCheck").prop('disabled', true);
					}
	            },
	            error : function(xhr, ajaxOptions, thrownError){
	                alertify.error([[#{msg.common.valid2}]], 0);
	            }
	        });
	    });
	},
	getSearchData : function (referenceId, referenceDiv) {
		var selectTabs = [];
		$('input:checkbox[name="searchCheck"]').each(function(){
			if ($(this).is(':checked')){
				selectTabs.push($(this).val());
			}
		});
		
		var loadedTab = uploadGridData.filter(function(a){
			if (a.item.indexOf("-") > -1) {
				let itemStr = a.item.split("-")[1];
				if (itemStr == referenceId) {
					return a;
				}
			}
		});
		
		var selectedTabs = [];
		if (loadedTab.length > 0) {
			loadedTab = loadedTab[0].loadedTab;
			loadedTab = loadedTab.split(",");
			for (var i in loadedTab) {
				let tabNm = loadedTab[i].split("(")[0];
				if ("3rdParty" == tabNm) {
					selectedTabs.push([[${@CommonFunction.getCoConstDefVal('CD_DTL_COMPONENT_ID_PARTNER')}]]);
				} else if ("DEP" == tabNm) {
					selectedTabs.push([[${@CommonFunction.getCoConstDefVal('CD_DTL_COMPONENT_ID_DEP')}]]);
				} else if ("SRC" == tabNm) {
					selectedTabs.push([[${@CommonFunction.getCoConstDefVal('CD_DTL_COMPONENT_ID_SRC')}]]);
				} else if ("BIN" == tabNm) {
					selectedTabs.push([[${@CommonFunction.getCoConstDefVal('CD_DTL_COMPONENT_ID_BIN')}]]);
				}
			}
		}
		
		if (selectTabs.length == 0) {
			alertify.alert([[#{msg.common.select.tab}]], function(){});
			return;
		} else {
			loadingIden.show();
			
			var selectedFlag = false;
			var deduplicatedTabs = [];
			var duplicatedTabs = [];
			
			if (selectedTabs.length > 0) {
				selectedFlag = true;
				for (var i in selectTabs) {
					let selectTab = selectTabs[i];
					let isDuplicate = false;
					for (var j in selectedTabs) {
						if (selectTab === selectedTabs[j]) {
							isDuplicate = true;
							break;
						}
					}
					if (!isDuplicate) {
						deduplicatedTabs.push(selectTab);
					} else {
						duplicatedTabs.push(selectTab);
					}
				}
			}
			
			var alertMsg = "";
			if (duplicatedTabs.length > 0) {
				let tabsNm = "";
				for (var i in duplicatedTabs) {
					if ("" != tabsNm) {
						tabsNm += ",";
					}
					if ([[${@CommonFunction.getCoConstDefVal('CD_DTL_COMPONENT_ID_PARTNER')}]] == duplicatedTabs[i]) {
						tabsNm += "3rdParty";
					} else if ([[${@CommonFunction.getCoConstDefVal('CD_DTL_COMPONENT_ID_DEP')}]] == duplicatedTabs[i]) {
						tabsNm += "DEP";
					} else if ([[${@CommonFunction.getCoConstDefVal('CD_DTL_COMPONENT_ID_SRC')}]] == duplicatedTabs[i]) {
						tabsNm += "SRC";
					} else if ([[${@CommonFunction.getCoConstDefVal('CD_DTL_COMPONENT_ID_BIN')}]] == duplicatedTabs[i]) {
						tabsNm += "BIN";
					}
				}
				alertMsg = "There are already loaded tabs(" + tabsNm + ").";
			} else {
				alertMsg = "Would you like to save the selected tab?";
			}
			
			if (deduplicatedTabs.length > 0) {
				selectTabs = deduplicatedTabs;
				if (duplicatedTabs.length > 0) {
					alertMsg += "<br/>Only unloaded tabs will be saved. Would you like to save them?";
				}
			} else {
				if (selectedFlag) {
					loadingIden.hide();
					alertify.alert(alertMsg, function() {});
					searchedData = {};
					return;
				}
			}
			
			com_fn.saveDataAfterSearch(selectTabs, searchedData);
		}
	},
	saveDataAfterSearch : function (tabs, data) {
		for (var i in tabs) {
			if ([[${@CommonFunction.getCoConstDefVal('CD_DTL_COMPONENT_ID_PARTNER')}]] == tabs[i]) {
	 			if (typeof data.thirdData !== "undefined") {
	 				partyLoadSuccess = false;
	 				party_evt.saveMakeData(data.thirdData);
	 			}
	 		} else if ([[${@CommonFunction.getCoConstDefVal('CD_DTL_COMPONENT_ID_DEP')}]] == tabs[i]) {
	 			if (typeof data.dep !== "undefined") {
	 				depLoadSuccess = false;
	 				com_fn.exitRow("depList");
	 				fn_grid_com.totalGridSaveMode('depList');
	 				dep_fn.saveMakeData(false, data.dep);
	 			}
	 		} else if ([[${@CommonFunction.getCoConstDefVal('CD_DTL_COMPONENT_ID_SRC')}]] == tabs[i]) {
	 			if (typeof data.src !== "undefined") {
	 				srcLoadSuccess = false;
	 				com_fn.exitRow("srcList");
	 				fn_grid_com.totalGridSaveMode('srcList');
	 				src_fn.saveMakeData(false, data.src);
	 			}
	 		} else if ([[${@CommonFunction.getCoConstDefVal('CD_DTL_COMPONENT_ID_BIN')}]] == tabs[i]) {
	 			if (typeof data.bin !== "undefined") {
	 				binLoadSuccess = false;
	 				com_fn.exitRow("binList");
	 				fn_grid_com.totalGridSaveMode('binList');
	 				bin_fn.saveMakeData(false, data.bin);
	 			}
	 		}
		}
	},
	partnerSearch : function () {
		var searchText = $("#uploadSearchText").val();
		$("#commonSearchForm input[name='partnerName']").val(searchText);
		
		var postData = $('#commonSearchForm').serializeObject();
		$('#_threeSearch1list').jqGrid('setGridParam', {postData:postData}).trigger('reloadGrid');
		$('.threeSearch1Area').show();
		$('.threeSearch2Area').hide();
	},
	setParamParty1 : function(){
		return {
			url: "/project/getPartnerList",
			datatype: 'json',
			jsonReader:{
				repeatitems: false,
				id: 'partnerId',
				root:function(obj){return obj.rows;},
				page:function(obj){return obj.page;},
				total:function(obj){return obj.total;},
				records:function(obj){return obj.records;}
			},
			colNames: ['ID','3rd party Name','Software Name','Software Version', 'Delivery Form','Description'],
			colModel: [
				{name: 'partnerId', index: 'partnerId', width: 42, align: 'center', key:true},
				{name: 'partnerName', index: 'partnerName', width: 240, align: 'left'},
				{name: 'softwareName', index: 'softwareName', width: 200, align: 'left'},
				{name: 'softwareVersion', index: 'softwareVersion', width: 110, align: 'left'},
				{name: 'deliveryForm', index: 'deliveryForm', width: 110, align: 'center'},
				{name: 'description', index: 'description', width: 249, align: 'left'},
			],
			onSelectRow: function(id){
				var param = {referenceId : id};
				com_fn.customSetParamParty2(param);
			},
			autoencode: true,
			rowNum: 20,
			rowList: [20, 40, 60],
			pager: '#threeSearchPager1',
			autowidth: true,
			gridview: true,
			sortable: function(permutation){
			},
			sortname: 'partnerId',
			sortorder: 'desc',
			loadonce: false,
			height: 'auto',
			mtype: 'GET',
			loadComplete: function(data) {
				if (data != null) {
					data = data.rows;
					for (var i=0; i<data.length; i++) {
						if (data[i].deliveryForm) {
							if (data[i].deliveryForm == 'SRC') {
								$("#_threeSearch1list").jqGrid("setCell", data[i].partnerId, "deliveryForm",'source form');
							} else if (data[i].deliveryForm == 'BIN') {
								$("#_threeSearch1list").jqGrid("setCell", data[i].partnerId, "deliveryForm",'binary form');
							}
						}
					}					
				}
				
				$('#_threeSearch1list').closest(".ui-jqgrid-bdiv").children(":first").css({"max-height": "360px"});
				$("#_threeSearch1list").jqGrid("setGridWidth", 0, true);
		        $("#_threeSearch1list").jqGrid("setGridWidth", 760, true);
			},
			gridComplete : function() {
				updateGridRowCount('_threeSearch1list', 'threeSearchPager1');
			}
		}
	},
	customSetParamParty2 : function(param){
		$.ajax({
			url : "/project/3rdOss",
			dataType : 'json',
			type : 'GET',
			cache : false,
			data : param,
			contentType : 'application/json',
			success : function(data){
				$("#_threeSearch2list").jqGrid('GridUnload');
				if (typeof data.rows !== "undefined") {
					com_fn.customLoadGridParty2(data.rows);
				}
				$('.threeSearch2Area').show();
			},
			error : function(){
				alertify.error([[#{msg.common.valid2}]], 0);
			}
		});
	},
	customLoadGridParty2 : function(rows) {
		var list2 = $('#_threeSearch2list');
		list2.jqGrid({
			datatype: 'local',
			data : rows,
			colNames: ['ID_KEY','ID','ReferenceId','OSSID','OSS Name','OSS Version','Download Location', 'Homepage','License', 'Copyright Text', 'Path'],
			colModel: [
				{name: 'componentId', index: 'componentId', width: 50, align: 'center', key:true, hidden:true},
				{name: 'componentIdx', index: 'componentIdx', width: 50, align: 'center'},
				{name: 'referenceId', index: 'referenceId', width: 50, align: 'center', hidden:true},
				{name: 'ossId', index: 'ossId', width: 50, align: 'center', hidden:true},
				{name: 'ossName', index: 'ossName', width: 220, align: 'left'},
				{name: 'ossVersion', index: 'ossVersion', width: 80, align: 'center'},
				{name: 'downloadLocation', index: 'downloadLocation', width: 80, align: 'left', formatter:fn_grid_com.displayDownloadLocation, unformatter:fn_grid_com.unformatter},
				{name: 'homepage', index: 'homepage', width: 80, align: 'left', formatter: fn_grid_com.displayUrl, unformat: fn_grid_com.unDisplayUrl},
				{name: 'licenseName', index: 'licenseName', width: 130, align: 'left',formatter: fn_grid_com.displayLicense},
				{name: 'copyrightText', index: 'copyrightText', width: 108, align: 'left',formatter: fn_grid_com.displayLicense},
				{name: 'filePath', index: 'filePath', width: 113, align: 'left'},
			],
			autoencode: true,
			rowNum: 20,
			rowList: [20, 100, 200],
			pager: '#pager2',
			onSelectRow: function(id){
			},
			autowidth: true,
			gridview: true,
			sortable: function(permutation){
			},
			sortname: 'componentId',
			sortorder: 'desc',
			loadonce: false,
			height: 'auto',
			mtype: 'GET',
			loadComplete: function(data){
				$('#_threeSearch2list').closest(".ui-jqgrid-bdiv").children(":first").css({"max-height":"360px"});
				$("#_threeSearch2list").jqGrid("setGridWidth", 0, true);
		        $("#_threeSearch2list").jqGrid("setGridWidth", 760, true);
			},
			gridComplete : function() {
				updateGridRowCount('_threeSearch2list', 'threeSearchPager2');
			}
		});
	},
	partnerLoadToList : function () {
		var data = $("#_threeSearch2list").jqGrid("getRowData");
		var selrow = $('#_threeSearch1list').jqGrid('getGridParam', "selrow");
		var listData = $('#_threeSearch1list').jqGrid('getRowData',selrow);
		var addListData = $("#identificationAddList").jqGrid("getRowData");
		
 		if (addListData.length > 0) {
 			for (var i=0; i<addListData.length; i++) {
 				var itemId = addListData[i].item;
 				if (itemId.startsWith("3rd")) {
 					itemId = itemId.split("-")[1];
 					if (listData.partnerId == itemId) {
 	 			    	alertify.alert([[#{msg.id.duplicate}]], function(){});
 	 			    	return;
 	 			    }
 				}
 			}
 		}
		
 		var reference = "";
		if (data.length > 0){
 			reference = data[0].referenceId;
 		}
		
		var mainData = $('#list3').jqGrid('getGridParam','data');
		
		var finalData = {
			prjId : [[${project.prjId}]],
			referenceId : reference,
			thirdPartyData : JSON.stringify(data),
			mainData : JSON.stringify(mainData)
		}
		
		$.ajax({
			url : "/project/save3rdOss",
			type : 'POST',
			dataType : 'json',
			cache : false,
			data : JSON.stringify(finalData),
			contentType : 'application/json',
			success : function(data) {
				if (data) {
					bom_fn.beforeSave(true);
				} else {
					alertify.error([[#{msg.common.valid2}]], 0);
				}
			},
			error : function(){
				alertify.error([[#{msg.common.valid2}]], 0);
			}
		});
	},
	changeSelectOption : function () {
		var value = $('input[name=identificationSelectOption]:checked').val();
		if (1 == value) {
			$("#idenProjectSearch").hide();
			$("#idenUploadSearch").show();
		} else {
			$("#idenUploadSearch").hide();
			$("#idenProjectSearch").show();
		}
	},
	getIdentificationAddList : function (referenceDiv) {
		// 3rd, dep, src, bin > add list
		$.ajax({
			url : "/project/getIdentificationAddList",
			type : 'POST',
			data : JSON.stringify({"prjId" : [[${project.prjId}]], "referenceDiv" : referenceDiv}),
			dataType : 'json',
			cache : false,
			async : false,
			contentType : 'application/json',
			success : function(data) {
				$("#identificationAddList").jqGrid('GridUnload');
				com_fn.setIdentificationJqGrid(data, referenceDiv);
			},
			error : function(){
				alertify.error([[#{msg.common.valid2}]], 0);
			}
		});
	},
	displayLoadedItem : function (cellvalue, options, rowObject) {
		var display = "";
		if ("FILE" == rowObject.item) {
			display = "<a class=\"urlLink\" title=\"" + rowObject.regDt + " (" + rowObject.regId + ")\" href=\"/download/" + rowObject.fileSeq + "/" + rowObject.logiNm + "\">" + cellvalue + "</a>";
		} else {
			var protocol = window.location.protocol;
			var host =  window.location.host;
			var url = protocol + "//" + host;
			var id = rowObject.item.split("-")[1];
			if (rowObject.item.indexOf("prj") > -1) {
				url += "/project/shareUrl/" + id;
			} else {
				url += "/partner/shareUrl/" + id;
			}
			display = "<a class=\"urlLink\" href=\"" + url + "\" target=\"_blank\">" + cellvalue + "</a>";
		}
		return display;
	},
	setIdentificationJqGrid : function (data, referenceDiv) {
		loadingIden.show();
		
		const refDiv = referenceDiv;
		var identificationAddList = $("#identificationAddList");
		uploadGridData = data.rows;
		var counts = data.counts;
		
		var colModelArr = [];
		var colModelObj = {name: 'id', index: 'id', hidden: true, key: true};
		colModelArr.push(colModelObj);
		colModelObj = {name: 'item', index: 'item', width: 40, editable: false, align: 'center'};
		colModelArr.push(colModelObj);
		colModelObj = {name: 'loadedItem', index: 'loadedItem', width: 100, editable: false, align: 'center', search: false, formatter: com_fn.displayLoadedItem};
		colModelArr.push(colModelObj);
		colModelObj = {name: 'loadedTab', index: 'loadedTab', editable: false, align: 'center', search: false};
		colModelArr.push(colModelObj);
		colModelObj = {name: 'fileSeq', index: 'fileSeq', hidden: true};
		colModelArr.push(colModelObj);
		colModelObj = {name: 'logiNm', index: 'logiNm', hidden: true};
		colModelArr.push(colModelObj);
		colModelObj = {name: 'regId', index: 'regId', hidden: true};
		colModelArr.push(colModelObj);
		colModelObj = {name: 'regDt', index: 'regDt', hidden: true};
		colModelArr.push(colModelObj);
		
		identificationAddList.jqGrid({
			datatype: 'local',
			data : uploadGridData,
			colNames: ['ID', 'Item', 'Loaded Item', 'Loaded Tab(Count)', 'File Seq', 'File LogiNm', 'Reg Id', 'Reg Dt'],
			colModel: colModelArr,
			autoencode: true,
			editurl:'clientArray',
 			autowidth: true,
			height: 'auto',
			gridview: true,
		   	pager: '#identificationAddPager',
			rowNum: 200,
			recordpos:'right',
		    toppager:true,
			loadonce:true,
			cellEdit : true,
			cellsubmit : 'clientArray',
			ignoreCase: true,
			multiselect: true,
			multiselectWidth: 35,
		    onSortCol: function (index, columnIndex, sortOrder) {
		    	isSort = true;
		    },
		    beforeSelectRow: function(rowid, e) {
				var $self = $(this), iCol, cm,
			    $td = $(e.target).closest("tr.jqgrow>td"),
			    $tr = $td.closest("tr.jqgrow"),
			    p = $self.jqGrid("getGridParam");

			    if ($(e.target).is("input[type=checkbox]") && $td.length > 0) {
			       iCol = $.jgrid.getCellIndex($td[0]);
			       cm = p.colModel[iCol];
			       
			       if (cm != null && cm.name === "cb") {
			           // multiselect checkbox is clicked
			           $self.jqGrid("setSelection", $tr.attr("id"), true ,e);
			       }
			    }
			    return false;
			},
			onCellSelect: function(rowid,iCol,cellcontent,e) {
				
			},
		    loadComplete: function(data) {
		    	if (data.records > 0) {
					var multRowIds = []; 
					var rowIdx = 0, rows = this.rows, rowsCount = rows.length, row, rowid, rowData, className;

					for (var _idx=0;_idx<rowsCount;_idx++) {
						row = rows[_idx];
						// checkbox click event
						$("#"+row.id).find("input[type=checkbox]").removeClass("cbox");
					}
					
					// 한번에 처리
					$("#identificationAddList tr.singleLicenseClass").find("td:first").removeClass("sgexpanded sgcollapsed").find("a").hide();
				}
		    	
		    	var pageButtonArea = $('#entireList_toppager_left');
				if ($("#identificationAddList_toppager_left").find('button').length == 0) {
					var permission = [[${project.statusPermission}]] == 1;
                	var identificationStatus = [[${project.identificationStatus}]];
					
                	var appendBtn = "";
                	appendBtn += "<button type=\"button\" class=\"btn btn-sm btn-grid-light-gray float-left ml-1\" title=\"add\" onclick=\"com_fn.addUploadFunc('identificationAddList', "+permission+", '"+refDiv+"')\">";
                	if (!permission || "CONF" == identificationStatus || 'REQ' == identificationStatus) {
                		appendBtn += "<i class=\"fas fa-plus gridIconDisabled\"></i></button>";
                	} else {
                		if ('ROLE_USER' == userRole && 'REV' == identificationStatus) {
                    		appendBtn += "<i class=\"fas fa-plus gridIconDisabled\"></i></button>";
                		} else {
                    		appendBtn += "<i class=\"fas fa-plus\"></i></button>";
                		}
                	}
            		appendBtn += "<button type=\"button\" class=\"btn btn-sm btn-grid-light-gray float-left ml-1\" title=\"delete\" onclick=\"com_fn.delUploadFunc('identificationAddList', 'main', "+permission+", '"+refDiv+"')\">";
            		if (!permission || "CONF" == identificationStatus || 'REQ' == identificationStatus) {
                		appendBtn += "<i class=\"fas fa-trash-alt gridIconDisabled\"></i></button>";
                	} else {
                		if ('ROLE_USER' == userRole && 'REV' == identificationStatus) {
                    		appendBtn += "<i class=\"fas fa-trash-alt gridIconDisabled\"></i></button>";
                		} else {
                    		appendBtn += "<i class=\"fas fa-trash-alt\"></i></button>";
                		}
                	}
            		appendBtn += "<button type=\"button\" class=\"btn btn-sm btn-grid-light-gray float-left ml-1\" title=\"reset\" onclick=\"com_fn.resetUploadFunc('identificationAddList', 'main', "+permission+", '"+refDiv+"')\">";
            		if (!permission || "CONF" == identificationStatus || 'REQ' == identificationStatus) {
                		appendBtn += "<i class=\"fas fa-undo-alt gridIconDisabled\"></i></button>";
                	} else {
                		if ('ROLE_USER' == userRole && 'REV' == identificationStatus) {
                    		appendBtn += "<i class=\"fas fa-undo-alt gridIconDisabled\"></i></button>";
                		} else {
                    		appendBtn += "<i class=\"fas fa-undo-alt\"></i></button>";
                		}
                	}
                    $("#identificationAddList_toppager_left").append(appendBtn);
                }
		    }, 
		    gridComplete: function() {
		    	com_fn.updateIdentificationLoadedListCount("identificationAddPager", counts);
		    }
		});
	},
	updateIdentificationLoadedListCount : function (pagerId, data) {
		var totalCnt = 0;
		var total = "";
		var components = "";
		
		for (const key in data) {
			if ("Project" == key || "FILE" == key) {
				totalCnt += data[key];
				if ("" != total) {
					total += " ";
				}
				total += key + "(" + data[key] + ")";
			} else {
				if ("" != components) {
					components += " ";
				}
				components += key + "(" + data[key] + ")";
			}
		}
		
		var message = '<div dir="ltr" class="text-right-overflow">Total(' + totalCnt + '): ' + total + '<br>OSS Components: ' + components + '</div>';
	    $('#' + pagerId).children().last().find('#' + pagerId+ '_right').html(message);
	},
	addUploadFunc : function (target, permission, referenceDiv) {
		const data = {
        	category: "project/fragments",
           	templateName: "edit",
            fragmentName: "uploadFragments"
      	};

        postAjaxJsonData(JSON.stringify(data), "/render/component", 'html', function (res) {
        	loading.hide();
        	if (typeof alertify.uploadIdentification === "undefined") {
        		alertifyUploadDialog("uploadIdentification", "900", "dialog_addUpload_" + [[${project.prjId}]]);
        	}
        	alertify.uploadIdentification().setContent(res).show();
			$(alertify.uploadIdentification()).find(".ajs-content").css("padding", "0");
			
			com_fn.identificationUploadFile(referenceDiv);
			callAutoCompleteFnc("autoComProjectNmConf");
			
			$('#_threeSearch1list').jqGrid(com_fn.setParamParty1());
			$('#_searchProjectList1').jqGrid(com_fn.setParamProject1(referenceDiv));
			$('#_searchProjectList2').jqGrid(com_fn.setParamProject2());
       	});
	},
	delUploadFunc : function (target, permission, permission, referenceDiv) {
		var chk = $("#" + target).jqGrid("getGridParam", "selarrrow").length;
		if (chk == 1) {
			var selData = $("#" + target).jqGrid("getGridParam", "selarrrow");
			var delData;
			
			for (var i in selData) {
				var delData = $("#" + target).jqGrid("getRowData", selData[i]);
				loadedTab = delData.loadedTab;
			}
			
			if (loadedTab.indexOf(",") > -1) {
				const data = {
					category: "project/fragments",
					templateName: "edit",
					fragmentName: "deleteUploadFragments"
				};
				postAjaxJsonData(JSON.stringify(data), "/render/component", 'html', function (res) {
					var tempBody = $('<div>').html(res);
					
					if (typeof alertify.deleteUploadAlert === "undefined") {
						alertifyDeleteDialog("deleteUploadAlert", "400", "dialog_deleteUpload_" + [[${project.prjId}]]);
			        }
					
					var loadedTabs = loadedTab.split(",");
					for (var i in loadedTabs) {
						let tabNm = loadedTabs[i].split("(")[0];
						if ("3rdParty" == tabNm) {
							$(tempBody).find("#3rdCheck").prop("disabled", false);
						} else if ("DEP" == tabNm) {
							$(tempBody).find("#depCheck").prop("disabled", false);
						} else if ("SRC" == tabNm) {
							$(tempBody).find("#srcCheck").prop("disabled", false);
						} else if ("BIN" == tabNm) {
							$(tempBody).find("#binCheck").prop("disabled", false);
						}
					}
					tempBody.find('#deleteUploadApply').attr('onclick', 'com_fn.selectDeleteUpload(' + JSON.stringify(delData) + ',' + referenceDiv + ')');
					alertify.deleteUploadAlert().setContent(tempBody.html()).show();
	    			$(alertify.deleteUploadAlert()).find(".ajs-content").css("padding", "0");
				});
			} else {
				alertify.confirm([[#{msg.common.confirm.delete}]], function(){
					loadingIden.show();
					setTimeout(function() {
						var fileSeq = delData.fileSeq;
						var data = {"prjId" : [[${project.prjId}]], "referenceId" : "", "fileSeq" : ""};
						if ("" == fileSeq) {
							var item = delData.item;
							data["referenceId"] = item;
						} else {
							data["fileSeq"] = fileSeq;
						}
						var tabs = [];
						var loadedTabStr = loadedTab.split("(")[0];
						
						switch(loadedTabStr.toUpperCase()){
							case "DEP":		loadedTabStr = [[${@CommonFunction.getCoConstDefVal('CD_DTL_COMPONENT_ID_DEP')}]];	break;
							case "SRC":		loadedTabStr = [[${@CommonFunction.getCoConstDefVal('CD_DTL_COMPONENT_ID_SRC')}]];	break;
							case "BIN":		loadedTabStr = [[${@CommonFunction.getCoConstDefVal('CD_DTL_COMPONENT_ID_BIN')}]];	break;
							case "ANDROID":	loadedTabStr = [[${@CommonFunction.getCoConstDefVal('CD_DTL_COMPONENT_ID_ANDROID')}]];	break;
						}
						
						tabs.push(loadedTabStr);
						data["referenceDiv"] = tabs;
						com_fn.deleteUploadData(data, referenceDiv);
					}, 100);
				});
			}
		} else if (chk > 1) {
			loadingIden.hide();
			alertify.alert("Please select only one row to delete.", function(){});
			return;
		} else {
			loadingIden.hide();
			alertify.alert("Please select only one row to delete.", function(){});
			return;
		}
	},
	resetUploadFunc : function (target, permission, permission, referenceDiv) {
		var rowIds = $("#" + target).jqGrid('getDataIDs');
		var selectedRowIds = $("#" + target).jqGrid("getGridParam", "selarrrow");
		var items = [];
		
		if (selectedRowIds.length > 0) {
			items = selectedRowIds;
		} else {
	 		for (var i in rowIds) {
	 			if (selectedRowIds.indexOf(rowIds[i]) === -1) {
	 				$("#" + target).jqGrid("setSelection", rowIds[i], true);
	 			}
	 		}
	 		items = rowIds;
		}
		
		alertify.confirm("Do you want to reset all records and uploaded files related to the selected row?<br/>All data will be permanently deleted.", function(){
			loadingIden.show();
			
			setTimeout(function() {
				$.ajax({
					url : '/project/delIdentificationUpload',
					type : 'POST',
					data : JSON.stringify({"prjId" : [[${project.prjId}]], "items" : items, "reset" : "Y"}),
					dataType : 'json',
					cache : false,
					async : false,
					contentType : 'application/json',
					success: function(data) {
						loadingIden.hide();
						
						if (data.isValid) {
							bom_fn.beforeSave(true);
						} else {
							alertify.error([[#{msg.common.valid}]], 0);
						}
					},
					error: function(data){
						loadingIden.hide();
						alertify.error([[#{msg.common.valid}]], 0);
					}
				});
			}, 100);
		});
	},
	selectDeleteUpload : function (data, referenceDiv) {
		alertify.alert([[#{msg.common.confirm.delete}]], function(){
			loadingIden.show();
			
			setTimeout(function() {
				var tabs = [];
				$('input:checkbox[name="deleteCheck"]').each(function(){
					if ($(this).is(':checked')) {
						tabs.push($(this).val());
					}
				});
				
				if (tabs.length == 0) {
					loadingIden.hide();
					alertify.alert([[#{msg.common.select.tab}]]);
					return;
				} else {
					var fileSeq = data.fileSeq;
					var delData = {"prjId" : [[${project.prjId}]], "referenceId" : "", "fileSeq" : ""};
					if ("" == fileSeq) {
						var item = data.item;
						delData["referenceId"] = item;
					} else {
						delData["fileSeq"] = fileSeq;
					}
					delData["referenceDiv"] = tabs;
					com_fn.deleteUploadData(delData, referenceDiv);
				}
			}, 100);
		});
	},
	deleteUploadData : function (delData, referenceDiv) {
		$.ajax({
			url : '/project/delIdentificationUpload',
			type : 'POST',
			data : JSON.stringify(delData),
			dataType : 'json',
			cache : false,
			async : false,
			contentType : 'application/json',
			success: function(data) {
				loadingIden.hide();
				
				if (data.isValid) {
					bom_fn.beforeSave(true);
				} else {
					alertify.error([[#{msg.common.valid}]], 0);
				}
			},
			error: function(data){
				loadingIden.hide();
				alertify.error([[#{msg.common.valid}]], 0);
			}
		});
	},
	identificationUploadFile : function (referenceDiv) {
    	const data = {
		   	category: "project/fragments",
		    templateName: "edit",
		    fragmentName: "selectSheetFragments"
		};
		postAjaxJsonData(JSON.stringify(data), "/render/component", 'html', function (res) {
			var tempBody = $('<div>').html(res);
			
			if (typeof alertify.uploadSheets === "undefined") {
	        	alertifyUploadDialog("uploadSheets", "700", "dialog_selectSheet_" + [[${project.prjId}]]);
	        }
			
			var accept1 = '';
			var fileAccept = [[${@CoCodeManager.getCodeDtls(@CommonFunction.getCoConstDefVal("CD_FILE_ACCEPT"))}]];
			for (var i in fileAccept) {
				if ('12' == fileAccept[i].cdDtlNo) {
					accept1 = fileAccept[i].cdDtlExp;
				}
			}
			
			//파일업로드
			$('#identificationCsvFile').uploadFile({
				url:'/project/csvFile',
				multiple:false,
				dragDrop:true,
				fileName:'myfile',
				allowedTypes:accept1,
				sequential:true,
				sequentialCount:1,
				formData:{"registFileId" : $('#identificationCsvFileId').val()},
				onSubmit : function(files) {
					loadingIden.show();
				},
				onSuccess:function(files,data,xhr,pd) {
					loadingIden.hide();
					var result = jQuery.parseJSON(data);
					
					if (result[1] == null) {
						if (result[0] == "TAB_GUBN_ERROR") {
							alertify.error([[#{msg.common.upload.failed.separator}]], 0);
						} else {
							alertify.error([[#{msg.common.valid}]], 0);
						}
						$('.ajax-file-upload-statusbar').fadeOut('slow');
						$('.ajax-file-upload-statusbar').remove();
					} else {
						if (result[0] == "FILE_SIZE_LIMIT_OVER") {
							alertify.alert(result[1], function(){
								$('.ajax-file-upload-statusbar').fadeOut('slow');
								$('.ajax-file-upload-statusbar').remove();
							});
						} else if(result[2] == "CSV_FILE") {
							var sheetNums = ["0"];
							com_fn.getOtherSheetData(referenceDiv, result[0][0].registSeq, sheetNums);
							
							$('#identificationCsvFileId').val(result[0][0].registFileId);
							$('.ajax-file-upload-statusbar').fadeOut('slow');
							$('.ajax-file-upload-statusbar').remove();
						} else if (result[2] == "EXCEL_FILE") {
							var checkSheetNms = [];
							var checkTabNms = [];
							// bom 또는 android 일 경우
							if ([[${@CommonFunction.getCoConstDefVal('CD_DTL_COMPONENT_ID_BOM')}]] == referenceDiv) {
								$("#identification_android").hide();
								$("#identification_bom").show();
								checkSheetNms = ["3RD PARTY", "DEP", "SRC", "BIN", "SBOM"];
								checkTabNms = ["DEP", "SRC", "BIN"];
							} else {
								$("#identification_bom").hide();
								$("#identification_android").show();
								checkSheetNames.push("BIN");
							}
							
							tempBody.find("#selectSheetBody").empty();
							if (result[1].length != 0) {
								var appendHtml = "";
								for (var i = 0; i < result[1].length; i++) {
									var sheetTr = "<tr>";
									var checkFlag = false;
 									var sheetName = result[1][i].name.toUpperCase().trim();
									
 									for (var j = 0; j < checkSheetNms.length; j++) {
 										if (sheetName.toUpperCase().indexOf(checkSheetNms[j]) > -1) {
											checkFlag = true;
											break;
										}
									}
 									
  									if (checkFlag) {
  										checkFlag = false;
 										sheetTr += '<td><input type="checkbox" class="sheetRowCheckBox mr-2" name="sheetCheck">' + sheetName + '</td>';
 										for (var j = 0; j < checkTabNms.length; j++) {
 											if (sheetName.indexOf(checkTabNms[j]) > -1) {
 												checkFlag = true;
												sheetTr += '<td class="text-center"><input type="radio" name="sheetNameSelect' + result[1][i].no + '" value="' + result[1][i].no + '_' + checkTabNms[j] + '" id="sheet' + result[1][i].no + '" style="margin-left: -0.5rem !important;" class="form-check-input" checked></td>';
 											} else {
 												sheetTr += '<td class="text-center"><input type="radio" name="sheetNameSelect' + result[1][i].no + '" value="' + result[1][i].no + '_' + checkTabNms[j] + '" id="sheet' + result[1][i].no + '" style="margin-left: -0.5rem !important;" class="form-check-input"></td>';
 											}
										}
 										sheetTr += '</tr>';
 										if (checkFlag) {
 											sheetTr = sheetTr.replace('name="sheetCheck"', 'name="sheetCheck" checked');
 	 									} else {
 	 										sheetTr = sheetTr.replaceAll('class="form-check-input"', 'class="form-check-input" disabled');
 	 									}
 										appendHtml += sheetTr;
									}
								}
								
								if ("" != appendHtml) {
									tempBody.find("#selectSheetBody").append(appendHtml);
									tempBody.find('#selectSheetApply').attr('onclick', 'com_fn.getSheetData(' + referenceDiv + ', ' + result[0][0].registSeq + ')');
									
									alertify.uploadSheets().setContent(tempBody.html()).show();
									$(alertify.uploadSheets()).find(".ajs-content").css("padding", "0");
									$('#identificationCsvFileId').val(result[0][0].registFileId);
								} else {
									var msg = "<b>" + result[0][0].originalFilename + "</b> has no sheets available for upload."
									alertify.alert(msg, function() {});
								}
							} else {
								var msg = result[0][0].originalFilename + " has no sheets available for upload."
								alertify.alert(msg, function() {});
							}
							
	 						$('.ajax-file-upload-statusbar').fadeOut('slow');
	 						$('.ajax-file-upload-statusbar').remove();
						} else if (result[2] == "SPDX_SPREADSHEET_FILE") {
							var sheetNums = ["1", "4"];
							com_fn.getOtherSheetData(referenceDiv, result[0][0].registSeq, sheetNums);

							$('#identificationCsvFileId').val(result[0][0].registFileId);
							$('.ajax-file-upload-statusbar').fadeOut('slow');
							$('.ajax-file-upload-statusbar').remove();
						} else {
							alertify.error([[#{msg.common.valid}]], 0);
							$('.ajax-file-upload-statusbar').fadeOut('slow');
							$('.ajax-file-upload-statusbar').remove();
						}
					}
				}
			});
		});
    },
    getSheetData : function (referenceDiv, seq) {
		var sheetNum = [];
		
		const $radio = $('input[name^="sheetNameSelect"]');
		$radio.each(function(){
			if ($(this).is(':checked') && $(this).closest('tr').find("input[type='checkbox']").is(":checked")) {
				sheetNum.push($(this).val());
			}
		});
		
		if (sheetNum.length == 0) {
			alertify.alert([[#{msg.common.check.sheet}]], function(){});
			
			return;
		} else {
			loadingIden.show();
			
			var readType = referenceDiv;
			var finalData = {"readType" : "" + readType, "prjId" : [[${project.prjId}]], "sheetNums" : sheetNum , "fileSeq" : "" + seq};
			var object = {fileSeq : seq};
			
			if ([[${@CommonFunction.getCoConstDefVal('CD_DTL_COMPONENT_ID_BOM')}]] == referenceDiv) {
				fn_grid_com.totalGridSaveMode('depList');
				cleanErrMsg("depList");
				var depMainData = $("#depList").jqGrid('getGridParam','data');
				
				fn_grid_com.totalGridSaveMode('srcList');
				cleanErrMsg("srcList");
				var srcMainData = $("#srcList").jqGrid('getGridParam','data');
				
				fn_grid_com.totalGridSaveMode('binList');
				cleanErrMsg("binList");
				var binMainData = $("#binList").jqGrid('getGridParam','data');
				
				finalData["depMainData"] = JSON.stringify(depMainData);
				finalData["srcMainData"] = JSON.stringify(srcMainData);
				finalData["binMainData"] = JSON.stringify(binMainData);
			} else {
				fn_grid_com.totalGridSaveMode('binAndroidList');
				cleanErrMsg("binAndroidList");
				
				var target = $("#binAndroidList");
				var binandroidMainData = target.jqGrid('getGridParam','data');
				
				finalData["binandroidMainData"] = JSON.stringify(binandroidMainData);
			}
			
			setTimeout(function() {
				com_fn.exeLoadReportData(finalData, referenceDiv);
			}, 100);
		}
    },
    getOtherSheetData : function (referenceDiv, seq, sheetNums) {
    	loadingIden.show();
    	
    	var sheetNum = sheetNums;
    	var readType = referenceDiv;
    	var finalData = {"readType":"" + readType,"prjId" : [[${project.prjId}]], "sheetNums" : sheetNum , "fileSeq" : ""+seq};
    	
    	if ([[${@CommonFunction.getCoConstDefVal('CD_DTL_COMPONENT_ID_BOM')}]] == referenceDiv) {
    		fn_grid_com.totalGridSaveMode('depList');
			cleanErrMsg("depList");
			fn_grid_com.totalGridSaveMode('srcList');
			cleanErrMsg("srcList");
			fn_grid_com.totalGridSaveMode('binList');
			cleanErrMsg("binList");
    		
    		var depMainData = $("#depList").jqGrid('getGridParam','data');
    		depMainData.forEach (function (el, index) {
    			if (typeof el.packageUrl !== "undefined" && "" != el.packageUrl) {
    				el.packageUrl = "";
    			}
    		});
    		var srcMainData = $("#srcList").jqGrid('getGridParam','data');
    		srcMainData.forEach (function (el, index) {
    			if (typeof el.packageUrl !== "undefined" && "" != el.packageUrl) {
    				el.packageUrl = "";
    			}
    		});
    		var binMainData = $("#binList").jqGrid('getGridParam','data');
    		binMainData.forEach (function (el, index) {
    			if (typeof el.packageUrl !== "undefined" && "" != el.packageUrl) {
    				el.packageUrl = "";
    			}
    		});
    		
    		finalData["depMainData"] = JSON.stringify(depMainData);
			finalData["srcMainData"] = JSON.stringify(srcMainData);
			finalData["binMainData"] = JSON.stringify(binMainData);
    	} else {
    		fn_grid_com.totalGridSaveMode('binAndroidList');
			cleanErrMsg("binAndroidList");
			
			var target = $("#binAndroidList");
			var binandroidMainData = target.jqGrid('getGridParam','data');
			
			finalData["binandroidMainData"] = JSON.stringify(binandroidMainData);
    	}
		
    	setTimeout(function() {
			com_fn.exeLoadReportData(finalData, referenceDiv);
		}, 100);
    },
    exeLoadReportData : function (finalData, referenceDiv) {
    	$.ajax({
			url : '/project/getIdentificationSheetData',
			type : 'POST',
			data : JSON.stringify(finalData),
			dataType : 'json',
			cache : false,
			async : false,
			contentType : 'application/json',
			success: function(data) {
				loadingIden.hide();
				
				if ("false" == data.isValid) {
					if (data.validMsg) {
						alertify.alert(data.validMsg, function(){});
					} else {
						alertify.error([[#{msg.common.valid}]], 0);
					}
				} else {
					if (typeof data.resultData.isExistsExcludeYn !== "undefined") {
						alertify.confirm([[#{msg.common.exists.excludeYn}]], function(){
							bom_fn.beforeSave(true);
						});
					} else {
						bom_fn.beforeSave(true);
					}
				}
			},
			error: function(data) {
				loadingIden.hide();
				$('.identificationFileArea').children().remove();
				alertify.error([[#{msg.common.valid}]], 0);
			}
		});
    },
    closeSelectSheet : function () {
    	$("#dialog_selectSheet_" + [[${project.prjId}]]).find(".ajs-close").trigger("click");
    },
    closeSelectSearch : function () {
    	searchedData = {};
    	$("#dialog_selectSearch_" + [[${project.prjId}]]).find(".ajs-close").trigger("click");
    },
    closeDeleteUpload : function () {
    	$("#dialog_deleteUpload_" + [[${project.prjId}]]).find(".ajs-close").trigger("click");
    }
}

	var fn_comment = {
		callbackFunction : function () {
	    	fn_comment.getCommentList(commentsParam);
	    },
		getCommentList : function(param) {
			$.ajax({
				type: "GET",
				url: '/comment/getCusCommentList',
				dataType : 'html',
				cache : false,
				data : param,
				success: function (res) {
					if (typeof param.height !== undefined) {
						$(".comment-card-body").attr("style", "max-height:" + param.height + "px; overflow-y: auto;");
					}
					$("#commentList").empty();
					$("#commentList").html(res);
				},
				error: function(data){
					alertify.error([[#{msg.common.valid2}]], 0);
				}
			});
		},
		getMoreCommentsList : function() {
			commentsParam["moreFlag"] = "Y";
			fn_comment.getCommentList(commentsParam);
		},
		editComments : function(_commId, _referenceDiv, _referenceId) {
			$.ajax({
				url : '/comment/getEditPopup',
				type : 'POST',
				data : {'commId' : _commId},
				dataType : 'html',
				cache : false,
				success : function(res){
					if (typeof alertify.editComments === "undefined"){
						alertifyWithoutButtons('editComments');
	        		}
					alertify.editComments().set('title', 'Edit Comments').setContent(res).show();
					$("#updateComments").attr("onclick", "fn_comment.updateComments("+_commId+", "+_referenceDiv+", "+_referenceId+")");
					$("#commentEdit").summernote({minHeight: 180, maxHeight: 800, lang: "ko-KR"});
				}
			});
		},
		updateComments : function (_commId, _referenceDiv, _referenceId) {
			if ("" == $("#commentEdit").next().find(".note-editable").text()) {
				alertify.alert("Please enter a comment", function(){});
				return false;
			} else {
				var param = {commId : _commId, contents : replaceWithLink($("#commentEdit").summernote('code')), referenceDiv: _referenceDiv, referenceId: _referenceId};
					$.ajax({
					url : '/comment/updateComment',
					type : 'POST',
					dataType : 'json',
					cache : false,
					data : param,
					success : function(json){
						alertify.success([[#{msg.common.success}]]);
						$(".ajs-close").trigger("click");
						fn_comment.getCommentList(commentsParam);
					},
					error : function(){
						alertify.error([[#{msg.common.valid2}]], 0);
					}
				});
			}
		},
		deleteComments : function (_commId) {
			if (typeof alertify.delCommentIdenDialog === "undefined") {
				basicAlertifyDialog('delCommentIdenDialog');
			}
			alertify.delCommentIdenDialog("Are you sure you want to delete this comment?", function (e) {
				if (e) {
					$.ajax({
						url : '/comment/deleteComment',
						type : 'POST',
						dataType : 'json',
						cache : false,
						data : {'commId' : _commId},
						success : function(data){
							alertify.success([[#{msg.common.success}]]);
							$(".ajs-close").trigger("click");
							fn_comment.getCommentList(commentsParam);
						},
						error : function(){
							alertify.error([[#{msg.common.valid2}]], 0);
						}
					});
				} else {
					return false;
				}
			});
		},
		closeAlertifyView : function () {
			fn.closeAlertifyView();
		},
		activateCommentArea : function () {
			var targetId = $("#menu-tab").find(".active").attr("aria-controls");
			var tabDiv = targetId.split("-")[1];
			var commonEditMode = "";
			
			var targetId = "";
			switch (tabDiv) {
				case "third" : 
					targetId = "_3rdAddList";
					commonEditMode = $("#thirdEditMode").val();
					break;
				case "dep" : 
					targetId = "_depAddList";
					commonEditMode = $("#depEditMode").val();
					break;
				case "src" : 
					targetId = "_srcAddList";
					commonEditMode = $("#srcEditMode").val();
					break;
				case "bin" : 
					targetId = "_binAddList";
					commonEditMode = $("#binEditMode").val();
					break;
				case "android" : 
					targetId = "_binAndroidProjectList2";
					commonEditMode = $("#binandroidEditMode").val();
					break;
			}
			
			
			
			// change tab area
			if (!$(".comment-area").is(":visible")) {
				$(".contents-area").removeClass("col-12");
				$(".contents-area").addClass("col-lg-9");
				
				fn_comment.getCommentList(commentsParam);
				$(".comment-area").show();
			} else {
	 			$(".contents-area").removeClass("col-lg-9");
	 			$(".contents-area").addClass("col-12");
	 			$(".comment-area").hide();
			}
			
			resizeUploadAreaJqGrid();
		},
		showCommentHistory : function () {
			fn_comment.activateCommentArea();
			
			var _rDiv = [[${@CommonFunction.getCoConstDefVal('CD_DTL_COMMENT_IDENTIFICAITON_HIS')}]];
	        openCommentHistory('/comment/popup/prj/' + _rDiv + '/' + [[${project.prjId}]]);
		}
	}
</script>
</th:block>
</html>